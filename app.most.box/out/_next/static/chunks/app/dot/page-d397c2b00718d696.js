(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6566],{4673:(e,t,n)=>{"use strict";n.d(t,{BP:()=>h,OM:()=>g,yO:()=>x});var s=n(30167),r=n(71425),a=n(44532),i=n(87788),o=n(56076),l=n(88413),c=n(70358),d=n(26634),m=n.n(d);let h=(e,t,n)=>{let c=(0,s.YW)(t),d=(0,s.YW)("/most.box/"+e),h=(0,r.A)(c,d,3,32,"sha512"),x=(0,a.q5)((0,i.s)(h)),g=x.slice(0,32),u=m().box.keyPair.fromSecretKey(g),p=(0,a.c$)(u.publicKey),j=(0,a.c$)(u.secretKey),f=o.v.entropyToPhrase(x);return{username:e,address:l.QX.fromPhrase(f).address,public_key:p,private_key:j,mnemonic:"I know loss mnemonic will lose my wallet."===n?f:""}},x=(e,t,n)=>{let s=new TextEncoder().encode(e),r=m().randomBytes(m().box.nonceLength),i=m().box(s,r,new Uint8Array((0,a.q5)(t)),new Uint8Array((0,a.q5)(n)));return i?["mp://2",(0,c.W)(r),(0,c.W)(i)].join("."):(console.info("加密失败"),"")},g=(e,t,n)=>{let[s,r,i]=e.split(".");if("mp://2"!==s)return console.info("无效的密文"),"";let o=m().box.open((0,c.y)(i),(0,c.y)(r),new Uint8Array((0,a.q5)(t)),new Uint8Array((0,a.q5)(n)));return o?new TextDecoder().decode(o):(console.info("解密失败"),"")}},7248:(e,t,n)=>{"use strict";n.d(t,{h:()=>r});var s=n(35695);let r=()=>{let e=(0,s.useRouter)(),t=(0,s.usePathname)();return()=>{sessionStorage.firstPath===t?(sessionStorage.firstPath="/",e.replace("/")):e.back()}}},9482:(e,t,n)=>{"use strict";n.d(t,{A:()=>w});var s=n(70358),r=n(30167),a=n(88413),i=n(19396),o=n(96842),l=n(42995),c=n(3648),d=n(4673),m=n(59909),h=n(30832),x=n.n(h),g=n(99758),u=n.n(g);n(38464);var p=n(76920),j=n.n(p);x().extend(j()),x().extend(u()),x().locale("zh-cn");let f=e=>{let t=String(Date.now()),n=(0,s.W)(crypto.getRandomValues(new Uint8Array(32))),r=sessionStorage.getItem("fingerprint")||"",a=[location.origin,r].join("/"),i=[t,n].join("."),{public_key:o,private_key:l}=(0,d.BP)(a,i);return{jwt:(0,d.yO)(JSON.stringify(e),o,l),jwtSecret:i}},y=(e,t)=>{let[n]=t.split(".");if(Date.now()-Number(n)>288e5)return console.log("jwt 已过期"),null;try{let n=sessionStorage.getItem("fingerprint")||"",s=[location.origin,n].join("/"),{public_key:r,private_key:a}=(0,d.BP)(s,t),i=(0,d.OM)(e,r,a);if(i)return JSON.parse(i)}catch(e){console.log("验证失败:",e)}return null},b=async e=>{let t=Date.now().toString(),n=a.QX.fromPhrase(e.mnemonic),s=await n.signMessage(t);localStorage.token=[e.address,t,s].join(".")},w={avatar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,o.gn)(l,{seed:"most.box@"+e,flip:!0,backgroundType:["gradientLinear"]}).toDataUri()},avatarCID:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,o.gn)(c,{seed:"most.box#"+e,flip:!0,backgroundType:["gradientLinear","solid"]}).toDataUri()},formatTime:e=>{let t;if(!e)return"";let n=x()(Number(e)),s=n.hour();return t=s>=0&&s<3?"凌晨":s>=3&&s<6?"拂晓":s>=6&&s<9?"早晨":s>=9&&s<12?"上午":s>=12&&s<15?"下午":s>=15&&s<18?"傍晚":s>=18&&s<21?"薄暮":"深夜",n.format("YYYY年M月D日 ".concat(t,"h点m分"))},formatDate:e=>{let t=x()(Number(e)),n=x()();return t.isSame(n,"day")?t.format("HH:mm"):t.isSame(n.subtract(1,"day"),"day")?"昨天 ".concat(t.format("HH:mm")):t.isoWeek()===n.isoWeek()?"".concat(["周日","周一","周二","周三","周四","周五","周六"][t.day()]," ").concat(t.format("HH:mm")):t.year()===n.year()?t.format("M月D日"):t.format("YY年M月D日")},formatAddress:e=>e?e.slice(0,6)+"..."+e.slice(-4):"",enBase64:e=>(0,s.W)((0,r.YW)(e)),deBase64:e=>(0,r._v)((0,s.y)(e)),createJWT:f,verifyJWT:y,login:(e,t)=>{try{var n;let s=(0,d.BP)(e,t,"I know loss mnemonic will lose my wallet."),{jwt:r,jwtSecret:a}=f(s);if((null==(n=y(r,a))?void 0:n.address)===s.address)return localStorage.setItem("jwt",r),localStorage.setItem("jwtSecret",a),b(s),s}catch(e){console.log("登录失败:",e)}return null},ZeroAddress:i.j,createToken:b,pinyin:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(t.length<n)return!1;if(e.toLowerCase().includes(t.toLowerCase()))return!0;let s=(0,m.YW)(e,t,{continuous:!0});return!!s&&!!(s.length>=n)}}},22976:()=>{},48764:(e,t,n)=>{"use strict";n.d(t,{k:()=>o});var s=n(9482),r=n(65453),a=n(54205),i=n(6942);let o=(0,r.v)((e,t)=>({wallet:void 0,initWallet(){let n=localStorage.getItem("jwt"),r=localStorage.getItem("jwtSecret");if(n&&r){let a=s.A.verifyJWT(n,r);a?(s.A.createToken(a),e({wallet:a})):t().exit()}},async updateDot(t){let n=new URL(t).origin;try{let t=(await a.FH.get(n+"/dot",{timeout:3e3})).data;a.FH.defaults.baseURL=n,e({dotAPI:n}),localStorage.setItem("dotAPI",n);let s=t.CIDs[0];return n.endsWith(":1976")&&(s=n.slice(0,-5)+":8080"),s&&(e({dotCID:s}),localStorage.setItem("dotCID",s)),t.APIs}catch(t){i.notifications.show({title:"节点切换失败",message:n,color:"red"}),console.error(t),e({dotAPI:a.FH.defaults.baseURL||""})}return null},setItem:(t,n)=>e(e=>({...e,[t]:n})),firstPath:"",dotAPI:a.MN,dotCID:a.AF,dotNodes:[],exit(){e({wallet:void 0}),localStorage.removeItem("jwt"),localStorage.removeItem("jwtSecret"),localStorage.removeItem("token")},notes:[]}))},54205:(e,t,n)=>{"use strict";n.d(t,{AF:()=>a,C2:()=>i,FH:()=>o,MN:()=>r});var s=n(23464);let r="https://dot.most.red",a="https://cid.most.red",i="https://most.box/auth/callback",o=s.A.create({baseURL:r});o.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e},e=>Promise.reject(e))},71281:()=>{},76889:(e,t,n)=>{Promise.resolve().then(n.bind(n,91752))},80630:(e,t,n)=>{"use strict";n.d(t,{AppHeader:()=>c});var s=n(95155),r=n(70112),a=n(81001),i=n(58887),o=n(20042),l=n(7248);let c=e=>{let{title:t,right:n}=e,c=(0,l.h)();return(0,s.jsxs)(r.Group,{className:"app-header",children:[(0,s.jsx)(a.ActionIcon,{variant:"transparent",onClick:c,color:"--text-color",children:(0,s.jsx)(o.I,{name:"Back",size:24})}),(0,s.jsx)(i.Text,{lineClamp:2,variant:"gradient",children:t}),n||(0,s.jsx)(a.ActionIcon,{variant:"transparent",color:"--text-color",children:(0,s.jsx)(o.I,{name:"More",size:24})})]})}},91752:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});var s=n(95155),r=n(12115),a=n(80630),i=n(69604),o=n(91590),l=n(97287),c=n(21220),d=n(70112),m=n(8593),h=n(26903),x=n(70058),g=n(35049),u=n(93751),p=n(58887),j=n(15763),f=n(27361),y=n(81001),b=n(74634),w=n(89047),A=n(18403),T=n(26029),v=n(53776),I=n(59117),S=n(19215),k=n(6942),P=n(12257),z=n(33686),D=n(96482),C=n(41698),O=n(54476),B=n(54395),N=n(89586),_=n(30699),M=n(50828),U=n(2737),W=n(36655),G=n(9482),L=n(6874),H=n.n(L),R=n(48764);n(22976);let Y=[{inputs:[],name:"getAllDots",outputs:[{internalType:"address[]",name:"addresses",type:"address[]"},{internalType:"string[]",name:"names",type:"string[]"},{internalType:"uint256[]",name:"timestamps",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"dot",type:"address"}],name:"getDot",outputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string[]",name:"APIs",type:"string[]"},{internalType:"string[]",name:"CIDs",type:"string[]"},{internalType:"uint256",name:"update",type:"uint256"}],stateMutability:"view",type:"function"}];function F(){let[e,t]=(0,r.useState)(!1),[n,L]=(0,r.useState)([]),[F,E]=(0,r.useState)(""),q=(0,R.k)(e=>e.setItem),J=(0,R.k)(e=>e.dotAPI),K=(0,R.k)(e=>e.dotNodes),X=(0,R.k)(e=>e.updateDot),[Q,Z]=(0,r.useState)(!0),[$,V]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(null),[en,es]=(0,r.useState)("testnet"),[er,ea]=(0,r.useState)(null),ei={mainnet:{rpc:"https://mainnet.base.org",name:"Base 主网",color:"blue",explorer:"https://basescan.org"},testnet:{rpc:"https://sepolia.base.org",name:"Base 测试网",color:"orange",explorer:"https://sepolia.basescan.org"}},eo=ei[en].rpc,el=ei[en].explorer,ec=async()=>{t(!0);let e=await X(F);e&&L(e),t(!1)},ed=async e=>{if(!e.APIs||0===e.APIs.length)return void k.notifications.show({title:"切换失败",message:"该节点没有可用的API地址",color:"red"});ea(e.address);try{let t=e.APIs[0],n=await X(t);n&&(L(n),k.notifications.show({title:"节点切换成功",message:"已切换到 ".concat(e.name),color:"green"}))}catch(e){console.error(e),k.notifications.show({title:"切换失败",message:"无法连接到该节点",color:"red"})}finally{ea(null)}},em=async()=>{try{Z(!0),et(null);let e=new I.FR(eo),t=new S.NZ("0xdc82cef1a8416210afb87caeec908a4df843f016",Y,e),[n,s,r]=await t.getAllDots(),a=n.map(async(e,n)=>{let[a,i,o,l]=await t.getDot(e);return{address:e,name:a||s[n]||"节点 ".concat(n+1),APIs:i||[],CIDs:o||[],lastUpdate:Number(l||r[n])}}),i=await Promise.all(a);q("dotNodes",i)}catch(e){console.error("获取节点列表失败:",e),et("获取节点列表失败，请检查网络连接"),k.notifications.show({title:"获取失败",message:"无法获取节点列表",color:"red"})}finally{Z(!1)}},eh=async()=>{V(!0);try{let e=await Promise.all(K.map(async e=>{let{isOnline:t,responseTime:n}=await new Promise(t=>{if(!e.APIs||0===e.APIs.length)return void t({isOnline:!1,responseTime:0});let n=e.APIs[0],s=Date.now(),r=new AbortController,a=setTimeout(()=>r.abort(),3e3);fetch("".concat(n,"/dot"),{method:"GET",signal:r.signal,mode:"cors"}).then(()=>{clearTimeout(a),t({isOnline:!0,responseTime:Date.now()-s})}).catch(()=>{clearTimeout(a),t({isOnline:!1,responseTime:Date.now()-s})})});return{...e,isOnline:t,responseTime:n}}));q("dotNodes",e);let t=e.filter(e=>e.isOnline).length;k.notifications.show({title:"连通性检测完成",message:"".concat(t,"/").concat(e.length," 个节点在线"),color:t>0?"green":"orange"})}catch(e){console.log("连通性检测失败:",e),k.notifications.show({title:"检测失败",message:"连通性检测过程中出现错误",color:"red"})}finally{V(!1)}},ex=e=>{var t;return null==(t=e.APIs.find(e=>e.endsWith(":1976")))?void 0:t.replace(":1976",":8080/ipfs")},eg=e=>e.APIs.some(e=>{try{return new URL(e).origin===new URL(J).origin}catch(e){return!1}});(0,r.useEffect)(()=>{0===K.length?em():Z(!1)},[]);let eu=K.filter(e=>e.isOnline),ep=K.filter(e=>!1===e.isOnline);return(0,s.jsxs)(i.Box,{id:"page-dot",py:64,children:[(0,s.jsx)(a.AppHeader,{title:"节点管理"}),(0,s.jsxs)(o.Container,{size:"lg",py:"md",children:[(0,s.jsx)(l.Paper,{shadow:"sm",p:"lg",radius:"md",mb:"lg",children:(0,s.jsxs)(c.Stack,{className:"container",align:"center",gap:0,children:[(0,s.jsx)("h1",{children:"DOT.MOST.BOX"}),n.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"已成功接入节点"}),(0,s.jsx)(c.Stack,{justify:"center",children:n.map((e,t)=>(0,s.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e},t))})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"当前节点"}),(0,s.jsx)("a",{href:J,target:"_blank",rel:"noopener noreferrer",children:J})]}),(0,s.jsx)("p",{children:"為 全 人 類 徹 底 解 放 奮 鬥 終 身"}),(0,s.jsx)(H(),{href:"/dot/files",children:"查看我的文件"}),(0,s.jsxs)(d.Group,{mt:"lg",children:[(0,s.jsx)(m.TextInput,{leftSection:(0,s.jsx)(z.A,{}),value:F,onChange:e=>E(e.currentTarget.value),placeholder:"自定义节点地址"}),(0,s.jsx)(h.Button,{onClick:ec,loading:e,children:"自定义"})]})]})}),(0,s.jsx)(l.Paper,{shadow:"sm",p:"lg",radius:"md",mb:"lg",children:(0,s.jsxs)(x.Flex,{justify:"space-between",align:"center",wrap:"wrap",gap:"md",children:[(0,s.jsxs)(d.Group,{children:[(0,s.jsx)(g.ThemeIcon,{size:40,radius:"md",variant:"light",color:"blue",children:(0,s.jsx)(D.A,{size:20})}),(0,s.jsxs)(i.Box,{children:[(0,s.jsx)(u.Title,{order:2,children:"节点列表"}),(0,s.jsxs)(p.Text,{size:"sm",c:"dimmed",children:["共 ",K.length," 个节点",K.some(e=>void 0!==e.isOnline)&&(0,s.jsxs)(s.Fragment,{children:[" ","• ",eu.length," 在线 • ",ep.length," 离线"]})]})]})]}),(0,s.jsxs)(d.Group,{children:[(0,s.jsx)(j.Select,{value:en,onChange:e=>{e&&("mainnet"===e||"testnet"===e)&&(es(e),em(),k.notifications.show({title:"网络已切换",message:"已切换到 ".concat(ei[e].name),color:ei[e].color,icon:(0,s.jsx)(P.A,{size:16})}))},data:[{value:"testnet",label:"\uD83E\uDDEA Base 测试网"},{value:"mainnet",label:"\uD83C\uDF10 Base 主网"}],leftSection:(0,s.jsx)(P.A,{size:16}),variant:"filled",radius:"md",w:180}),(0,s.jsx)(f.Tooltip,{label:"刷新节点列表",children:(0,s.jsx)(y.ActionIcon,{size:"lg",variant:"light",color:"blue",onClick:em,loading:Q,children:(0,s.jsx)(C.A,{size:18})})}),(0,s.jsx)(h.Button,{leftSection:(0,s.jsx)(O.A,{size:16}),onClick:eh,loading:$,disabled:0===K.length,variant:"gradient",gradient:{from:"blue",to:"cyan"},children:"检测连通性"})]})]})}),Q?(0,s.jsxs)(l.Paper,{p:"xl",radius:"md",style:{textAlign:"center"},children:[(0,s.jsx)(g.ThemeIcon,{size:60,radius:"xl",variant:"light",color:"blue",mb:"md",children:(0,s.jsx)(D.A,{size:30})}),(0,s.jsx)(u.Title,{order:3,c:"dimmed",children:"正在加载节点列表..."}),(0,s.jsx)(p.Text,{size:"sm",c:"dimmed",mt:"xs",children:"请稍候，正在从区块链获取数据"})]}):ee?(0,s.jsxs)(l.Paper,{shadow:"sm",p:"xl",radius:"md",children:[(0,s.jsx)(b.Alert,{color:"red",title:"加载失败",icon:(0,s.jsx)(B.A,{size:16}),children:ee}),(0,s.jsx)(h.Button,{mt:"md",onClick:em,leftSection:(0,s.jsx)(C.A,{size:16}),variant:"light",color:"red",children:"重新加载"})]}):0===K.length?(0,s.jsxs)(l.Paper,{shadow:"sm",p:"xl",radius:"md",style:{textAlign:"center"},children:[(0,s.jsx)(g.ThemeIcon,{size:60,radius:"xl",variant:"light",color:"gray",mb:"md",children:(0,s.jsx)(D.A,{size:30})}),(0,s.jsx)(u.Title,{order:3,c:"dimmed",mb:"xs",children:"暂无节点"}),(0,s.jsx)(p.Text,{size:"sm",c:"dimmed",children:"当前网络没有注册的节点"})]}):(0,s.jsx)(w.Grid,{children:K.map(e=>{var t,n;return(0,s.jsx)(w.Grid.Col,{span:"auto",children:(0,s.jsxs)(A.Card,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,h:"100%",w:343,style:{transition:"transform 0.2s ease, box-shadow 0.2s ease",border:eg(e)?"2px solid #228be6":void 0},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 20px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=""},children:[(0,s.jsxs)(d.Group,{justify:"space-between",mb:"md",children:[(0,s.jsxs)(d.Group,{children:[(0,s.jsx)(g.ThemeIcon,{size:36,radius:"md",variant:"light",color:e.isOnline?"green":!1===e.isOnline?"red":"gray",children:e.isOnline?(0,s.jsx)(O.A,{size:18}):!1===e.isOnline?(0,s.jsx)(N.A,{size:18}):(0,s.jsx)(D.A,{size:18})}),(0,s.jsxs)(i.Box,{children:[(0,s.jsxs)(d.Group,{gap:"xs",children:[(0,s.jsx)(p.Text,{fw:600,size:"md",lineClamp:1,children:e.name}),eg(e)&&(0,s.jsx)(T.Badge,{size:"xs",color:"blue",variant:"filled",children:"当前"})]}),(0,s.jsx)(p.Text,{size:"xs",c:"dimmed",children:"节点地址"})]})]}),void 0!==e.isOnline&&(0,s.jsxs)(T.Badge,{color:e.isOnline?"green":"red",variant:"light",leftSection:e.isOnline?(0,s.jsx)(_.A,{size:12}):(0,s.jsx)(B.A,{size:12}),children:[e.isOnline?"在线":"离线",void 0!==e.responseTime&&" (".concat(void 0===(t=e.responseTime)?"":"".concat(t,"ms"),")")]})]}),(0,s.jsx)(v.Divider,{mb:"md"}),(0,s.jsxs)(c.Stack,{gap:"sm",children:[(0,s.jsxs)(d.Group,{gap:"xs",wrap:"nowrap",children:[(0,s.jsx)(M.A,{size:14,color:"gray",style:{flexShrink:0}}),(0,s.jsx)(p.Text,{size:"xs",c:"dimmed",children:G.A.formatAddress(e.address)})]}),(0,s.jsxs)(d.Group,{gap:"xs",children:[(0,s.jsx)(U.A,{size:14,color:"gray"}),(0,s.jsx)(p.Text,{size:"xs",c:"dimmed",children:(n=e.lastUpdate)?new Date(1e3*n).toLocaleString("zh-CN"):"未知"})]}),e.APIs.length>0&&(0,s.jsx)(c.Stack,{gap:2,align:"flex-start",children:e.APIs.map((e,t)=>(0,s.jsx)(p.Text,{c:"blue",component:"a",href:e,target:"_blank",style:{textDecoration:"none"},lineClamp:1,children:e},t))}),(0,s.jsxs)(i.Box,{children:[(0,s.jsx)(p.Text,{size:"xs",fw:500,mb:4,c:"gray",children:"CID 浏览器"}),(0,s.jsxs)(d.Group,{gap:2,align:"flex-start",children:[e.CIDs.map((e,t)=>(0,s.jsx)(p.Text,{c:"blue",component:"a",href:e+"/ipfs",target:"_blank",style:{textDecoration:"none"},lineClamp:1,children:e+"/ipfs"},t)),ex(e)&&(0,s.jsx)(p.Text,{c:"blue",component:"a",href:ex(e),target:"_blank",style:{textDecoration:"none"},lineClamp:1,children:ex(e)})]})]}),(0,s.jsx)(h.Button,{fullWidth:!0,variant:eg(e)?"filled":"light",color:eg(e)?"green":"blue",leftSection:(0,s.jsx)(W.A,{size:16}),onClick:()=>ed(e),loading:er===e.address,disabled:eg(e)||!e.APIs.length,mt:"sm",children:eg(e)?"当前节点":"切换到此节点"})]})]})},e.address)})}),(0,s.jsxs)(d.Group,{gap:"xs",mt:"lg",justify:"center",children:[(0,s.jsx)(p.Text,{size:"sm",c:"blue",component:"a",href:"https://docs.base.org/chain/connecting-to-base",target:"_blank",style:{textDecoration:"none"},children:"官方 RPC"}),(0,s.jsx)(p.Text,{size:"sm",c:"blue",component:"a",href:"https://chainlist.org/chain/8453",target:"_blank",style:{textDecoration:"none"},children:"主网 RPC"}),(0,s.jsx)(p.Text,{size:"sm",c:"blue",component:"a",href:"https://chainlist.org/chain/84532",target:"_blank",style:{textDecoration:"none"},children:"测试网 RPC"}),(0,s.jsx)(p.Text,{size:"sm",c:"blue",component:"a",href:"https://docs.base.org/chain/network-faucets",target:"_blank",style:{textDecoration:"none"},children:"水龙头列表"}),(0,s.jsx)(p.Text,{size:"sm",c:"blue",component:"a",href:"https://portal.cdp.coinbase.com/products/faucet?projectId=0b869244-5000-43dd-8aba-c9feee07f6ab",target:"_blank",style:{textDecoration:"none"},children:"注册领水"}),(0,s.jsx)(p.Text,{size:"sm",c:"blue",component:"a",href:el+"/address/0xdc82cef1a8416210afb87caeec908a4df843f016",target:"_blank",style:{textDecoration:"none"},children:"合约地址"})]})]})]})}}},e=>{e.O(0,[9803,2545,8198,8887,9549,4291,4853,5483,2828,8694,5604,6206,6874,8925,5776,9117,5938,42,8441,5881,7358],()=>e(e.s=76889)),_N_E=e.O()}]);