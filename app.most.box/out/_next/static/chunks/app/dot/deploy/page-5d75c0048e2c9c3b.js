(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6988],{19894:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>S});var a=o(95155),s=o(12115),i=o(80630),n=o(21220),l=o(26903),r=o(79382),c=o(93695),d=o(58887),u=o(6942),h=o(1973),w=o(62037),g=o(35695),f=o(15133),p=o(6830),m=o(17187),y=o(23464),x=o(6874),k=o.n(x);let j=e=>{let{dotApi:t}=e,o=(0,g.useRouter)(),[i,r]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),w=i||c,m=async e=>{try{var a;(null==(a=(await (0,y.A)({method:"put",url:t+"/api.deploy",headers:{Authorization:e}})).data)?void 0:a.ok)&&(u.notifications.show({color:"green",title:"提示",message:"部署成功"}),o.back())}catch(e){console.error(e),u.notifications.show({color:"red",title:"提示",message:"部署失败"})}},x=async e=>{try{var o;(null==(o=(await (0,y.A)({method:"put",url:t+"/api.reload",headers:{Authorization:e}})).data)?void 0:o.ok)&&u.notifications.show({color:"green",title:"提示",message:"重启成功"})}catch(e){console.error(e),u.notifications.show({color:"red",title:"提示",message:"重启失败"})}},k=async e=>{let t=Date.now().toString(),o=window.ethereum;if(o)try{"deploy"===e?r(!0):d(!0);let a=new h.k(o),s=await a.getSigner(),i=await s.signMessage(t),n=[s.address,t,i].join(".");"deploy"===e?await m(n):await x(n)}catch(e){u.notifications.show({color:"red",title:"提示",message:"签名失败"})}finally{"deploy"===e?r(!1):d(!1)}};return(0,a.jsxs)(n.Stack,{children:[(0,a.jsx)(l.Button,{leftSection:(0,a.jsx)(f.A,{}),variant:"gradient",disabled:w,loading:i,loaderProps:{type:"dots"},onClick:()=>k("deploy"),children:"签名部署"}),(0,a.jsx)(l.Button,{leftSection:(0,a.jsx)(p.A,{}),variant:"outline",disabled:w,loading:c,loaderProps:{type:"dots"},onClick:()=>k("reload"),children:"签名重启"})]})};function S(){let e=(0,g.useRouter)(),[t,o]=(0,s.useState)(!1),[h,f]=(0,s.useState)(""),[p,y]=(0,s.useState)(""),[x,S]=(0,s.useState)(""),[v,A]=(0,s.useState)("");(0,s.useEffect)(()=>{let t=new URLSearchParams(window.location.search),o=t.get("address"),a=t.get("api");o&&a?(y(o),S(a),A(a+window.location.pathname+window.location.search)):e.back()},[]);let b=async()=>{let e=window.ethereum;if(e)try{o(!0);let t=await e.request({method:"eth_requestAccounts"});if(t&&t.length>0){let e=(0,w.b)(t[0]);f(e)}}catch(e){u.notifications.show({title:"提示",message:e.message||"连接失败"})}finally{o(!1)}else u.notifications.show({title:"提示",message:"请先安装 OKX Wallet"});return null},_=async()=>{var e;let t=null==(e=window)?void 0:e.ethereum;t&&t.on("accountsChanged",e=>{e&&e.length>0?f((0,w.b)(e[0])):f("")})};return(0,s.useEffect)(()=>{_()},[]),(0,a.jsxs)(n.Stack,{px:"md",children:[(0,a.jsx)(i.AppHeader,{title:"更新节点代码"}),(0,a.jsxs)(r.Blockquote,{icon:(0,a.jsx)(m.A,{}),mt:"xl",children:["节点地址：",(0,a.jsx)(c.Anchor,{component:k(),href:v,target:"_blank",children:x})]}),h?(0,a.jsx)(d.Text,{fw:700,variant:"gradient",gradient:{from:"blue",to:"cyan",deg:90},onClick:()=>{u.notifications.show({title:"提示",message:"请在钱包插件中切换账号"})},children:h}):(0,a.jsx)(l.Button,{variant:"default",loading:t,loaderProps:{type:"dots"},onClick:b,children:"连接钱包"}),h&&(0,a.jsx)(a.Fragment,{children:x&&p===h?(0,a.jsx)(j,{dotApi:x}):(0,a.jsxs)(r.Blockquote,{color:"gray",cite:"most-people.com",icon:(0,a.jsx)(m.A,{}),mt:"xl",children:["请连接钱包：",p]})})]})}},40584:(e,t,o)=>{Promise.resolve().then(o.bind(o,19894))}},e=>{e.O(0,[4771,8805,3464,6874,9117,2908,630,8441,5964,7358],()=>e(e.s=40584)),_N_E=e.O()}]);