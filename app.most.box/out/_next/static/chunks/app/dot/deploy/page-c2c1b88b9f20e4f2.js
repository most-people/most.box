(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6988],{19894:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(95155),o=s(12115),i=s(80630),n=s(26903),l=s(21220),r=s(57001),c=s(6942),d=s(1973),u=s(62037),h=s(35695),g=s(17187),w=s(23464);let f=e=>{let{dotApi:t}=e,s=(0,h.useRouter)(),[i,l]=(0,o.useState)(!1),r=async e=>{try{var a;(null==(a=(await (0,w.A)({method:"put",url:t+"/api.deploy",headers:{Authorization:e}})).data)?void 0:a.ok)&&(c.notifications.show({color:"green",title:"提示",message:"部署成功"}),s.back())}catch(e){console.error(e),c.notifications.show({color:"red",title:"提示",message:"部署失败"})}},u=async()=>{let e=Date.now().toString(),t=window.ethereum;if(t)try{l(!0);let s=new d.k(t),a=await s.getSigner(),o=await a.signMessage(e),i=[a.address,e,o].join(".");await r(i)}catch(e){c.notifications.show({color:"red",title:"提示",message:"签名失败"})}finally{l(!1)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(n.Button,{variant:"gradient",loading:i,loaderProps:{type:"dots"},onClick:u,children:"签名部署"})})};function m(){let e=(0,h.useRouter)(),[t,s]=(0,o.useState)(!1),[d,w]=(0,o.useState)(""),[m,p]=(0,o.useState)(""),[k,x]=(0,o.useState)("");(0,o.useEffect)(()=>{let t=new URLSearchParams(window.location.search),s=t.get("address"),a=t.get("api");s&&a?(p(s),x(a)):e.back()},[]);let j=async()=>{let e=window.ethereum;if(e)try{s(!0);let t=await e.request({method:"eth_requestAccounts"});if(t&&t.length>0){let e=(0,u.b)(t[0]);w(e)}}catch(e){c.notifications.show({title:"提示",message:e.message||"连接失败"})}finally{s(!1)}else c.notifications.show({title:"提示",message:"请先安装 OKX Wallet"});return null},y=async()=>{var e;let t=null==(e=window)?void 0:e.ethereum;t&&t.on("accountsChanged",e=>{e&&e.length>0?w((0,u.b)(e[0])):w("")})};return(0,o.useEffect)(()=>{y()},[]),(0,a.jsxs)(l.Stack,{children:[(0,a.jsx)(i.AppHeader,{title:"更新节点代码"}),(0,a.jsxs)(r.Blockquote,{icon:(0,a.jsx)(g.A,{}),mt:"xl",children:["节点地址：",k]}),d?(0,a.jsx)(n.Button,{variant:"default",onClick:()=>{c.notifications.show({title:"提示",message:"请在钱包插件中切换账号"})},children:d}):(0,a.jsx)(n.Button,{variant:"default",loading:t,loaderProps:{type:"dots"},onClick:j,children:"连接钱包"}),d&&(0,a.jsx)(a.Fragment,{children:k&&m===d?(0,a.jsx)(f,{dotApi:k}):(0,a.jsxs)(r.Blockquote,{color:"gray",cite:"most-people.com",icon:(0,a.jsx)(g.A,{}),mt:"xl",children:["请连接钱包：",m]})})]})}},40584:(e,t,s)=>{Promise.resolve().then(s.bind(s,19894))}},e=>{e.O(0,[6748,8805,3464,9117,4178,630,8441,5964,7358],()=>e(e.s=40584)),_N_E=e.O()}]);