(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6988],{40584:(e,t,o)=>{Promise.resolve().then(o.bind(o,66799))},66799:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>b});var a=o(95155),n=o(12115),i=o(90101),s=o(40387),r=o(70305),l=o(2369),c=o(96778),d=o(72110),h=o(77147),u=o(59126),w=o(51012),g=o(89550),m=o(20063),f=o(4200),x=o(35297),p=o(67812),y=o(95125),j=o(52619),k=o.n(j),S=o(90982);let A=e=>{let{dotApi:t}=e,[o,i]=(0,n.useState)(!1),[d,h]=(0,n.useState)(!1),[g,m]=(0,n.useState)(!1);(0,n.useEffect)(()=>{null!==new URLSearchParams(window.location.search).get("reload")&&m(!0)},[]);let p=o||d,j=async e=>{try{var o;(null==(o=(await (0,y.A)({method:"put",url:t+"/api.deploy",headers:{Authorization:e}})).data)?void 0:o.ok)&&S.modals.open({centered:!0,children:(0,a.jsx)(s.Center,{children:(0,a.jsx)(r.Text,{c:"green",children:"部署成功"})}),withCloseButton:!1})}catch(e){console.error(e),u.notifications.show({color:"red",title:"提示",message:"部署失败"})}},k=async e=>{try{var o;(null==(o=(await (0,y.A)({method:"put",url:t+"/api.reload",headers:{Authorization:e}})).data)?void 0:o.ok)&&u.notifications.show({color:"green",title:"提示",message:"重启成功"})}catch(e){console.error(e),u.notifications.show({color:"red",title:"提示",message:"重启失败"})}},A=async e=>{let t=Date.now().toString(),o=window.okexchain||window.ethereum;if(o)try{"deploy"===e?i(!0):h(!0);let a=new w.k(o),n=await a.getSigner(),s=await n.signMessage(t),r=[n.address,t,s].join(".");"deploy"===e?await j(r):await k(r)}catch(e){u.notifications.show({color:"red",title:"提示",message:"签名失败"})}finally{"deploy"===e?i(!1):h(!1)}};return(0,a.jsxs)(l.Stack,{children:[(0,a.jsx)(c.Button,{leftSection:(0,a.jsx)(f.A,{}),variant:"gradient",disabled:p,loading:o,loaderProps:{type:"dots"},onClick:()=>A("deploy"),children:"签名部署"}),g&&(0,a.jsx)(c.Button,{leftSection:(0,a.jsx)(x.A,{}),variant:"outline",disabled:p,loading:d,loaderProps:{type:"dots"},onClick:()=>A("reload"),children:"签名重启"})]})};function b(){let e=(0,m.useRouter)(),[t,o]=(0,n.useState)(!1),[s,w]=(0,n.useState)(""),[f,x]=(0,n.useState)(""),[y,j]=(0,n.useState)(""),[S,b]=(0,n.useState)(""),[v,C]=(0,n.useState)("");(0,n.useEffect)(()=>{let t=new URLSearchParams(window.location.search),o=t.get("address"),a=t.get("api");o&&a?(x(o),j(a),C(a+window.location.pathname+window.location.search),fetch(a+"/api.git").then(e=>e.text()).then(e=>{let t=e.match(/origin\s+(.+?)\s+\(fetch\)/);if(t)try{b(t[1])}catch(e){}})):e.back()},[]);let _=async()=>{let e=window.okexchain||window.ethereum;if(e)try{o(!0);let t=await e.request({method:"eth_requestAccounts"});if(t&&t.length>0){let e=(0,g.b)(t[0]);w(e)}}catch(e){u.notifications.show({title:"提示",message:e.message||"连接失败"})}finally{o(!1)}else u.notifications.show({title:"提示",message:"请先安装 OKX Wallet"});return null},B=async()=>{let e=window.okexchain||window.ethereum;e&&e.on("accountsChanged",e=>{e&&e.length>0?w((0,g.b)(e[0])):w("")})};return(0,n.useEffect)(()=>{B()},[]),(0,a.jsxs)(l.Stack,{px:"md",children:[(0,a.jsx)(i.AppHeader,{title:"更新节点代码"}),(0,a.jsxs)(d.Blockquote,{icon:(0,a.jsx)(p.A,{}),mt:"xl",children:[(0,a.jsxs)(r.Text,{children:["节点地址：",(0,a.jsx)(h.Anchor,{component:k(),href:v,target:"_blank",children:y})]}),(0,a.jsxs)(r.Text,{mt:"md",c:"dimmed",children:["开源代码：",S]})]}),s?(0,a.jsx)(r.Text,{fw:700,variant:"gradient",gradient:{from:"blue",to:"cyan",deg:90},onClick:()=>{u.notifications.show({title:"提示",message:"请在钱包插件中切换账号"})},children:s}):(0,a.jsx)(c.Button,{variant:"default",loading:t,loaderProps:{type:"dots"},onClick:_,children:"连接钱包"}),s&&(0,a.jsx)(a.Fragment,{children:y&&f===s?(0,a.jsx)(A,{dotApi:y}):(0,a.jsxs)(d.Blockquote,{color:"gray",cite:"most-people.com",icon:(0,a.jsx)(p.A,{}),mt:"xl",children:["请连接钱包：",f]})})]})}}},e=>{e.O(0,[2829,5619,5125,3252,8835,7257,101,8441,1255,7358],()=>e(e.s=40584)),_N_E=e.O()}]);