(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6988],{7248:(e,t,a)=>{"use strict";a.d(t,{h:()=>n});var s=a(35695);let n=()=>{let e=(0,s.useRouter)(),t=(0,s.usePathname)();return()=>{sessionStorage.firstPath===t?(sessionStorage.firstPath="/",e.replace("/")):e.back()}}},19894:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var s=a(95155),n=a(12115),o=a(80630),r=a(26903),i=a(21220),l=a(79382),c=a(6942),d=a(1973),u=a(62037),h=a(35695),g=a(17187),m=a(23464);let p=e=>{let{dotApi:t}=e,a=(0,h.useRouter)(),[o,i]=(0,n.useState)(!1),l=async e=>{try{var s;(null==(s=(await (0,m.A)({method:"put",url:t+"/api.deploy",headers:{Authorization:e}})).data)?void 0:s.ok)&&(c.notifications.show({color:"green",title:"提示",message:"部署成功"}),a.back())}catch(e){console.error(e),c.notifications.show({color:"red",title:"提示",message:"部署失败"})}},u=async()=>{let e=Date.now().toString(),t=window.ethereum;if(t)try{i(!0);let a=new d.k(t),s=await a.getSigner(),n=await s.signMessage(e),o=[s.address,e,n].join(".");await l(o)}catch(e){c.notifications.show({color:"red",title:"提示",message:"签名失败"})}finally{i(!1)}};return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(r.Button,{variant:"gradient",loading:o,loaderProps:{type:"dots"},onClick:u,children:"签名部署"})})};function w(){let e=(0,h.useRouter)(),[t,a]=(0,n.useState)(!1),[d,m]=(0,n.useState)(""),[w,f]=(0,n.useState)(""),[x,j]=(0,n.useState)("");(0,n.useEffect)(()=>{let t=new URLSearchParams(window.location.search),a=t.get("address"),s=t.get("api");a&&s?(f(a),j(s)):e.back()},[]);let k=async()=>{let e=window.ethereum;if(e)try{a(!0);let t=await e.request({method:"eth_requestAccounts"});if(t&&t.length>0){let e=(0,u.b)(t[0]);m(e)}}catch(e){c.notifications.show({title:"提示",message:e.message||"连接失败"})}finally{a(!1)}else c.notifications.show({title:"提示",message:"请先安装 OKX Wallet"});return null},v=async()=>{var e;let t=null==(e=window)?void 0:e.ethereum;t&&t.on("accountsChanged",e=>{e&&e.length>0?m((0,u.b)(e[0])):m("")})};return(0,n.useEffect)(()=>{v()},[]),(0,s.jsxs)(i.Stack,{children:[(0,s.jsx)(o.AppHeader,{title:"更新节点代码"}),(0,s.jsxs)(l.Blockquote,{icon:(0,s.jsx)(g.A,{}),mt:"xl",children:["节点地址：",x]}),d?(0,s.jsx)(r.Button,{variant:"default",onClick:()=>{c.notifications.show({title:"提示",message:"请在钱包插件中切换账号"})},children:d}):(0,s.jsx)(r.Button,{variant:"default",loading:t,loaderProps:{type:"dots"},onClick:k,children:"连接钱包"}),d&&(0,s.jsx)(s.Fragment,{children:x&&w===d?(0,s.jsx)(p,{dotApi:x}):(0,s.jsxs)(l.Blockquote,{color:"gray",cite:"most-people.com",icon:(0,s.jsx)(g.A,{}),mt:"xl",children:["请连接钱包：",w]})})]})}},40584:(e,t,a)=>{Promise.resolve().then(a.bind(a,19894))},80630:(e,t,a)=>{"use strict";a.d(t,{AppHeader:()=>c});var s=a(95155),n=a(70112),o=a(81001),r=a(58887),i=a(20042),l=a(7248);let c=e=>{let{title:t,right:a}=e,c=(0,l.h)();return(0,s.jsxs)(n.Group,{className:"app-header",children:[(0,s.jsx)(o.ActionIcon,{variant:"transparent",onClick:c,color:"--text-color",children:(0,s.jsx)(i.I,{name:"Back",size:24})}),(0,s.jsx)(r.Text,{lineClamp:2,variant:"gradient",children:t}),a||(0,s.jsx)(o.ActionIcon,{variant:"transparent",color:"--text-color",children:(0,s.jsx)(i.I,{name:"More",size:24})})]})}}},e=>{e.O(0,[8887,9549,8805,3464,9117,1171,42,8441,5881,7358],()=>e(e.s=40584)),_N_E=e.O()}]);