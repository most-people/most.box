(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6988],{19894:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var o=a(95155),n=a(12115),s=a(80630),i=a(26903),l=a(21220),r=a(57001),c=a(93695),d=a(6942),u=a(1973),h=a(62037),w=a(35695),g=a(17187),f=a(23464),m=a(6874),p=a.n(m);let k=e=>{let{dotApi:t}=e,a=(0,w.useRouter)(),[s,l]=(0,n.useState)(!1),r=async e=>{try{var o;(null==(o=(await (0,f.A)({method:"put",url:t+"/api.deploy",headers:{Authorization:e}})).data)?void 0:o.ok)&&(d.notifications.show({color:"green",title:"提示",message:"部署成功"}),a.back())}catch(e){console.error(e),d.notifications.show({color:"red",title:"提示",message:"部署失败"})}},c=async()=>{let e=Date.now().toString(),t=window.ethereum;if(t)try{l(!0);let a=new u.k(t),o=await a.getSigner(),n=await o.signMessage(e),s=[o.address,e,n].join(".");await r(s)}catch(e){d.notifications.show({color:"red",title:"提示",message:"签名失败"})}finally{l(!1)}};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(i.Button,{variant:"gradient",loading:s,loaderProps:{type:"dots"},onClick:c,children:"签名部署"})})};function x(){let e=(0,w.useRouter)(),[t,a]=(0,n.useState)(!1),[u,f]=(0,n.useState)(""),[m,x]=(0,n.useState)(""),[j,y]=(0,n.useState)(""),[S,v]=(0,n.useState)("");(0,n.useEffect)(()=>{let t=new URLSearchParams(window.location.search),a=t.get("address"),o=t.get("api");a&&o?(x(a),y(o),v(o+window.location.pathname+window.location.search)):e.back()},[]);let b=async()=>{let e=window.ethereum;if(e)try{a(!0);let t=await e.request({method:"eth_requestAccounts"});if(t&&t.length>0){let e=(0,h.b)(t[0]);f(e)}}catch(e){d.notifications.show({title:"提示",message:e.message||"连接失败"})}finally{a(!1)}else d.notifications.show({title:"提示",message:"请先安装 OKX Wallet"});return null},A=async()=>{var e;let t=null==(e=window)?void 0:e.ethereum;t&&t.on("accountsChanged",e=>{e&&e.length>0?f((0,h.b)(e[0])):f("")})};return(0,n.useEffect)(()=>{A()},[]),(0,o.jsxs)(l.Stack,{children:[(0,o.jsx)(s.AppHeader,{title:"更新节点代码"}),(0,o.jsxs)(r.Blockquote,{icon:(0,o.jsx)(g.A,{}),mt:"xl",children:["节点地址：",(0,o.jsx)(c.Anchor,{component:p(),href:S,target:"_blank",children:j})]}),u?(0,o.jsx)(i.Button,{variant:"default",onClick:()=>{d.notifications.show({title:"提示",message:"请在钱包插件中切换账号"})},children:u}):(0,o.jsx)(i.Button,{variant:"default",loading:t,loaderProps:{type:"dots"},onClick:b,children:"连接钱包"}),u&&(0,o.jsx)(o.Fragment,{children:j&&m===u?(0,o.jsx)(k,{dotApi:j}):(0,o.jsxs)(r.Blockquote,{color:"gray",cite:"most-people.com",icon:(0,o.jsx)(g.A,{}),mt:"xl",children:["请连接钱包：",m]})})]})}},40584:(e,t,a)=>{Promise.resolve().then(a.bind(a,19894))}},e=>{e.O(0,[6748,8805,3464,7244,9117,3042,630,8441,5964,7358],()=>e(e.s=40584)),_N_E=e.O()}]);