(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6141],{4498:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>K});var t=r(95155),i=r(90101),n=r(63090),o=r(13877),d=r(2369),c=r(44634),a=r(67661),l=r(78094),h=r(74264),x=r(58380),m=r(41970),p=r(70305),j=r(17998),u=r(18845),f=r(82726),g=r(67623),z=r(96778),T=r(47522),y=r(2186),w=r(77252),v=r(69367),b=r(7080),S=r(69424),G=r(1371),A=r(20921),k=r(44191),B=r(45600),P=r(86233),F=r(12115),C=r(59126);let D=[{name:"ThreeBody",type:"dhtserver",id:"12D3KooWEfhngz9JqycJXmrxtozE3qKvwBpTW8cusoU7SWixgeEc",ip:["/dns6/m1.most.box"]},{name:"SG1",type:"dhtserver",id:"12D3KooWK3Z55bUGEC8Rn8cfqFFMzy8LzHEFwitdsx3xX48LEJvA",ip:["/ip4/129.226.147.127","/dns4/sg1.most-people.com"]},{name:"DOT",type:"dhtserver",id:"12D3KooWBXK1mBkN8UY9UVEfkKJtaY8Xkb1YKZgBUTDRFnLAKGpV",ip:["/ip4/119.91.213.99","/dns4/dot.most.red"]},{name:"SG2",type:"dhtclient",id:"12D3KooWHNKz2FbXQzUGynYMyDpPHrEQSm2jkjzzW8t285tWbb41",ip:["/ip4/143.156.32.57","/dns4/sg2.most-people.com"]},{name:"Damon",type:"dhtclient",id:"12D3KooWNeNLV7D7qivHMX237XzyfMbzeQZyqbkizFcekKhDJiqR",ip:["/ip4/111.230.30.145","/dns4/damon.most.red"]},{name:"ZX",type:"dhtclient",id:"12D3KooWPen5b7dvQm9C2nmnVXad51FaxLWrwQch2H8fVNFfhoGW",ip:["/ip4/123.206.203.234","/dns4/zx-dot.most.red"]}],E="http://localhost:5001/api/v0";function K(){var e,s;let[r,K]=(0,F.useState)(null),[I,W]=(0,F.useState)([]),[O,L]=(0,F.useState)([]),[N,X]=(0,F.useState)(!1),[R,q]=(0,F.useState)(null);(0,F.useEffect)(()=>{L(D.map(e=>({node:e,found:!1,addresses:[],pingResults:[],status:"idle"})))},[]);let H=async()=>{try{let e=await fetch("".concat(E,"/id"),{method:"POST"});if(e.ok){let s=await e.json();return K(s),q(!0),!0}}catch(e){console.error("Failed to get node info:",e),q(!1)}return!1},J=async()=>{try{let e=await fetch("".concat(E,"/swarm/peers"),{method:"POST"});if(e.ok){let s=await e.json();return W(s.Peers||[]),s.Peers||[]}}catch(e){console.error("Failed to get swarm peers:",e)}return[]},U=async e=>{try{let s=await fetch("".concat(E,"/routing/findpeer?arg=").concat(e),{method:"POST"});if(s.ok){let e=await s.json();if(e.Responses&&e.Responses.length>0)return e.Responses[0]}}catch(e){console.error("Failed to find peer:",e)}return null},V=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;try{let r=await fetch("".concat(E,"/ping?arg=").concat(e,"&count=").concat(s),{method:"POST"});if(r.ok){let e=(await r.text()).trim().split("\n"),s=[];for(let r of e)try{let e=JSON.parse(r);s.push(e)}catch(e){}return s}}catch(e){console.error("Failed to ping peer:",e)}return[]},_=async e=>{let s=D[e];L(s=>s.map((s,r)=>r===e?{...s,status:"testing"}:s));try{let r=await U(s.id);if(r){let t=await V(s.id,3),i=t.filter(e=>e.Success&&e.Time>0),n=i.length>0?i.reduce((e,s)=>e+s.Time,0)/i.length/1e6:void 0;L(s=>s.map((s,i)=>i===e?{...s,found:!0,addresses:r.Addrs||[],pingResults:t,avgLatency:n,status:"success"}:s))}else L(s=>s.map((s,r)=>r===e?{...s,found:!1,addresses:[],pingResults:[],status:"error"}:s))}catch(r){console.error("Failed to test node ".concat(s.name,":"),r),L(s=>s.map((s,r)=>r===e?{...s,status:"error"}:s))}},Q=async()=>{X(!0);try{if(!await H()){C.notifications.show({title:"错误",message:"IPFS节点未运行或无法连接",color:"red"}),X(!1);return}await J();for(let e=0;e<D.length;e++)await _(e);C.notifications.show({title:"完成",message:"节点连接测试完成",color:"green"})}catch(e){console.info("Failed to test all nodes:",e),C.notifications.show({title:"错误",message:"测试过程中发生错误",color:"red"})}finally{X(!1)}},M=async()=>{X(!0),await H(),await J(),X(!1)};return(0,F.useEffect)(()=>{M()},[]),(0,t.jsxs)(o.Container,{py:20,children:[(0,t.jsx)(i.AppHeader,{title:"本地 IPFS 节点状态"}),(0,t.jsxs)(d.Stack,{gap:"md",children:[(0,t.jsxs)(c.Card,{withBorder:!0,children:[(0,t.jsxs)(a.Group,{justify:"space-between",mb:"md",children:[(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(l.ThemeIcon,{variant:"light",color:!0===R?"green":!1===R?"red":"gray",children:!0===R?(0,t.jsx)(v.A,{size:18}):!1===R?(0,t.jsx)(b.A,{size:18}):(0,t.jsx)(S.A,{size:18})}),(0,t.jsx)(h.Title,{order:4,children:"本地 IPFS 节点"})]}),(0,t.jsx)(x.ActionIcon,{variant:"subtle",onClick:M,loading:N,children:(0,t.jsx)(G.A,{size:16})})]}),!1===R?(0,t.jsx)(m.Alert,{color:"red",icon:(0,t.jsx)(y.A,{size:16}),children:"IPFS 节点未运行或无法连接到 http://127.0.0.1:5001"}):r?(0,t.jsxs)(d.Stack,{gap:"xs",children:[(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(p.Text,{size:"sm",c:"dimmed",children:"节点 ID:"}),(0,t.jsx)(p.Text,{size:"sm",ff:"monospace",children:r.ID})]}),(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(p.Text,{size:"sm",c:"dimmed",children:"版本:"}),(0,t.jsx)(p.Text,{size:"sm",children:r.AgentVersion})]}),(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(p.Text,{size:"sm",c:"dimmed",children:"协议数量:"}),(0,t.jsx)(j.Badge,{variant:"light",children:(null==(e=r.Protocols)?void 0:e.length)||0})]}),(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(p.Text,{size:"sm",c:"dimmed",children:"地址数量:"}),(0,t.jsx)(j.Badge,{variant:"light",children:(null==(s=r.Addresses)?void 0:s.length)||0})]})]}):(0,t.jsx)(n.Loader,{size:"sm"})]}),(0,t.jsxs)(c.Card,{withBorder:!0,children:[(0,t.jsxs)(a.Group,{justify:"space-between",mb:"md",children:[(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(l.ThemeIcon,{variant:"light",color:"blue",children:(0,t.jsx)(A.A,{size:18})}),(0,t.jsx)(h.Title,{order:4,children:"对等节点"})]}),(0,t.jsxs)(j.Badge,{variant:"light",size:"lg",children:[I.length," 个连接"]})]}),I.length>0?(0,t.jsx)(u.ScrollArea,{h:200,children:(0,t.jsx)(d.Stack,{gap:"xs",children:I.map((e,s)=>(0,t.jsx)(f.Paper,{p:"xs",withBorder:!0,children:(0,t.jsx)(a.Group,{justify:"space-between",children:(0,t.jsxs)(g.Box,{flex:1,children:[(0,t.jsx)(p.Text,{size:"xs",ff:"monospace",lineClamp:1,children:e.Peer}),(0,t.jsx)(p.Text,{size:"xs",c:"dimmed",lineClamp:1,children:e.Addr})]})})},s))})}):(0,t.jsx)(p.Text,{c:"dimmed",ta:"center",children:"暂无连接的对等节点"})]}),(0,t.jsxs)(c.Card,{withBorder:!0,children:[(0,t.jsxs)(a.Group,{justify:"space-between",mb:"md",children:[(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(l.ThemeIcon,{variant:"light",color:"violet",children:(0,t.jsx)(k.A,{size:18})}),(0,t.jsx)(h.Title,{order:4,children:"自定义节点测试"})]}),(0,t.jsx)(z.Button,{size:"sm",onClick:Q,loading:N,leftSection:(0,t.jsx)(G.A,{size:16}),children:"测试所有节点"})]}),(0,t.jsx)(d.Stack,{gap:"sm",children:O.map((e,s)=>(0,t.jsxs)(f.Paper,{p:"md",withBorder:!0,children:[(0,t.jsxs)(a.Group,{justify:"space-between",mb:"sm",children:[(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(j.Badge,{variant:"light",color:"dhtserver"===e.node.type?"blue":"green",children:e.node.type}),(0,t.jsx)(p.Text,{fw:500,children:e.node.name})]}),(0,t.jsxs)(a.Group,{children:[e.avgLatency&&(0,t.jsxs)(a.Group,{gap:4,children:[(0,t.jsx)(B.A,{size:14}),(0,t.jsxs)(p.Text,{size:"sm",children:[e.avgLatency.toFixed(2),"ms"]})]}),(e=>{switch(e){case"success":return(0,t.jsx)(T.A,{size:16,color:"green"});case"error":return(0,t.jsx)(y.A,{size:16,color:"red"});case"testing":return(0,t.jsx)(n.Loader,{size:16});default:return(0,t.jsx)(w.A,{size:16,color:"gray"})}})(e.status),(0,t.jsx)(z.Button,{size:"xs",variant:"subtle",onClick:()=>_(s),loading:"testing"===e.status,children:"测试"})]})]}),(0,t.jsx)(p.Text,{size:"xs",c:"dimmed",ff:"monospace",mb:"xs",children:e.node.id}),e.found&&e.addresses.length>0&&(0,t.jsxs)(d.Stack,{gap:4,children:[(0,t.jsx)(p.Text,{size:"sm",fw:500,children:"发现的地址:"}),e.addresses.map((e,s)=>(0,t.jsx)(p.Text,{size:"xs",ff:"monospace",c:"dimmed",children:e},s))]}),"error"===e.status&&!e.found&&(0,t.jsx)(m.Alert,{color:"red",children:"无法找到或连接到此节点"})]},e.node.id))})]}),(0,t.jsxs)(c.Card,{withBorder:!0,children:[(0,t.jsxs)(a.Group,{mb:"md",children:[(0,t.jsx)(l.ThemeIcon,{variant:"light",color:"gray",children:(0,t.jsx)(P.A,{size:18})}),(0,t.jsx)(h.Title,{order:4,children:"使用的 API"})]}),(0,t.jsxs)(d.Stack,{gap:"xs",children:[(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(j.Badge,{variant:"dot",color:"blue",children:"GET"}),(0,t.jsx)(p.Text,{size:"sm",ff:"monospace",children:"/api/v0/id"}),(0,t.jsx)(p.Text,{size:"sm",c:"dimmed",children:"获取节点信息"})]}),(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(j.Badge,{variant:"dot",color:"blue",children:"POST"}),(0,t.jsx)(p.Text,{size:"sm",ff:"monospace",children:"/api/v0/swarm/peers"}),(0,t.jsx)(p.Text,{size:"sm",c:"dimmed",children:"获取对等节点列表"})]}),(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(j.Badge,{variant:"dot",color:"blue",children:"POST"}),(0,t.jsx)(p.Text,{size:"sm",ff:"monospace",children:"/api/v0/routing/findpeer"}),(0,t.jsx)(p.Text,{size:"sm",c:"dimmed",children:"查找特定节点"})]}),(0,t.jsxs)(a.Group,{children:[(0,t.jsx)(j.Badge,{variant:"dot",color:"blue",children:"POST"}),(0,t.jsx)(p.Text,{size:"sm",ff:"monospace",children:"/api/v0/ping"}),(0,t.jsx)(p.Text,{size:"sm",c:"dimmed",children:"测试节点连通性"})]})]})]})]})]})}},70323:(e,s,r)=>{Promise.resolve().then(r.bind(r,4498))}},e=>{e.O(0,[2545,2794,5595,380,2651,101,8441,1255,7358],()=>e(e.s=70323)),_N_E=e.O()}]);