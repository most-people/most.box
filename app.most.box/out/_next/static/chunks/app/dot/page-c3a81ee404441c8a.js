(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6566],{20003:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>K});var n=t(95155),r=t(12115),l=t(90101),i=t(13877),a=t(67623),o=t(2369),c=t(74264),d=t(67661),h=t(77147),x=t(70305),u=t(60688),m=t(96778),p=t(73524),g=t(78094),j=t(63498),f=t(9457),b=t(58380),w=t(82726),A=t(41970),C=t(44634),y=t(17998),z=t(71165),k=t(43796),v=t(81216),T=t(59126),S=t(69424),I=t(30928),P=t(86233),B=t(58255),D=t(20921),O=t(1371),E=t(69367),G=t(77252),N=t(2186),R=t(7080),_=t(47522),W=t(44191),M=t(45600),F=t(83392),U=t(53987),L=t(97443),q=t(49188),J=t(52619),Y=t.n(J),H=t(29311),X=t(25107);function K(){let e=(0,H.E)(e=>e.setItem),s=(0,H.E)(e=>e.dotAPI),t=(0,H.E)(e=>e.dotNodes),J=(0,H.E)(e=>e.updateDot),K=(0,H.E)(e=>e.network),Q=(0,H.E)(e=>e.setNetwork),V=(0,H.E)(e=>e.fetchNodes),Z=(0,H.E)(e=>e.RPC),$=(0,H.E)(e=>e.Explorer),[ee,es]=(0,r.useState)(Z),[et,en]=(0,r.useState)(!1),[er,el]=(0,r.useState)([]),[ei,ea]=(0,r.useState)("http://localhost:1976"),[eo,ec]=(0,r.useState)(!0),[ed,eh]=(0,r.useState)(!1),[ex,eu]=(0,r.useState)(null),[em,ep]=(0,r.useState)(null),[eg,ej]=(0,r.useState)({}),[ef,eb]=(0,r.useState)("bafkreihp5o7tdipf6ajkgkdxknnffkuxpeecwqydi4q5iqt4gko6r2agk4?filename=长征.jpg"),[ew,eA]=(0,r.useState)(!1),[eC,ey]=(0,r.useState)({}),ez=t.filter(e=>e.isOnline),ek=t.filter(e=>!1===e.isOnline),ev=(0,r.useMemo)(()=>{try{return new URL(s).host.toUpperCase()}catch(e){return"DOT.MOST.BOX"}},[s]),eT=e=>{var s;let t=e.CIDs.map(e=>"".concat(e,"/ipfs")),n=null==(s=e.APIs.find(e=>e.endsWith(":1976")))?void 0:s.replace(":1976",":8080/ipfs");return n&&t.push(n),[...new Set(t)]},eS=e=>e.APIs.some(e=>{try{return new URL(e).origin===new URL(s).origin}catch(e){return!1}}),eI=(e,s,t)=>{T.notifications.show({title:e,message:s,color:t})},eP=async e=>{let s=Date.now(),t=new AbortController,n=setTimeout(()=>t.abort(),2e3);try{let r=await fetch(e,{headers:{Range:"bytes=0-1023"},signal:t.signal}),l=Date.now()-s;if(clearTimeout(n),r.ok||206===r.status)return{status:"success",responseTime:l};return{status:"error",responseTime:l}}catch(e){if(clearTimeout(n),"AbortError"===e.name)return{status:"timeout"};return{status:"error"}}},eB=async()=>{if(!(e=>{if(!(e=e.trim().split("?")[0]))return eI("CID不能为空","请输入一个CID进行检测","orange"),!1;try{return q.TO.parse(e),!0}catch(e){return eI("无效的 CID","输入的值不是有效的 CID","red"),!1}})(ef))return;eA(!0);let e=(()=>{let e=[];return t.forEach(s=>{eT(s).filter(e=>!!e).forEach(s=>{e.push("".concat(s,"/").concat(ef))})}),[...new Set(e)]})(),s={};e.forEach(e=>{s[e]={status:"pending"}}),ey(s);let n=e.map(async e=>{let s=await eP(e);ey(t=>({...t,[e]:s}))});await Promise.all(n),eA(!1)},eD=async s=>{try{ec(!0),eu(null);let n=s||ee||Z,r=new v.FR(n);if(s){var t;let e=await r.getNetwork();if(!((t=Number(e.chainId))===U.WC.mainnet.chainId?(Q("mainnet"),!0):t===U.WC.testnet.chainId?(Q("testnet"),!0):(eI("网络错误","网络 ID 为 ".concat(t,"，不支持 Base 协议"),"red"),es(""),!1)))return}let l=await V(n);localStorage.setItem("dotNodes",JSON.stringify(l)),e("RPC",n),l&&e("dotNodes",l)}catch(e){console.info("获取节点列表失败:",e),eu("获取节点列表失败，请更换 RPC"),eI("获取失败","无法获取节点列表","red")}finally{ec(!1)}},eO=async()=>{eh(!0);try{let s=await Promise.all(t.map(async e=>{let{isOnline:s,responseTime:t}=await (0,H.P)(e);return{...e,isOnline:s,responseTime:t}}));e("dotNodes",s);let n=s.filter(e=>e.isOnline).length;eI("连通性检测完成","".concat(n,"/").concat(s.length," 个节点在线"),n>0?"green":"orange")}catch(e){console.log("连通性检测失败:",e),eI("检测失败","连通性检测过程中出现错误","red")}finally{eh(!1)}},eE=async()=>{en(!0);let e=await J(ei);e?(el(e),eI("节点切换成功",e[0],"green")):eI("节点切换失败","无法连接到该节点","red"),en(!1)},eG=(0,X.h)(),eN=async e=>{ep(e.address);try{let s=eg[e.address]||e.APIs[0],t=await J(s);t?(el(t),eI("节点切换成功","已切换到 ".concat(e.name),"green"),window.location.search.includes("back")&&eG()):eI("节点切换失败","无法连接到该节点","red")}catch(e){console.error(e),eI("节点切换失败","无法连接到该节点","red")}finally{ep(null)}};(0,r.useEffect)(()=>{if(t.length>0)return void ec(!1);let s=localStorage.getItem("dotNodes");if(s)try{e("dotNodes",JSON.parse(s)),ec(!1);return}catch(e){}eD()},[]);let eR=()=>U.WC[K].RPCs[Math.floor(Math.random()*U.WC[K].RPCs.length)];return(0,n.jsxs)(i.Container,{size:"lg",w:"100%",style:{wordBreak:"break-all"},children:[(0,n.jsx)(l.AppHeader,{title:"请选择节点"}),(0,n.jsx)(a.Box,{mb:"lg",children:(0,n.jsxs)(o.Stack,{align:"center",children:[(0,n.jsx)(c.Title,{mt:"md",children:ev}),(0,n.jsxs)(d.Group,{gap:0,children:[(0,n.jsx)(I.A,{}),(0,n.jsx)(h.Anchor,{c:"dimmed",component:Y(),href:"https://github.com/most-people/most.box",target:"_blank",children:"「轻松简单、开源免费、部署自己的节点」"})]}),er.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.Text,{children:"已成功接入"}),(0,n.jsx)(o.Stack,{justify:"center",children:er.map((e,s)=>(0,n.jsx)(h.Anchor,{onClick:s=>{s.preventDefault(),L.A.openDot(e)},lineClamp:1,component:Y(),href:e,children:e},s))})]}):(0,n.jsx)(h.Anchor,{component:Y(),href:s,target:"_blank",children:s}),(0,n.jsxs)(d.Group,{w:"100%",justify:"space-between",children:[(0,n.jsx)(u.TextInput,{flex:1,leftSection:(0,n.jsx)(P.A,{}),value:ei,onChange:e=>ea(e.currentTarget.value),placeholder:"私有节点地址"}),(0,n.jsx)(m.Button,{leftSection:(0,n.jsx)(B.A,{size:16}),onClick:eE,loading:et,children:"私有节点"})]})]})}),(0,n.jsx)(a.Box,{mb:"lg",children:(0,n.jsxs)(p.Flex,{justify:"space-between",align:"center",wrap:"wrap",gap:"md",children:[(0,n.jsxs)(d.Group,{children:[(0,n.jsx)(g.ThemeIcon,{size:40,radius:"md",variant:"light",color:"blue",children:(0,n.jsx)(D.A,{size:20})}),(0,n.jsxs)(a.Box,{children:[(0,n.jsx)(c.Title,{order:2,children:"节点列表"}),(0,n.jsxs)(x.Text,{size:"sm",c:"dimmed",children:["共 ",t.length," 个节点",t.some(e=>void 0!==e.isOnline)&&(0,n.jsxs)(n.Fragment,{children:[" ","• ",ez.length," 在线 • ",ek.length," 离线"]})]})]})]}),(0,n.jsxs)(d.Group,{children:[(0,n.jsx)(j.Select,{value:K,onChange:e=>{if(e&&("mainnet"===e||"testnet"===e)){let s=U.WC[e].rpc;es(s),Q(e),eD(s),T.notifications.show({title:"网络已切换",message:"已切换到 ".concat(U.WC[e].name),color:U.WC[e].color,icon:(0,n.jsx)(S.A,{size:16})})}},data:[{value:"testnet",label:"\uD83E\uDDEA Base 测试网"},{value:"mainnet",label:"\uD83C\uDF10 Base 主网"}],leftSection:(0,n.jsx)(S.A,{size:16}),variant:"filled",radius:"md",w:180}),(0,n.jsx)(f.Tooltip,{label:"刷新节点列表",children:(0,n.jsx)(b.ActionIcon,{size:"lg",variant:"light",color:"blue",onClick:()=>eD(),loading:eo,children:(0,n.jsx)(O.A,{size:18})})}),(0,n.jsx)(m.Button,{leftSection:(0,n.jsx)(E.A,{size:16}),onClick:eO,loading:ed,disabled:0===t.length,variant:"gradient",gradient:{from:"blue",to:"cyan"},children:"检测连通性"})]})]})}),(0,n.jsxs)(d.Group,{align:"flex-end",mb:"lg",children:[(0,n.jsx)(u.TextInput,{style:{flex:1},placeholder:"输入要查询的 CID...",value:ef,onChange:e=>eb(e.currentTarget.value)}),(0,n.jsxs)(m.Button,{onClick:eB,loading:ew,disabled:!ef,children:[(0,n.jsx)(G.A,{size:16}),(0,n.jsx)(x.Text,{ml:"xs",children:"CID"})]})]}),eo?(0,n.jsxs)(w.Paper,{p:"xl",radius:"md",style:{textAlign:"center"},children:[(0,n.jsx)(g.ThemeIcon,{size:60,radius:"xl",variant:"light",color:"blue",mb:"md",children:(0,n.jsx)(D.A,{size:30})}),(0,n.jsx)(c.Title,{order:3,c:"dimmed",children:"正在加载节点列表..."}),(0,n.jsx)(x.Text,{size:"sm",c:"dimmed",mt:"xs",children:"请稍候，正在从区块链获取数据"})]}):ex?(0,n.jsxs)(w.Paper,{shadow:"sm",p:"xl",radius:"md",children:[(0,n.jsx)(A.Alert,{color:"red",title:"加载失败",icon:(0,n.jsx)(N.A,{size:16}),children:ex}),(0,n.jsx)(d.Group,{mt:"md",children:(0,n.jsx)(m.Button,{size:"sm",color:"orange",variant:"light",onClick:()=>{es(eR()),eD()},children:"重新尝试"})})]}):0===t.length?(0,n.jsxs)(w.Paper,{shadow:"sm",p:"xl",radius:"md",style:{textAlign:"center"},children:[(0,n.jsx)(g.ThemeIcon,{size:60,radius:"xl",variant:"light",color:"gray",mb:"md",children:(0,n.jsx)(D.A,{size:30})}),(0,n.jsx)(c.Title,{order:3,c:"dimmed",mb:"xs",children:"暂无节点"}),(0,n.jsx)(x.Text,{size:"sm",c:"dimmed",children:"当前网络没有注册的节点"})]}):(0,n.jsx)(p.Flex,{wrap:"wrap",gap:"md",children:t.map((e,s)=>{var t;let r;return(0,n.jsxs)(C.Card,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,maw:"100%",w:358,style:{transition:"transform 0.2s ease, box-shadow 0.2s ease",border:eS(e)?"2px solid #228be6":void 0},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 20px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=""},children:[(0,n.jsxs)(d.Group,{justify:"space-between",mb:"md",children:[(0,n.jsxs)(d.Group,{children:[(0,n.jsx)(g.ThemeIcon,{size:36,radius:"md",variant:"light",color:e.isOnline?"green":!1===e.isOnline?"red":"gray",children:e.isOnline?(0,n.jsx)(E.A,{size:18}):!1===e.isOnline?(0,n.jsx)(R.A,{size:18}):(0,n.jsx)(D.A,{size:18})}),(0,n.jsxs)(a.Box,{children:[(0,n.jsxs)(d.Group,{gap:"xs",children:[(0,n.jsx)(x.Text,{fw:600,size:"md",lineClamp:1,children:e.name}),eS(e)&&(0,n.jsx)(y.Badge,{size:"xs",color:"blue",variant:"filled",children:"当前"})]}),(0,n.jsxs)(x.Text,{size:"xs",c:"dimmed",children:["节点地址 ",K.slice(0,1).toUpperCase(),s+1]})]})]}),void 0!==e.isOnline&&(0,n.jsxs)(y.Badge,{color:e.isOnline?"green":"red",variant:"light",leftSection:e.isOnline?(0,n.jsx)(_.A,{size:12}):(0,n.jsx)(N.A,{size:12}),children:[e.isOnline?"在线":"离线",void 0!==e.responseTime&&" (".concat(void 0===(r=e.responseTime)?"":"".concat(r,"ms"),")")]})]}),(0,n.jsx)(z.Divider,{mb:"md"}),(0,n.jsxs)(o.Stack,{justify:"space-between",flex:1,children:[(0,n.jsxs)(o.Stack,{gap:"sm",children:[(0,n.jsxs)(d.Group,{gap:"xs",wrap:"nowrap",children:[(0,n.jsx)(W.A,{size:14,color:"gray",style:{flexShrink:0}}),(0,n.jsxs)(x.Text,{size:"xs",c:"dimmed",children:[L.A.formatAddress(e.address)," ",(0,n.jsx)(h.Anchor,{component:Y(),href:{pathname:"/dot/deploy",query:{address:e.address,api:e.APIs[0]}},c:"dimmed",children:"Deploy"})]})]}),(0,n.jsxs)(d.Group,{gap:"xs",children:[(0,n.jsx)(M.A,{size:14,color:"gray"}),(0,n.jsx)(x.Text,{size:"xs",c:"dimmed",children:(t=e.lastUpdate)?new Date(1e3*t).toLocaleString("zh-CN"):"未知"})]}),e.APIs.length>0&&(0,n.jsx)(k.Radio.Group,{size:"xs",value:eg[e.address]||e.APIs[0],onChange:s=>ej(t=>({...t,[e.address]:s})),children:(0,n.jsx)(o.Stack,{gap:2,align:"flex-start",children:e.APIs.map((s,t)=>(0,n.jsxs)(d.Group,{gap:"xs",wrap:"nowrap",children:[(0,n.jsx)(k.Radio,{disabled:!!(eS(e)||"https:"===window.location.protocol&&s.startsWith("http:")),value:s}),(0,n.jsx)(h.Anchor,{c:"blue",onClick:e=>{e.preventDefault(),L.A.openDot(s)},lineClamp:1,component:Y(),href:s,children:s},t)]},t))})}),(0,n.jsxs)(a.Box,{children:[(0,n.jsx)(x.Text,{size:"xs",fw:500,mb:4,c:"gray",children:"IPFS 网关"}),(0,n.jsx)(o.Stack,{gap:"xs",align:"flex-start",children:eT(e).map((e,s)=>{let t=ef?"".concat(e,"/").concat(ef):e,r=eC[t];return(0,n.jsxs)(o.Stack,{gap:"xs",children:[(0,n.jsx)(h.Anchor,{component:Y(),c:"blue",href:t,target:"_blank",lineClamp:1,children:t}),(0,n.jsxs)(y.Badge,{flex:1,size:"sm",color:(null==r?void 0:r.status)==="success"?"green":"gray",variant:"light",children:[(null==r?void 0:r.status)||"CID",(null==r?void 0:r.responseTime)!=null&&" (".concat(null==r?void 0:r.responseTime,"ms)")]})]},s)})})]})]}),(0,n.jsx)(d.Group,{children:(0,n.jsx)(m.Button,{flex:1,variant:eS(e)?"filled":"light",color:eS(e)?"green":"blue",leftSection:(0,n.jsx)(F.A,{size:16}),onClick:()=>eN(e),loading:em===e.address,disabled:!!(!e.APIs.length||"https:"===location.protocol&&e.APIs[0].startsWith("http:"))||eS(e),children:eS(e)?"当前节点":"切换节点"})})]})]},e.address)})}),(0,n.jsxs)(d.Group,{mt:"lg",gap:"xs",justify:"space-between",children:[(0,n.jsx)(m.Button,{size:"sm",color:"yellow",variant:"light",onClick:()=>es(eR()),children:"更换 RPC"}),(0,n.jsx)(u.TextInput,{size:"sm",flex:1,leftSection:(0,n.jsx)(D.A,{size:16}),value:ee,onChange:e=>es(e.currentTarget.value),placeholder:"自定义 RPC"}),(0,n.jsx)(f.Tooltip,{label:"刷新节点列表",children:(0,n.jsx)(b.ActionIcon,{size:"lg",variant:"light",color:"blue",onClick:()=>eD(),loading:eo,children:(0,n.jsx)(O.A,{size:18})})})]}),(0,n.jsxs)(d.Group,{gap:"xs",mt:"lg",justify:"center",children:[(0,n.jsx)(h.Anchor,{size:"sm",c:"blue",component:Y(),href:"https://docs.base.org/chain/connecting-to-base",target:"_blank",children:"官方 RPC"}),(0,n.jsx)(h.Anchor,{size:"sm",c:"blue",component:Y(),href:"https://chainlist.org/chain/8453",target:"_blank",children:"主网 RPC"}),(0,n.jsx)(h.Anchor,{size:"sm",c:"blue",component:Y(),href:"https://docs.base.org/chain/network-faucets",target:"_blank",children:"水龙头列表"}),(0,n.jsx)(h.Anchor,{size:"sm",c:"blue",component:Y(),href:"https://portal.cdp.coinbase.com/products/faucet?projectId=0b869244-5000-43dd-8aba-c9feee07f6ab",target:"_blank",children:"注册领水"}),(0,n.jsxs)(h.Anchor,{size:"sm",c:"blue",component:Y(),href:$+"/address/"+U.MT,target:"_blank",children:["节点合约 ",L.A.formatAddress(U.MT)]}),(0,n.jsx)(h.Anchor,{size:"sm",c:"blue",component:Y(),href:"/dot/status",children:"本地 IPFS 节点状态"})]})]})}},47515:(e,s,t)=>{Promise.resolve().then(t.bind(t,20003))}},e=>{e.O(0,[8198,2545,2794,5619,6714,8555,8835,5125,9287,3584,5595,291,9457,380,7285,7146,1943,2008,101,6961,8441,1255,7358],()=>e(e.s=47515)),_N_E=e.O()}]);