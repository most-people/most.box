(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6566],{4673:(e,t,n)=>{"use strict";n.d(t,{BP:()=>h,OM:()=>g,yO:()=>u});var s=n(30167),r=n(71425),i=n(44532),a=n(87788),o=n(56076),l=n(88413),c=n(70358),d=n(26634),m=n.n(d);let h=(e,t,n)=>{let c=(0,s.YW)(t),d=(0,s.YW)("/most.box/"+e),h=(0,r.A)(c,d,3,32,"sha512"),u=(0,i.q5)((0,a.s)(h)),g=u.slice(0,32),p=m().box.keyPair.fromSecretKey(g),x=(0,i.c$)(p.publicKey),f=(0,i.c$)(p.secretKey),j=o.v.entropyToPhrase(u);return{username:e,address:l.QX.fromPhrase(j).address,public_key:x,private_key:f,mnemonic:"I know loss mnemonic will lose my wallet."===n?j:""}},u=(e,t,n)=>{let s=new TextEncoder().encode(e),r=m().randomBytes(m().box.nonceLength),a=m().box(s,r,new Uint8Array((0,i.q5)(t)),new Uint8Array((0,i.q5)(n)));return a?["mp://2",(0,c.W)(r),(0,c.W)(a)].join("."):(console.info("加密失败"),"")},g=(e,t,n)=>{let[s,r,a]=e.split(".");if("mp://2"!==s)return console.info("无效的密文"),"";let o=m().box.open((0,c.y)(a),(0,c.y)(r),new Uint8Array((0,i.q5)(t)),new Uint8Array((0,i.q5)(n)));return o?new TextDecoder().decode(o):(console.info("解密失败"),"")}},7248:(e,t,n)=>{"use strict";n.d(t,{h:()=>r});var s=n(35695);let r=()=>{let e=(0,s.useRouter)(),t=(0,s.usePathname)();return()=>{sessionStorage.firstPath===t?(sessionStorage.firstPath="/",e.replace("/")):e.back()}}},9482:(e,t,n)=>{"use strict";n.d(t,{A:()=>w});var s=n(70358),r=n(30167),i=n(88413),a=n(19396),o=n(96842),l=n(42995),c=n(3648),d=n(4673),m=n(59909),h=n(30832),u=n.n(h),g=n(99758),p=n.n(g);n(38464);var x=n(76920),f=n.n(x);u().extend(f()),u().extend(p()),u().locale("zh-cn");let j=e=>{let t=String(Date.now()),n=(0,s.W)(crypto.getRandomValues(new Uint8Array(32))),r=sessionStorage.getItem("fingerprint")||"",i=[location.origin,r].join("/"),a=[t,n].join("."),{public_key:o,private_key:l}=(0,d.BP)(i,a);return{jwt:(0,d.yO)(JSON.stringify(e),o,l),jwtSecret:a}},b=(e,t)=>{let[n]=t.split(".");if(Date.now()-Number(n)>288e5)return console.log("jwt 已过期"),null;try{let n=sessionStorage.getItem("fingerprint")||"",s=[location.origin,n].join("/"),{public_key:r,private_key:i}=(0,d.BP)(s,t),a=(0,d.OM)(e,r,i);if(a)return JSON.parse(a)}catch(e){console.log("验证失败:",e)}return null},y=async e=>{let t=Date.now().toString(),n=i.QX.fromPhrase(e.mnemonic),s=await n.signMessage(t);localStorage.token=[e.address,t,s].join(".")},w={avatar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,o.gn)(l,{seed:"most.box@"+e,flip:!0,backgroundType:["gradientLinear"]}).toDataUri()},avatarCID:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,o.gn)(c,{seed:"most.box#"+e,flip:!0,backgroundType:["gradientLinear","solid"]}).toDataUri()},formatTime:e=>{let t;if(!e)return"";let n=u()(Number(e)),s=n.hour();return t=s>=0&&s<3?"凌晨":s>=3&&s<6?"拂晓":s>=6&&s<9?"早晨":s>=9&&s<12?"上午":s>=12&&s<15?"下午":s>=15&&s<18?"傍晚":s>=18&&s<21?"薄暮":"深夜",n.format("YYYY年M月D日 ".concat(t,"h点m分"))},formatDate:e=>{let t=u()(Number(e)),n=u()();return t.isSame(n,"day")?t.format("HH:mm"):t.isSame(n.subtract(1,"day"),"day")?"昨天 ".concat(t.format("HH:mm")):t.isoWeek()===n.isoWeek()?"".concat(["周日","周一","周二","周三","周四","周五","周六"][t.day()]," ").concat(t.format("HH:mm")):t.year()===n.year()?t.format("M月D日"):t.format("YY年M月D日")},formatAddress:e=>e?e.slice(0,6)+"..."+e.slice(-4):"",enBase64:e=>(0,s.W)((0,r.YW)(e)),deBase64:e=>(0,r._v)((0,s.y)(e)),createJWT:j,verifyJWT:b,login:(e,t)=>{try{var n;let s=(0,d.BP)(e,t,"I know loss mnemonic will lose my wallet."),{jwt:r,jwtSecret:i}=j(s);if((null==(n=b(r,i))?void 0:n.address)===s.address)return localStorage.setItem("jwt",r),localStorage.setItem("jwtSecret",i),y(s),s}catch(e){console.log("登录失败:",e)}return null},ZeroAddress:a.j,createToken:y,pinyin:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(t.length<n)return!1;if(e.toLowerCase().includes(t.toLowerCase()))return!0;let s=(0,m.YW)(e,t,{continuous:!0});return!!s&&!!(s.length>=n)}}},22976:()=>{},48764:(e,t,n)=>{"use strict";n.d(t,{k:()=>o});var s=n(9482),r=n(65453),i=n(54205),a=n(6942);let o=(0,r.v)((e,t)=>({wallet:void 0,initWallet(){let n=localStorage.getItem("jwt"),r=localStorage.getItem("jwtSecret");if(n&&r){let i=s.A.verifyJWT(n,r);i?(s.A.createToken(i),e({wallet:i})):t().exit()}},async updateDot(t){try{let n=new URL(t).origin,s=(await i.FH.get(n+"/api.dot",{timeout:3e3})).data;i.FH.defaults.baseURL=n,e({dotAPI:n}),localStorage.setItem("dotAPI",n);let r=s.CIDs[0];return n.endsWith(":1976")&&(r=n.slice(0,-5)+":8080"),r&&(e({dotCID:r}),localStorage.setItem("dotCID",r)),e({notes:void 0,files:void 0}),s.APIs}catch(n){a.notifications.show({title:"节点切换失败",message:t,color:"red"}),console.info(n),e({dotAPI:i.FH.defaults.baseURL||""})}return null},setItem:(t,n)=>e(e=>({...e,[t]:n})),firstPath:"",dotAPI:i.MN,dotCID:i.AF,dotNodes:[],notes:void 0,files:void 0,exit(){e({wallet:void 0,notes:void 0,files:void 0}),localStorage.removeItem("jwt"),localStorage.removeItem("jwtSecret"),localStorage.removeItem("token")}}))},54205:(e,t,n)=>{"use strict";n.d(t,{AF:()=>i,C2:()=>a,FH:()=>o,MN:()=>r});var s=n(23464);let r="https://dot.most.red",i="https://cid.most.red",a="https://most.box/auth/callback",o=s.A.create({baseURL:r});o.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>("ERR_NETWORK"===e.code&&(window.location.href="/dot"),Promise.reject(e)))},71281:()=>{},76889:(e,t,n)=>{Promise.resolve().then(n.bind(n,91752))},80630:(e,t,n)=>{"use strict";n.d(t,{AppHeader:()=>c});var s=n(95155),r=n(70112),i=n(81001),a=n(58887),o=n(20042),l=n(7248);let c=e=>{let{title:t,right:n}=e,c=(0,l.h)();return(0,s.jsxs)(r.Group,{className:"app-header",children:[(0,s.jsx)(i.ActionIcon,{variant:"transparent",onClick:c,color:"--text-color",children:(0,s.jsx)(o.I,{name:"Back",size:24})}),(0,s.jsx)(a.Text,{lineClamp:2,variant:"gradient",children:t}),n||(0,s.jsx)(i.ActionIcon,{variant:"transparent",color:"--text-color",children:(0,s.jsx)(o.I,{name:"More",size:24})})]})}},91752:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>E});var s=n(95155),r=n(12115),i=n(80630),a=n(69604),o=n(91590),l=n(21220),c=n(93695),d=n(70112),m=n(8593),h=n(26903),u=n(70058),g=n(35049),p=n(93751),x=n(58887),f=n(15763),j=n(27361),b=n(81001),y=n(97287),w=n(74634),A=n(89047),v=n(18403),I=n(26029),T=n(53776),S=n(59117),k=n(19215),P=n(6942),z=n(12257),C=n(33686),D=n(96482),O=n(41698),B=n(54476),N=n(54395),_=n(89586),M=n(30699),W=n(50828),R=n(2737),U=n(36655),G=n(9482),L=n(6874),H=n.n(L),Y=n(48764);n(22976);let F=[{inputs:[],name:"getAllDots",outputs:[{internalType:"address[]",name:"addresses",type:"address[]"},{internalType:"string[]",name:"names",type:"string[]"},{internalType:"uint256[]",name:"timestamps",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"dot",type:"address"}],name:"getDot",outputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string[]",name:"APIs",type:"string[]"},{internalType:"string[]",name:"CIDs",type:"string[]"},{internalType:"uint256",name:"update",type:"uint256"}],stateMutability:"view",type:"function"}];function E(){let[e,t]=(0,r.useState)(!1),[n,L]=(0,r.useState)([]),[E,q]=(0,r.useState)(""),K=(0,Y.k)(e=>e.setItem),J=(0,Y.k)(e=>e.dotAPI),X=(0,Y.k)(e=>e.dotNodes),Q=(0,Y.k)(e=>e.updateDot),[Z,$]=(0,r.useState)(!0),[V,ee]=(0,r.useState)(!1),[et,en]=(0,r.useState)(null),[es,er]=(0,r.useState)("testnet"),[ei,ea]=(0,r.useState)(null),eo={mainnet:{rpc:"https://mainnet.base.org",name:"Base 主网",color:"blue",explorer:"https://basescan.org"},testnet:{rpc:"https://sepolia.base.org",name:"Base 测试网",color:"orange",explorer:"https://sepolia.basescan.org"}},el=eo[es].rpc,ec=eo[es].explorer,ed=async()=>{t(!0);let e=await Q(E);e&&L(e),t(!1)},em=async e=>{if(!e.APIs||0===e.APIs.length)return void P.notifications.show({title:"切换失败",message:"该节点没有可用的API地址",color:"red"});ea(e.address);try{let t=e.APIs[0],n=await Q(t);n&&(L(n),P.notifications.show({title:"节点切换成功",message:"已切换到 ".concat(e.name),color:"green"}))}catch(e){console.error(e),P.notifications.show({title:"切换失败",message:"无法连接到该节点",color:"red"})}finally{ea(null)}},eh=async()=>{try{$(!0),en(null);let e=new S.FR(el),t=new k.NZ("0xdc82cef1a8416210afb87caeec908a4df843f016",F,e),[n,s,r]=await t.getAllDots(),i=n.map(async(e,n)=>{let[i,a,o,l]=await t.getDot(e);return{address:e,name:i||s[n]||"节点 ".concat(n+1),APIs:a||[],CIDs:o||[],lastUpdate:Number(l||r[n])}}),a=await Promise.all(i);K("dotNodes",a)}catch(e){console.error("获取节点列表失败:",e),en("获取节点列表失败，请检查网络连接"),P.notifications.show({title:"获取失败",message:"无法获取节点列表",color:"red"})}finally{$(!1)}},eu=async()=>{ee(!0);try{let e=await Promise.all(X.map(async e=>{let{isOnline:t,responseTime:n}=await new Promise(t=>{if(!e.APIs||0===e.APIs.length)return void t({isOnline:!1,responseTime:0});let n=e.APIs[0],s=Date.now(),r=new AbortController,i=setTimeout(()=>r.abort(),3e3);fetch("".concat(n,"/api.dot"),{signal:r.signal,mode:"cors"}).then(()=>{clearTimeout(i),t({isOnline:!0,responseTime:Date.now()-s})}).catch(()=>{clearTimeout(i),t({isOnline:!1,responseTime:Date.now()-s})})});return{...e,isOnline:t,responseTime:n}}));K("dotNodes",e);let t=e.filter(e=>e.isOnline).length;P.notifications.show({title:"连通性检测完成",message:"".concat(t,"/").concat(e.length," 个节点在线"),color:t>0?"green":"orange"})}catch(e){console.log("连通性检测失败:",e),P.notifications.show({title:"检测失败",message:"连通性检测过程中出现错误",color:"red"})}finally{ee(!1)}},eg=e=>{var t;return null==(t=e.APIs.find(e=>e.endsWith(":1976")))?void 0:t.replace(":1976",":8080/ipfs")},ep=e=>e.APIs.some(e=>{try{return new URL(e).origin===new URL(J).origin}catch(e){return!1}});(0,r.useEffect)(()=>{0===X.length?eh():$(!1)},[]);let ex=X.filter(e=>e.isOnline),ef=X.filter(e=>!1===e.isOnline);return(0,s.jsxs)(a.Box,{id:"page-dot",children:[(0,s.jsx)(i.AppHeader,{title:"节点管理"}),(0,s.jsxs)(o.Container,{size:"lg",children:[(0,s.jsx)(a.Box,{mb:"lg",children:(0,s.jsxs)(l.Stack,{className:"container",align:"center",gap:0,children:[(0,s.jsx)("h1",{children:"DOT.MOST.BOX"}),n.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"已成功接入节点"}),(0,s.jsx)(l.Stack,{justify:"center",children:n.map((e,t)=>(0,s.jsx)(c.Anchor,{component:H(),href:e,target:"_blank",lineClamp:1,children:e},t))})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"当前节点"}),(0,s.jsx)(c.Anchor,{component:H(),href:J,target:"_blank",children:J})]}),(0,s.jsx)("p",{children:"為 全 人 類 徹 底 解 放 奮 鬥 終 身"}),(0,s.jsxs)(d.Group,{mt:"lg",justify:"space-between",children:[(0,s.jsx)(m.TextInput,{flex:1,leftSection:(0,s.jsx)(C.A,{}),value:E,onChange:e=>q(e.currentTarget.value),placeholder:"自定义节点地址"}),(0,s.jsx)(h.Button,{onClick:ed,loading:e,children:"自定义"})]})]})}),(0,s.jsx)(a.Box,{mb:"lg",children:(0,s.jsxs)(u.Flex,{justify:"space-between",align:"center",wrap:"wrap",gap:"md",children:[(0,s.jsxs)(d.Group,{children:[(0,s.jsx)(g.ThemeIcon,{size:40,radius:"md",variant:"light",color:"blue",children:(0,s.jsx)(D.A,{size:20})}),(0,s.jsxs)(a.Box,{children:[(0,s.jsx)(p.Title,{order:2,children:"节点列表"}),(0,s.jsxs)(x.Text,{size:"sm",c:"dimmed",children:["共 ",X.length," 个节点",X.some(e=>void 0!==e.isOnline)&&(0,s.jsxs)(s.Fragment,{children:[" ","• ",ex.length," 在线 • ",ef.length," 离线"]})]})]})]}),(0,s.jsxs)(d.Group,{children:[(0,s.jsx)(f.Select,{value:es,onChange:e=>{e&&("mainnet"===e||"testnet"===e)&&(er(e),eh(),P.notifications.show({title:"网络已切换",message:"已切换到 ".concat(eo[e].name),color:eo[e].color,icon:(0,s.jsx)(z.A,{size:16})}))},data:[{value:"testnet",label:"\uD83E\uDDEA Base 测试网"},{value:"mainnet",label:"\uD83C\uDF10 Base 主网"}],leftSection:(0,s.jsx)(z.A,{size:16}),variant:"filled",radius:"md",w:180}),(0,s.jsx)(j.Tooltip,{label:"刷新节点列表",children:(0,s.jsx)(b.ActionIcon,{size:"lg",variant:"light",color:"blue",onClick:eh,loading:Z,children:(0,s.jsx)(O.A,{size:18})})}),(0,s.jsx)(h.Button,{leftSection:(0,s.jsx)(B.A,{size:16}),onClick:eu,loading:V,disabled:0===X.length,variant:"gradient",gradient:{from:"blue",to:"cyan"},children:"检测连通性"})]})]})}),Z?(0,s.jsxs)(y.Paper,{p:"xl",radius:"md",style:{textAlign:"center"},children:[(0,s.jsx)(g.ThemeIcon,{size:60,radius:"xl",variant:"light",color:"blue",mb:"md",children:(0,s.jsx)(D.A,{size:30})}),(0,s.jsx)(p.Title,{order:3,c:"dimmed",children:"正在加载节点列表..."}),(0,s.jsx)(x.Text,{size:"sm",c:"dimmed",mt:"xs",children:"请稍候，正在从区块链获取数据"})]}):et?(0,s.jsxs)(y.Paper,{shadow:"sm",p:"xl",radius:"md",children:[(0,s.jsx)(w.Alert,{color:"red",title:"加载失败",icon:(0,s.jsx)(N.A,{size:16}),children:et}),(0,s.jsx)(h.Button,{mt:"md",onClick:eh,leftSection:(0,s.jsx)(O.A,{size:16}),variant:"light",color:"red",children:"重新加载"})]}):0===X.length?(0,s.jsxs)(y.Paper,{shadow:"sm",p:"xl",radius:"md",style:{textAlign:"center"},children:[(0,s.jsx)(g.ThemeIcon,{size:60,radius:"xl",variant:"light",color:"gray",mb:"md",children:(0,s.jsx)(D.A,{size:30})}),(0,s.jsx)(p.Title,{order:3,c:"dimmed",mb:"xs",children:"暂无节点"}),(0,s.jsx)(x.Text,{size:"sm",c:"dimmed",children:"当前网络没有注册的节点"})]}):(0,s.jsx)(A.Grid,{children:X.map(e=>{var t,n;return(0,s.jsx)(A.Grid.Col,{span:"auto",children:(0,s.jsxs)(v.Card,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,h:"100%",w:343,style:{transition:"transform 0.2s ease, box-shadow 0.2s ease",border:ep(e)?"2px solid #228be6":void 0},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 20px rgba(0,0,0,0.1)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=""},children:[(0,s.jsxs)(d.Group,{justify:"space-between",mb:"md",children:[(0,s.jsxs)(d.Group,{children:[(0,s.jsx)(g.ThemeIcon,{size:36,radius:"md",variant:"light",color:e.isOnline?"green":!1===e.isOnline?"red":"gray",children:e.isOnline?(0,s.jsx)(B.A,{size:18}):!1===e.isOnline?(0,s.jsx)(_.A,{size:18}):(0,s.jsx)(D.A,{size:18})}),(0,s.jsxs)(a.Box,{children:[(0,s.jsxs)(d.Group,{gap:"xs",children:[(0,s.jsx)(x.Text,{fw:600,size:"md",lineClamp:1,children:e.name}),ep(e)&&(0,s.jsx)(I.Badge,{size:"xs",color:"blue",variant:"filled",children:"当前"})]}),(0,s.jsx)(x.Text,{size:"xs",c:"dimmed",children:"节点地址"})]})]}),void 0!==e.isOnline&&(0,s.jsxs)(I.Badge,{color:e.isOnline?"green":"red",variant:"light",leftSection:e.isOnline?(0,s.jsx)(M.A,{size:12}):(0,s.jsx)(N.A,{size:12}),children:[e.isOnline?"在线":"离线",void 0!==e.responseTime&&" (".concat(void 0===(t=e.responseTime)?"":"".concat(t,"ms"),")")]})]}),(0,s.jsx)(T.Divider,{mb:"md"}),(0,s.jsxs)(l.Stack,{gap:"sm",children:[(0,s.jsxs)(d.Group,{gap:"xs",wrap:"nowrap",children:[(0,s.jsx)(W.A,{size:14,color:"gray",style:{flexShrink:0}}),(0,s.jsxs)(x.Text,{size:"xs",c:"dimmed",children:[G.A.formatAddress(e.address)," ",(0,s.jsx)(c.Anchor,{component:H(),href:{pathname:"/dot/deploy",query:{address:e.address,api:e.APIs[0]}},c:"dimmed",children:"Deploy"})]})]}),(0,s.jsxs)(d.Group,{gap:"xs",children:[(0,s.jsx)(R.A,{size:14,color:"gray"}),(0,s.jsx)(x.Text,{size:"xs",c:"dimmed",children:(n=e.lastUpdate)?new Date(1e3*n).toLocaleString("zh-CN"):"未知"})]}),e.APIs.length>0&&(0,s.jsx)(l.Stack,{gap:2,align:"flex-start",children:e.APIs.map((e,t)=>(0,s.jsx)(c.Anchor,{c:"blue",component:H(),href:e,target:"_blank",lineClamp:1,children:e},t))}),(0,s.jsxs)(a.Box,{children:[(0,s.jsx)(x.Text,{size:"xs",fw:500,mb:4,c:"gray",children:"CID 浏览器"}),(0,s.jsxs)(d.Group,{gap:2,align:"flex-start",children:[e.CIDs.map((e,t)=>(0,s.jsx)(c.Anchor,{component:H(),c:"blue",href:e+"/ipfs",target:"_blank",lineClamp:1,children:e+"/ipfs"},t)),eg(e)&&(0,s.jsx)(c.Anchor,{c:"blue",component:H(),href:eg(e)||"",target:"_blank",lineClamp:1,children:eg(e)})]})]}),(0,s.jsx)(h.Button,{fullWidth:!0,variant:ep(e)?"filled":"light",color:ep(e)?"green":"blue",leftSection:(0,s.jsx)(U.A,{size:16}),onClick:()=>em(e),loading:ei===e.address,disabled:ep(e)||!e.APIs.length,mt:"sm",children:ep(e)?"当前节点":"切换到此节点"})]})]})},e.address)})}),(0,s.jsxs)(d.Group,{gap:"xs",mt:"lg",justify:"center",children:[(0,s.jsx)(c.Anchor,{size:"sm",c:"blue",component:H(),href:"https://docs.base.org/chain/connecting-to-base",target:"_blank",children:"官方 RPC"}),(0,s.jsx)(c.Anchor,{size:"sm",c:"blue",component:H(),href:"https://chainlist.org/chain/8453",target:"_blank",children:"主网 RPC"}),(0,s.jsx)(c.Anchor,{size:"sm",c:"blue",component:H(),href:"https://chainlist.org/chain/84532",target:"_blank",children:"测试网 RPC"}),(0,s.jsx)(c.Anchor,{size:"sm",c:"blue",component:H(),href:"https://docs.base.org/chain/network-faucets",target:"_blank",children:"水龙头列表"}),(0,s.jsx)(c.Anchor,{size:"sm",c:"blue",component:H(),href:"https://portal.cdp.coinbase.com/products/faucet?projectId=0b869244-5000-43dd-8aba-c9feee07f6ab",target:"_blank",children:"注册领水"}),(0,s.jsx)(c.Anchor,{size:"sm",c:"blue",component:H(),href:ec+"/address/0xdc82cef1a8416210afb87caeec908a4df843f016",target:"_blank",children:"合约地址"})]})]})]})}}},e=>{e.O(0,[9803,2545,8198,2059,3268,8335,2598,8694,3464,3339,3678,8367,6874,8607,7232,42,8441,5964,7358],()=>e(e.s=76889)),_N_E=e.O()}]);