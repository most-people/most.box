(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4520],{70017:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>N});var o=i(95155),n=i(31064),r=i(70305),s=i(13877),a=i(2369),l=i(5480),c=i(14777),d=i(27701),u=i(96778),h=i(71165),g=i(67661),x=i(9457),m=i(58380),f=i(77147),j=i(90632),p=i(60688),w=i(52619),v=i.n(w),b=i(12115),k=i(97443),C=i(56612),T=i(13297),y=i(59126),I=i(25107),S=i(8620),A=i(99682),E=i(21794),_=i(68321),z=i(20063),B=i(90101),G=i(90982);function N(){let e=(0,z.useRouter)(),t=(0,I.h)(),[i,{toggle:w}]=(0,n.useDisclosure)(!0),[N,{open:O,close:D}]=(0,n.useDisclosure)(!1),M=(0,T.k)(e=>e.setWallet),[P,W]=(0,b.useState)(""),[K,R]=(0,b.useState)(""),U=!!(P||K),[X,q]=(0,b.useState)(""),[F,H]=(0,b.useState)(""),[L,V]=(0,b.useState)(!1),[$,J]=(0,b.useState)(""),[Q,Y]=(0,b.useState)(""),[Z,ee]=(0,b.useState)(!1),[et,ei]=(0,b.useState)(!1),[eo,en]=(0,b.useState)(0);(0,b.useEffect)(()=>{let e;return eo>0&&(e=setTimeout(()=>en(eo-1),1e3)),()=>clearTimeout(e)},[eo]);let er=()=>{if(!P)return void y.notifications.show({message:"请输入昵称"});if(!K)return void y.notifications.show({message:"请输入密码"});let e=k.A.login(P,K);e&&setTimeout(()=>{M(e)},0),t()},es=async e=>{try{let{data:t,error:i}=await S.N.functions.invoke("telegram-auth",{body:{authData:e}});if(i)throw i;if(t.success&&t.redirect_url)y.notifications.show({title:"登录成功",message:"正在跳转..."}),window.location.href=t.redirect_url;else throw Error(t.error||"登录失败")}catch(e){console.error("Telegram login error:",e),y.notifications.show({color:"red",title:"登录失败",message:e instanceof Error?e.message:"未知错误"})}},ea=async e=>{try{let{error:t}=await S.N.auth.signInWithOAuth({provider:e,options:{redirectTo:E.C2}});if(t)throw t}catch(e){y.notifications.show({color:"red",message:e instanceof Error?e.message:"登录失败，请重试"})}},el=async()=>{if(!X)return void H("请输入邮箱地址");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(X))return void H("请输入有效的邮箱地址");try{V(!0);let{error:e}=await S.N.auth.signInWithOtp({email:X,options:{emailRedirectTo:E.C2}});if(e)throw e;y.notifications.show({color:"green",message:"验证邮件已发送，请检查您的邮箱"}),ei(!0),en(60),H("")}catch(e){y.notifications.show({color:"red",message:e instanceof Error?e.message:"登录失败，请重试"})}finally{V(!1)}},ec=async()=>{if(!$)return void Y("请输入验证码");try{ee(!0);let{error:t}=await S.N.auth.verifyOtp({email:X,token:$,type:"email"});if(t)throw t;y.notifications.show({color:"green",message:"验证成功，正在登录..."}),e.replace("/auth/callback")}catch(e){Y(e instanceof Error?e.message:"验证失败，请重试")}finally{ee(!1)}},ed=()=>{q(""),H(""),J(""),Y(""),ei(!1),en(0),D()};return(0,o.jsxs)(s.Container,{maw:424,w:"100%",children:[(0,o.jsx)(B.AppHeader,{title:"登录"}),(0,o.jsxs)(a.Stack,{gap:"md",mt:"md",children:[(0,o.jsxs)(a.Stack,{align:"center",children:[(0,o.jsx)(r.Text,{size:"xl",fw:500,children:"Most.Box"}),(0,o.jsx)(l.Avatar,{size:"xl",radius:"md",src:P?k.A.avatar((0,C.BP)(P,K).address):"/icons/pwa-512x512.png",alt:"it's me"})]}),(0,o.jsxs)(a.Stack,{gap:"md",children:[(0,o.jsx)(c.Input,{autoFocus:!0,placeholder:"昵称",value:P,onChange:e=>W(e.currentTarget.value),onKeyUp:e=>{"Enter"===e.key&&U&&er()}}),(0,o.jsx)(d.PasswordInput,{placeholder:"密码",visible:i,onVisibilityChange:w,value:K,onChange:e=>R(e.currentTarget.value),onKeyUp:e=>{"Enter"===e.key&&U&&er()}}),(0,o.jsx)(u.Button,{onClick:U?er:t,variant:"gradient",children:U?"登录":"游客"}),(0,o.jsx)(h.Divider,{label:"Or",labelPosition:"center"}),(0,o.jsxs)(g.Group,{justify:"center",gap:"md",children:[(0,o.jsx)(x.Tooltip,{label:"使用邮箱登录",children:(0,o.jsx)(m.ActionIcon,{size:"lg",variant:"default",onClick:O,children:(0,o.jsx)(A.I,{name:"Mail"})})}),(0,o.jsx)(x.Tooltip,{label:"使用 X 登录",children:(0,o.jsx)(m.ActionIcon,{size:"lg",variant:"default",onClick:()=>ea("twitter"),children:(0,o.jsx)(A.I,{name:"X"})})}),(0,o.jsx)(x.Tooltip,{label:"使用 Google 登录",children:(0,o.jsx)(m.ActionIcon,{size:"lg",variant:"default",onClick:()=>ea("google"),children:(0,o.jsx)(A.I,{name:"Google"})})}),(0,o.jsx)(x.Tooltip,{label:"使用 Github 登录",children:(0,o.jsx)(m.ActionIcon,{size:"lg",variant:"default",onClick:()=>ea("github"),children:(0,o.jsx)(A.I,{name:"Github"})})}),(0,o.jsx)(x.Tooltip,{label:"使用 Discord 登录",children:(0,o.jsx)(m.ActionIcon,{size:"lg",variant:"default",onClick:()=>ea("discord"),children:(0,o.jsx)(A.I,{name:"Discord"})})}),(0,o.jsx)(x.Tooltip,{label:"使用 Telegram 登录",children:(0,o.jsx)(m.ActionIcon,{size:"lg",variant:"default",onClick:()=>{let e=window.Telegram;return e?"most.box"!==location.host?void G.modals.openConfirmModal({centered:!0,title:"提示",children:(0,o.jsx)(r.Text,{c:"dimmed",children:"需要在 most.box 域名下登录，是否继续？"}),labels:{confirm:"继续",cancel:"取消"},onConfirm:()=>window.open("https://most.box/login")}):void e.Login.auth({bot_id:"7848968061",request_access:"write",embed:1},e=>{e&&es(e)}):void y.notifications.show({title:"提示",message:"Telegram 不存在"})},children:(0,o.jsx)(A.I,{name:"Telegram"})})})]}),(0,o.jsx)(f.Anchor,{component:v(),href:"/about",style:{textAlign:"center"},children:"完全去中心化，无需注册"})]})]}),(0,o.jsx)(j.Modal,{opened:N,onClose:ed,title:"邮箱登录",centered:!0,children:(0,o.jsxs)(a.Stack,{gap:"md",children:[(0,o.jsx)(p.TextInput,{type:"email",value:X,onChange:e=>{q(e.currentTarget.value),H("")},error:F,disabled:et}),et&&(0,o.jsxs)(g.Group,{align:"flex-end",gap:"xs",children:[(0,o.jsx)(p.TextInput,{placeholder:"请输入验证码",value:$,onChange:e=>{J(e.currentTarget.value),Y("")},error:Q,style:{flex:1}}),(0,o.jsx)(u.Button,{variant:"light",onClick:()=>{eo>0||el()},disabled:eo>0,children:eo>0?"再次发送 ".concat(eo,"s"):"再次发送"})]}),(0,o.jsxs)(g.Group,{justify:"flex-end",children:[(0,o.jsx)(u.Button,{variant:"default",onClick:ed,children:"取消"}),et?(0,o.jsx)(u.Button,{loading:Z,onClick:ec,children:"验证"}):(0,o.jsx)(u.Button,{loading:L,onClick:el,children:"发送邮件"})]})]})}),(0,o.jsx)(_.default,{src:"https://telegram.org/js/telegram-widget.js"})]})}},80741:(e,t,i)=>{Promise.resolve().then(i.bind(i,70017))}},e=>{e.O(0,[8198,2545,2794,5619,6714,8555,8835,5125,6476,9287,3584,5595,291,9457,380,9032,8760,6294,101,1636,8441,1255,7358],()=>e(e.s=80741)),_N_E=e.O()}]);