(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{4673:(e,t,n)=>{"use strict";n.d(t,{BP:()=>u,OM:()=>h,yO:()=>x});var s=n(30167),r=n(71425),a=n(44532),o=n(87788),l=n(56076),i=n(51544),c=n(70358),d=n(26634),m=n.n(d);let u=(e,t,n)=>{let c=(0,s.YW)(t),d=(0,s.YW)("/most.box/"+e),u=(0,r.A)(c,d,3,32,"sha512"),x=(0,a.q5)((0,o.s)(u)),h=x.slice(0,32),j=m().box.keyPair.fromSecretKey(h),f=(0,a.c$)(j.publicKey),g=(0,a.c$)(j.secretKey),p=l.v.entropyToPhrase(x);return{username:e,address:i.QX.fromPhrase(p).address,public_key:f,private_key:g,mnemonic:"I know loss mnemonic will lose my wallet."===n?p:""}},x=(e,t,n)=>{let s=new TextEncoder().encode(e),r=m().randomBytes(m().box.nonceLength),o=m().box(s,r,new Uint8Array((0,a.q5)(t)),new Uint8Array((0,a.q5)(n)));return o?["mp://2",(0,c.W)(r),(0,c.W)(o)].join("."):(console.info("加密失败"),"")},h=(e,t,n)=>{let[s,r,o]=e.split(".");if("mp://2"!==s)return console.info("无效的密文"),"";let l=m().box.open((0,c.y)(o),(0,c.y)(r),new Uint8Array((0,a.q5)(t)),new Uint8Array((0,a.q5)(n)));return l?new TextDecoder().decode(l):(console.info("解密失败"),"")}},6396:()=>{},9482:(e,t,n)=>{"use strict";n.d(t,{A:()=>v});var s=n(70358),r=n(30167),a=n(51544),o=n(19396),l=n(96842),i=n(42995),c=n(3648),d=n(4673),m=n(30832),u=n.n(m),x=n(99758),h=n.n(x);n(38464);var j=n(76920),f=n.n(j);u().extend(f()),u().extend(h()),u().locale("zh-cn");let g=e=>{let t=String(Date.now()),n=(0,s.W)(crypto.getRandomValues(new Uint8Array(32))),r=sessionStorage.getItem("fingerprint")||"",a=[t,n].join("."),{public_key:o,private_key:l}=(0,d.BP)(r,a);return{jwt:(0,d.yO)(JSON.stringify(e),o,l),jwtSecret:a}},p=(e,t)=>{let[n]=t.split(".");if(Date.now()-Number(n)>864e5)return console.log("jwt 已过期"),null;try{let n=sessionStorage.getItem("fingerprint")||"",{public_key:s,private_key:r}=(0,d.BP)(n,t),a=(0,d.OM)(e,s,r);if(a)return JSON.parse(a)}catch(e){console.log("验证失败:",e)}return null},b=async e=>{let t=Date.now().toString(),n=a.QX.fromPhrase(e.mnemonic),s=await n.signMessage(t);localStorage.token=[e.address,t,s].join(".")},w=async()=>{try{let e=new Audio("/sounds/notification.mp3");await e.play(),navigator.vibrate(200)}catch(e){console.log("播放提示音时出错:",e)}},v={topic:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,l.gn)(c,{seed:"most.box#"+e,flip:!0,backgroundType:["gradientLinear","solid"]}).toDataUri()},avatar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,l.gn)(i,{seed:"most.box@"+e,flip:!0,backgroundType:["gradientLinear"]}).toDataUri()},getHash:e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return Math.abs(t).toString(36)},formatTime:e=>{let t;if(!e)return"";let n=u()(Number(e)),s=n.hour();return t=s>=0&&s<3?"凌晨":s>=3&&s<6?"拂晓":s>=6&&s<9?"早晨":s>=9&&s<12?"上午":s>=12&&s<15?"下午":s>=15&&s<18?"傍晚":s>=18&&s<21?"薄暮":"深夜",n.format("YYYY年M月D日 ".concat(t,"h点m分"))},formatDate:e=>{let t=u()(Number(e)),n=u()();return t.isSame(n,"day")?t.format("HH:mm"):t.isSame(n.subtract(1,"day"),"day")?"昨天 ".concat(t.format("HH:mm")):t.isoWeek()===n.isoWeek()?"".concat(["周日","周一","周二","周三","周四","周五","周六"][t.day()]," ").concat(t.format("HH:mm")):t.year()===n.year()?t.format("M月D日"):t.format("YY年M月D日")},formatAddress:e=>e?e.slice(0,6)+"..."+e.slice(-4):"",enBase64:e=>(0,s.W)((0,r.YW)(e)),deBase64:e=>(0,r._v)((0,s.y)(e)),createJWT:g,verifyJWT:p,login:(e,t)=>{try{var n;let s=(0,d.BP)(e,t,"I know loss mnemonic will lose my wallet."),{jwt:r,jwtSecret:a}=g(s);if((null==(n=p(r,a))?void 0:n.address)===s.address)return localStorage.setItem("jwt",r),localStorage.setItem("jwtSecret",a),b(s),s}catch(e){console.log("登录失败:",e)}return null},ZeroAddress:o.j,topicJoin:(e,t)=>t?[e,t].join("➔"):e,topicSplit:e=>{e.startsWith("#")&&(e=e.substring(1));let[t,n]=decodeURIComponent(e).split("➔");return[t||"",n||""]},playSound:w,createToken:b}},23666:()=>{},29439:()=>{},44017:()=>{},48764:(e,t,n)=>{"use strict";n.d(t,{k:()=>l});var s=n(9482),r=n(65453),a=n(54205),o=n(6942);let l=(0,r.v)(e=>({wallet:void 0,initWallet(){let t=localStorage.getItem("jwt"),n=localStorage.getItem("jwtSecret");if(t&&n){let r=s.A.verifyJWT(t,n);r&&(s.A.createToken(r),e({wallet:r}))}},async updateDot(t,n){let s=new URL(t).origin;try{let t=await (0,a.FH)(s+"/ipv6"),r=new Set(t.data);if(r.add(s),a.FH.defaults.baseURL=s,e({dotAPI:s}),localStorage.dotAPI=s,n||o.notifications.show({title:"节点已切换",message:s,color:"green"}),s.endsWith("1976")){let t=s.slice(0,-4)+"8080";e({dotCID:t}),localStorage.dotCID=t}return Array.from(r)}catch(t){o.notifications.show({title:"节点未切换",message:s,color:"red"}),console.error(t),e({dotAPI:a.FH.defaults.baseURL||""})}return null},setItem:(t,n)=>e(e=>({...e,[t]:n})),firstPath:"",dotAPI:a.MN,dotCID:a.AF,exit(){e({wallet:void 0}),localStorage.removeItem("jwt"),localStorage.removeItem("jwtSecret")}}))},54205:(e,t,n)=>{"use strict";n.d(t,{AF:()=>a,FH:()=>o,MN:()=>r});var s=n(23464);let r="https://dot.most.red",a="https://cid.most.red",o=s.A.create({baseURL:r});o.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e},e=>Promise.reject(e))},67919:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>D});var s=n(95155),r=n(12115),a=n(46647),o=n(58887),l=n(30578);n(29439);var i=n(6874),c=n.n(i),d=n(69604),m=n(70112),u=n(39926),x=n(81001),h=n(21220),j=n(6942),f=n(48764),g=n(9482);function p(){let e=(0,f.k)(e=>e.wallet),t=(null==e?void 0:e.address)||g.A.ZeroAddress,n=(0,f.k)(e=>e.exit);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Box,{className:"header",children:(0,s.jsxs)(m.Group,{wrap:"nowrap",children:[(0,s.jsx)(u.Avatar,{size:"md",radius:"sm",src:(null==e?void 0:e.address)?g.A.avatar(e.address):"/icons/pwa-512x512.png",alt:"it's me"}),(0,s.jsxs)(d.Box,{children:[(0,s.jsx)(o.Text,{size:"lg",fw:500,lineClamp:2,children:(null==e?void 0:e.username)||"Most.Box"}),(0,s.jsxs)(o.Text,{size:"sm",c:"dimmed",children:["地址: ",g.A.formatAddress(t)]})]}),(0,s.jsx)(x.ActionIcon,{ml:"auto",variant:"subtle",color:"gray",onClick:()=>j.notifications.show({title:"二维码",message:"开发中"}),children:(0,s.jsx)(l.I,{name:"qr-code",size:18})})]})}),(0,s.jsxs)(h.Stack,{className:"menu-list",mb:"xs",gap:0,children:[(0,s.jsx)(b,{icon:"web3",label:"Web3",link:"/web3"}),(0,s.jsx)(b,{icon:"download",label:"节点",link:"/dot"})]}),(0,s.jsxs)(h.Stack,{className:"menu-list",gap:0,children:[(0,s.jsx)(b,{icon:"about",label:"关于",link:"/about"}),(0,s.jsx)(b,{icon:"setting",label:"设置",link:"/setting"}),(0,s.jsx)(b,{icon:"join",label:"志同道合",link:"/join"})]}),(0,s.jsx)(h.Stack,{className:"menu-list",mt:"xs",children:(0,s.jsx)(b,{icon:"exit",label:e?"退出账户":"去登录",link:"/login",onClick:()=>{setTimeout(()=>{n()},1e3)}})})]})}function b(e){let{icon:t,label:n,link:r,onClick:a}=e;return(0,s.jsxs)(d.Box,{component:c(),href:r,className:"menu-item",onClick:a,children:[(0,s.jsxs)(m.Group,{children:[(0,s.jsx)(l.I,{name:t,size:32}),(0,s.jsx)(o.Text,{children:n})]}),(0,s.jsx)(l.I,{name:"arrow",size:18})]})}n(23666);var w=n(59741),v=n(22439),T=n(755),y=n(2358),S=n(65782),A=n(57101),k=n(17972);function I(){let[e,t]=(0,r.useState)("friends");return(0,r.useEffect)(()=>{t(localStorage.getItem("chatTab")||"friends")},[]),(0,s.jsx)(a.Tabs,{value:e,onChange:e=>{t(e),localStorage.setItem("chatTab",e||"friends")},variant:"outline",children:(0,s.jsxs)(d.Box,{className:"chat-header",children:[(0,s.jsxs)(a.Tabs.List,{children:[(0,s.jsx)(a.Tabs.Tab,{value:"friends",fw:500,children:"好友"}),(0,s.jsx)(a.Tabs.Tab,{value:"topics",fw:500,children:"话题"})]}),(0,s.jsxs)(m.Group,{className:"action",children:[(0,s.jsx)(x.ActionIcon,{variant:"subtle",color:"gray",onClick:()=>j.notifications.show({message:"开发中"}),children:(0,s.jsx)(v.A,{size:24,stroke:1.5})}),(0,s.jsxs)(w.Menu,{shadow:"md",position:"bottom-end",withArrow:!0,arrowPosition:"center",children:[(0,s.jsx)(w.Menu.Target,{children:(0,s.jsx)(x.ActionIcon,{variant:"subtle",color:"gray",children:(0,s.jsx)(T.A,{size:24,stroke:1.5})})}),(0,s.jsxs)(w.Menu.Dropdown,{children:[(0,s.jsx)(w.Menu.Item,{leftSection:(0,s.jsx)(y.A,{size:24}),component:c(),href:"/topic",children:(0,s.jsx)(o.Text,{children:"加入话题"})}),(0,s.jsx)(w.Menu.Item,{leftSection:(0,s.jsx)(S.A,{size:24}),component:c(),href:"/friend",children:(0,s.jsx)(o.Text,{children:"添加好友"})}),(0,s.jsx)(w.Menu.Item,{leftSection:(0,s.jsx)(A.A,{size:24}),component:c(),href:"/scan",children:(0,s.jsx)(o.Text,{children:"扫一扫"})}),(0,s.jsx)(w.Menu.Item,{leftSection:(0,s.jsx)(k.A,{size:24}),component:c(),href:"/pay",children:(0,s.jsx)(o.Text,{children:"收付款"})})]})]})]})]})})}function M(){return(0,s.jsx)(s.Fragment,{children:"Note tab content"})}function P(){return(0,s.jsx)(s.Fragment,{children:"Explore tab content"})}n(30832),n(83572),n(6396),n(44017);var N=n(65703),z=n(35695);function D(){let e=(0,z.useRouter)(),[t]=(0,N.useHash)(),[n,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let t=new URLSearchParams(window.location.search);i(localStorage.getItem("homeTab")||"chat");let n=Array.from(t.keys());n.length>0&&e.replace("/search?q="+n[0])},[]),(0,r.useEffect)(()=>{t&&e.replace("/topic"+t)},[t]),(0,s.jsxs)(a.Tabs,{id:"page-home",variant:"pills",radius:0,value:n,onChange:e=>{i(e),localStorage.setItem("homeTab",e||"chat")},children:[(0,s.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"chat",children:(0,s.jsx)(I,{})}),(0,s.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"note",children:(0,s.jsx)(M,{})}),(0,s.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"explore",children:(0,s.jsx)(P,{})}),(0,s.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"mine",children:(0,s.jsx)(p,{})}),(0,s.jsxs)(a.Tabs.List,{children:[(0,s.jsxs)(a.Tabs.Tab,{value:"chat",children:[(0,s.jsx)(l.I,{name:"chat"===n?"chat-active":"chat"}),(0,s.jsx)(o.Text,{children:"聊天"})]}),(0,s.jsxs)(a.Tabs.Tab,{value:"note",children:[(0,s.jsx)(l.I,{name:"note"===n?"note-active":"note"}),(0,s.jsx)(o.Text,{children:"笔记"})]}),(0,s.jsxs)(a.Tabs.Tab,{value:"explore",children:[(0,s.jsx)(l.I,{name:"explore"===n?"explore-active":"explore"}),(0,s.jsx)(o.Text,{children:"探索"})]}),(0,s.jsxs)(a.Tabs.Tab,{value:"mine",children:[(0,s.jsx)(l.I,{name:"mine"===n?"mine-active":"mine"}),(0,s.jsx)(o.Text,{children:"我的"})]})]})]})}},71281:()=>{},83572:()=>{},92826:(e,t,n)=>{Promise.resolve().then(n.bind(n,67919))}},e=>{var t=t=>e(e.s=t);e.O(0,[3131,2545,9729,5232,1281,3464,266,2682,8962,9665,578,8441,2721,7358],()=>t(92826)),_N_E=e.O()}]);