(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5555],{8141:(e,t,a)=>{"use strict";a.d(t,{Center:()=>c});var l=a(95155);a(12115);var r=a(43664),i=a(53791),n=a(69604),s=a(64511),o={root:"m_4451eb3a"};let c=(0,s.polymorphicFactory)((e,t)=>{let a=(0,r.useProps)("Center",null,e),{classNames:s,className:c,style:d,styles:u,unstyled:h,vars:p,inline:m,mod:b,attributes:x,...w}=a,v=(0,i.useStyles)({name:"Center",props:a,classes:o,className:c,style:d,classNames:s,styles:u,unstyled:h,attributes:x,vars:p});return(0,l.jsx)(n.Box,{ref:t,mod:[{inline:m},b],...v("root"),...w})});c.classes=o,c.displayName="@mantine/core/Center"},20563:(e,t,a)=>{"use strict";a.d(t,{I:()=>u,M:()=>d});var l=a(95155),r=a(12115),i=a(54853),n=a(56204),s=a(53791),o=a(69604),c={root:"m_5f75b09e",body:"m_5f6e695e",labelWrapper:"m_d3ea56bb",label:"m_8ee546b8",description:"m_328f68c0",error:"m_8e8a99cc"};let d=c,u=(0,r.forwardRef)((e,t)=>{let{__staticSelector:a,__stylesApiProps:r,className:d,classNames:u,styles:h,unstyled:p,children:m,label:b,description:x,id:w,disabled:v,error:f,size:y,labelPosition:g="left",bodyElement:k="div",labelElement:S="label",variant:_,style:j,vars:C,mod:z,attributes:B,...I}=e,F=(0,s.useStyles)({name:a,props:r,className:d,style:j,classes:c,classNames:u,styles:h,unstyled:p,attributes:B});return(0,l.jsx)(o.Box,{...F("root"),ref:t,__vars:{"--label-fz":(0,n.getFontSize)(y),"--label-lh":(0,n.getSize)(y,"label-lh")},mod:[{"label-position":g},z],variant:_,size:y,...I,children:(0,l.jsxs)(o.Box,{component:k,htmlFor:"label"===k?w:void 0,...F("body"),children:[m,(0,l.jsxs)("div",{...F("labelWrapper"),"data-disabled":v||void 0,children:[b&&(0,l.jsx)(o.Box,{component:S,htmlFor:"label"===S?w:void 0,...F("label"),"data-disabled":v||void 0,children:b}),x&&(0,l.jsx)(i.Input.Description,{size:y,__inheritStyles:!1,...F("description"),children:x}),f&&"boolean"!=typeof f&&(0,l.jsx)(i.Input.Error,{size:y,__inheritStyles:!1,...F("error"),children:f})]})]})})});u.displayName="@mantine/core/InlineInput"},40837:(e,t,a)=>{"use strict";a.d(t,{U:()=>n,x:()=>i});var l=a(12115);let r=(0,l.createContext)(null),i=r.Provider,n=()=>(0,l.useContext)(r)},49153:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var l=a(95155),r=a(12115),i=a(70112),n=a(26903),s=a(91590),o=a(69604),c=a(66121),d=a(8141),u=a(83347),h=a(80630),p=a(91082);a(61262);var m=a(35695),b=a(48764),x=a(54205),w=a(6942),v=a(4673),f=a(6874),y=a.n(f);let g=()=>{let e=(0,m.useSearchParams)(),t=(0,b.k)(e=>e.dotCID),a=(0,b.k)(e=>e.wallet),[f,g]=(0,r.useState)(!0),[k,S]=(0,r.useState)(null),[_,j]=(0,r.useState)(null),C=(0,p.B)(),[z,B]=(0,r.useState)(""),[I,F]=(0,r.useState)(!1),[E,P]=(0,r.useState)(!1),[U,N]=(0,r.useState)(!1),R=(e,t)=>{let a=new URL(window.location.href);a.hash=e,t&&a.searchParams.set("uid",t),window.history.replaceState(null,"",a.href)},M=(a,l)=>{fetch("".concat(l||t,"/ipfs/").concat(a,"/index.md")).then(e=>e.text()).then(t=>{let a=e.get("dot")||"",l=new URL(window.location.href);l.searchParams.set("dot",a||x.FH.getUri()),window.history.replaceState(null,"",l.href),N(!0),P(!1),B(t)}).catch(e=>{console.error("Error:",e)}).finally(()=>{g(!1)})};(0,r.useEffect)(()=>{if(U&&a&&z.startsWith("mp://2")){let e=(0,v.OM)(z,a.public_key,a.private_key);e&&(P(!0),B(e))}},[U,a,z]);let G=async(e,t)=>{var l,r;a&&E&&(t=(0,v.yO)(t,a.public_key,a.private_key));let i=new FormData,n=new Blob([t],{type:"text/markdown"});i.append("file",n,"index.md"),i.append("path","/.note/".concat(e,"/index.md"));try{let t=null==(l=(await x.FH.put("/files.upload",i)).data)?void 0:l.cid;t&&(R(t,null==a?void 0:a.address),w.notifications.show({message:"".concat(e," 保存成功"),color:"green"}))}catch(t){let e=(null==t||null==(r=t.response)?void 0:r.data)||"文件上传失败，请重试";e.includes("already has")&&(e="文件已存在"),w.notifications.show({title:"保存失败",message:e,color:"red"})}},L=async()=>{H.current&&S(await C.initViewer(H.current)),T.current&&j(await C.initEditor(T.current))},W=async()=>{let t=location.hash,a=e.get("uid"),l=e.get("name"),r=e.get("dot")||void 0;if(a&&l)try{var i,n;let e=(null==(n=(await x.FH.get("/api.dot",{baseURL:r})).data)||null==(i=n.CIDs)?void 0:i[0])||void 0,s=(await x.FH.get("/files.find.cid/".concat(a,"/.note/").concat(l),{baseURL:r})).data;s?(R(s),M(s,e)):t&&M(t.slice(1),e)}catch(e){console.error(e),t&&M(t.slice(1))}},D=(0,r.useMemo)(()=>{let t="笔记",a=e.get("name");return a&&(t=a),E&&(t="\uD83D\uDD12 "+t),t},[E]);(0,r.useEffect)(()=>{U&&(null==k||k.setMarkdown(z),null==_||_.setMarkdown(z))},[U,z,k,_]);let H=(0,r.useRef)(null),T=(0,r.useRef)(null),V=(0,b.k)(e=>e.nodeDark);return(0,r.useEffect)(()=>{W(),L()},[]),(0,l.jsxs)(s.Container,{id:"page-note",children:[(0,l.jsx)(h.AppHeader,{title:D,variant:"text",right:(0,l.jsx)(i.Group,{gap:"xs",wrap:"nowrap",children:I?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.Button,{size:"xs",onClick:()=>{if(_){let t=_.getMarkdown();B(t);let a=e.get("name");a&&G(a,t)}F(!1)},children:"保存"}),(0,l.jsx)(n.Button,{size:"xs",variant:"outline",onClick:()=>{_&&_.setMarkdown(z),F(!1)},children:"取消"})]}):a?(0,l.jsx)(n.Button,{size:"xs",onClick:()=>F(!0),children:"编辑"}):(0,l.jsx)(n.Button,{size:"xs",variant:"gradient",component:y(),href:"/login",children:"编辑"})})}),(0,l.jsx)(o.Box,{id:"viewer-box",className:V,ref:H,style:{display:I?"none":"block"}}),(0,l.jsx)(o.Box,{id:"editor-box",className:V,ref:T,style:{display:I?"block":"none"}}),(0,l.jsx)(o.Box,{id:"switch-box",style:{display:I?"block":"none"},children:(0,l.jsx)(c.Switch,{checked:E,onChange:e=>P(e.currentTarget.checked),label:E?"加密":"公开"})}),f&&(0,l.jsx)(d.Center,{mt:"md",children:(0,l.jsx)(u.Loader,{size:"xl",type:"dots"})})]})},k=()=>(0,l.jsx)(r.Suspense,{children:(0,l.jsx)(g,{})})},49902:(e,t,a)=>{"use strict";a.d(t,{F:()=>i});var l=a(95155);a(12115);var r=a(21355);function i(e){let{children:t,role:a}=e,i=(0,r.useInputWrapperContext)();return i?(0,l.jsx)("div",{role:a,"aria-labelledby":i.labelId,"aria-describedby":i.describedBy,children:t}):(0,l.jsx)(l.Fragment,{children:t})}},56470:(e,t,a)=>{"use strict";a.d(t,{SwitchGroup:()=>d});var l=a(95155),r=a(57613);a(12115);var i=a(43664),n=a(36960),s=a(49902),o=a(54853),c=a(40837);let d=(0,n.factory)((e,t)=>{let{value:a,defaultValue:n,onChange:d,size:u,wrapperProps:h,children:p,readOnly:m,...b}=(0,i.useProps)("SwitchGroup",null,e),[x,w]=(0,r.useUncontrolled)({value:a,defaultValue:n,finalValue:[],onChange:d});return(0,l.jsx)(c.x,{value:{value:x,onChange:e=>{let t=e.currentTarget.value;m||w(x.includes(t)?x.filter(e=>e!==t):[...x,t])},size:u},children:(0,l.jsx)(o.Input.Wrapper,{size:u,ref:t,...h,...b,labelElement:"div",__staticSelector:"SwitchGroup",children:(0,l.jsx)(s.F,{role:"group",children:p})})})});d.classes=o.Input.Wrapper.classes,d.displayName="@mantine/core/SwitchGroup"},57613:(e,t,a)=>{"use strict";a.d(t,{useUncontrolled:()=>r});var l=a(12115);function r(e){let{value:t,defaultValue:a,finalValue:r,onChange:i=()=>{}}=e,[n,s]=(0,l.useState)(void 0!==a?a:r);return void 0!==t?[t,i,!0]:[n,function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),l=1;l<t;l++)a[l-1]=arguments[l];s(e),null==i||i(e,...a)},!1]}},61262:()=>{},66121:(e,t,a)=>{"use strict";a.d(t,{Switch:()=>y});var l=a(95155),r=a(64173),i=a(57613);a(12115);var n=a(56204),s=a(68918),o=a(71180),c=a(43664),d=a(53791),u=a(99537),h=a(69604),p=a(36960),m=a(20563),b=a(40837),x=a(56470),w={root:"m_5f93f3bb",input:"m_926b4011",track:"m_9307d992",thumb:"m_93039a1d",trackLabel:"m_8277e082"};let v={labelPosition:"right",withThumbIndicator:!0},f=(0,s.createVarsResolver)((e,t)=>{let{radius:a,color:l,size:r}=t;return{root:{"--switch-radius":void 0===a?void 0:(0,n.getRadius)(a),"--switch-height":(0,n.getSize)(r,"switch-height"),"--switch-width":(0,n.getSize)(r,"switch-width"),"--switch-thumb-size":(0,n.getSize)(r,"switch-thumb-size"),"--switch-label-font-size":(0,n.getSize)(r,"switch-label-font-size"),"--switch-track-label-padding":(0,n.getSize)(r,"switch-track-label-padding"),"--switch-color":l?(0,o.getThemeColor)(l,e):void 0}}}),y=(0,p.factory)((e,t)=>{var a;let n=(0,c.useProps)("Switch",v,e),{classNames:s,className:o,style:p,styles:x,unstyled:y,vars:g,color:k,label:S,offLabel:_,onLabel:j,id:C,size:z,radius:B,wrapperProps:I,thumbIcon:F,checked:E,defaultChecked:P,onChange:U,labelPosition:N,description:R,error:M,disabled:G,variant:L,rootRef:W,mod:D,withThumbIndicator:H,attributes:T,...V}=n,O=(0,b.U)(),A=z||(null==O?void 0:O.size),q=(0,d.useStyles)({name:"Switch",props:n,classes:w,className:o,style:p,classNames:s,styles:x,unstyled:y,attributes:T,vars:g,varsResolver:f}),{styleProps:J,rest:K}=(0,u.extractStyleProps)(V),Q=(0,r.useId)(C),X=O?{checked:O.value.includes(K.value),onChange:O.onChange}:{},[Y,Z]=(0,i.useUncontrolled)({value:null!=(a=X.checked)?a:E,defaultValue:P,finalValue:!1});return(0,l.jsxs)(m.I,{...q("root"),__staticSelector:"Switch",__stylesApiProps:n,id:Q,size:A,labelPosition:N,label:S,description:R,error:M,disabled:G,bodyElement:"label",labelElement:"span",classNames:s,styles:x,unstyled:y,"data-checked":X.checked||E||void 0,variant:L,ref:W,mod:D,...J,...I,children:[(0,l.jsx)("input",{...K,disabled:G,checked:Y,"data-checked":X.checked||E||void 0,onChange:e=>{var t;O?null==(t=X.onChange)||t.call(X,e):null==U||U(e),Z(e.currentTarget.checked)},id:Q,ref:t,type:"checkbox",role:"switch",...q("input")}),(0,l.jsxs)(h.Box,{"aria-hidden":"true",component:"span",mod:{error:M,"label-position":N,"without-labels":!j&&!_},...q("track"),children:[(0,l.jsx)(h.Box,{component:"span",mod:{"reduce-motion":!0,"with-thumb-indicator":H&&!F},...q("thumb"),children:F}),(0,l.jsx)("span",{...q("trackLabel"),children:Y?j:_})]})]})});y.classes={...w,...m.M},y.displayName="@mantine/core/Switch",y.Group=x.SwitchGroup},71400:(e,t,a)=>{Promise.resolve().then(a.bind(a,49153))}},e=>{e.O(0,[2401,8198,642,1257,8805,8413,6634,3722,3464,2996,7244,630,6933,8441,5964,7358],()=>e(e.s=71400)),_N_E=e.O()}]);