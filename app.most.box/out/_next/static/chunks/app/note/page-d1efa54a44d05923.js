(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5555],{8141:(e,t,l)=>{"use strict";l.d(t,{Center:()=>c});var r=l(95155);l(12115);var a=l(43664),i=l(53791),n=l(69604),s=l(64511),o={root:"m_4451eb3a"};let c=(0,s.polymorphicFactory)((e,t)=>{let l=(0,a.useProps)("Center",null,e),{classNames:s,className:c,style:d,styles:u,unstyled:h,vars:p,inline:m,mod:x,attributes:b,...w}=l,f=(0,i.useStyles)({name:"Center",props:l,classes:o,className:c,style:d,classNames:s,styles:u,unstyled:h,attributes:b,vars:p});return(0,r.jsx)(n.Box,{ref:t,mod:[{inline:m},x],...f("root"),...w})});c.classes=o,c.displayName="@mantine/core/Center"},20563:(e,t,l)=>{"use strict";l.d(t,{I:()=>u,M:()=>d});var r=l(95155),a=l(12115),i=l(54853),n=l(56204),s=l(53791),o=l(69604),c={root:"m_5f75b09e",body:"m_5f6e695e",labelWrapper:"m_d3ea56bb",label:"m_8ee546b8",description:"m_328f68c0",error:"m_8e8a99cc"};let d=c,u=(0,a.forwardRef)((e,t)=>{let{__staticSelector:l,__stylesApiProps:a,className:d,classNames:u,styles:h,unstyled:p,children:m,label:x,description:b,id:w,disabled:f,error:v,size:y,labelPosition:g="left",bodyElement:k="div",labelElement:S="label",variant:_,style:j,vars:C,mod:z,attributes:B,...E}=e,I=(0,s.useStyles)({name:l,props:a,className:d,style:j,classes:c,classNames:u,styles:h,unstyled:p,attributes:B});return(0,r.jsx)(o.Box,{...I("root"),ref:t,__vars:{"--label-fz":(0,n.getFontSize)(y),"--label-lh":(0,n.getSize)(y,"label-lh")},mod:[{"label-position":g},z],variant:_,size:y,...E,children:(0,r.jsxs)(o.Box,{component:k,htmlFor:"label"===k?w:void 0,...I("body"),children:[m,(0,r.jsxs)("div",{...I("labelWrapper"),"data-disabled":f||void 0,children:[x&&(0,r.jsx)(o.Box,{component:S,htmlFor:"label"===S?w:void 0,...I("label"),"data-disabled":f||void 0,children:x}),b&&(0,r.jsx)(i.Input.Description,{size:y,__inheritStyles:!1,...I("description"),children:b}),v&&"boolean"!=typeof v&&(0,r.jsx)(i.Input.Error,{size:y,__inheritStyles:!1,...I("error"),children:v})]})]})})});u.displayName="@mantine/core/InlineInput"},40837:(e,t,l)=>{"use strict";l.d(t,{U:()=>n,x:()=>i});var r=l(12115);let a=(0,r.createContext)(null),i=a.Provider,n=()=>(0,r.useContext)(a)},49153:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>k});var r=l(95155),a=l(12115),i=l(70112),n=l(26903),s=l(91590),o=l(69604),c=l(66121),d=l(8141),u=l(83347),h=l(80630),p=l(91082);l(61262);var m=l(35695),x=l(48764),b=l(54205),w=l(6942),f=l(4673),v=l(6874),y=l.n(v);let g=()=>{let e=(0,m.useSearchParams)(),t=(0,x.k)(e=>e.dotCID),l=(0,x.k)(e=>e.wallet),[v,g]=(0,a.useState)(!0),[k,S]=(0,a.useState)(null),[_,j]=(0,a.useState)(null),C=(0,p.B)(),[z,B]=(0,a.useState)(""),[E,I]=(0,a.useState)(!1),[F,P]=(0,a.useState)(!1),[N,M]=(0,a.useState)(!1),G=(e,t)=>{let l=new URL(window.location.href);l.searchParams.set("cid",e),t&&l.searchParams.set("uid",t),window.history.replaceState(null,"",l.href)},R=e=>{fetch("".concat(t,"/ipfs/").concat(e,"/index.md")).then(e=>e.text()).then(e=>{M(!0),P(!1),B(e)}).catch(e=>{console.error("Error:",e)}).finally(()=>{g(!1)})};(0,a.useEffect)(()=>{if(N&&l&&z.startsWith("mp://2")){let e=(0,f.OM)(z,l.public_key,l.private_key);e&&(P(!0),B(e))}},[N,l,z]);let U=async(e,t)=>{var r,a;l&&F&&(t=(0,f.yO)(t,l.public_key,l.private_key));let i=new FormData,n=new Blob([t],{type:"text/markdown"});i.append("file",n,"index.md"),i.append("path","/.note/".concat(e,"/index.md"));try{let t=null==(r=(await b.FH.put("/files.upload",i)).data)?void 0:r.cid;t&&(G(t,null==l?void 0:l.address),w.notifications.show({message:"".concat(e," 保存成功"),color:"green"}))}catch(t){let e=(null==t||null==(a=t.response)?void 0:a.data)||"文件上传失败，请重试";e.includes("already has")&&(e="文件已存在"),w.notifications.show({title:"保存失败",message:e,color:"red"})}},W=async()=>{D.current&&S(await C.initViewer(D.current)),L.current&&j(await C.initEditor(L.current))},T=async()=>{let t=e.get("uid"),l=e.get("name");if(t&&l)try{let r=(await b.FH.get("/files.find.cid/".concat(t,"/.note/").concat(l))).data;if(r)G(r),R(r);else{let t=e.get("cid");t&&R(t)}}catch(l){console.error(l);let t=e.get("cid");t&&R(t)}},V=(0,a.useMemo)(()=>{let t="笔记",l=e.get("name");return l&&(t=l),F&&(t="\uD83D\uDD12 "+t),t},[F]);(0,a.useEffect)(()=>{N&&(null==k||k.setMarkdown(z),null==_||_.setMarkdown(z))},[N,z,k,_]);let D=(0,a.useRef)(null),L=(0,a.useRef)(null),O=(0,x.k)(e=>e.nodeDark);return(0,a.useEffect)(()=>{W()},[]),(0,a.useEffect)(()=>{t&&T()},[t]),(0,r.jsxs)(s.Container,{id:"page-note",children:[(0,r.jsx)(h.AppHeader,{title:V,variant:"text",right:(0,r.jsx)(i.Group,{gap:"xs",wrap:"nowrap",children:E?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Button,{size:"xs",onClick:()=>{if(_){let t=_.getMarkdown();B(t);let l=e.get("name");l&&U(l,t)}I(!1)},children:"保存"}),(0,r.jsx)(n.Button,{size:"xs",variant:"outline",onClick:()=>{_&&_.setMarkdown(z),I(!1)},children:"取消"})]}):l?(0,r.jsx)(n.Button,{size:"xs",onClick:()=>I(!0),children:"编辑"}):(0,r.jsx)(n.Button,{size:"xs",variant:"gradient",component:y(),href:"/login",children:"编辑"})})}),(0,r.jsx)(o.Box,{id:"viewer-box",className:O,ref:D,style:{display:E?"none":"block"}}),(0,r.jsx)(o.Box,{id:"editor-box",className:O,ref:L,style:{display:E?"block":"none"}}),(0,r.jsx)(o.Box,{id:"switch-box",style:{display:E?"block":"none"},children:(0,r.jsx)(c.Switch,{checked:F,onChange:e=>P(e.currentTarget.checked),label:F?"加密":"公开"})}),v&&(0,r.jsx)(d.Center,{mt:"md",children:(0,r.jsx)(u.Loader,{size:"xl",type:"dots"})})]})},k=()=>(0,r.jsx)(a.Suspense,{children:(0,r.jsx)(g,{})})},49902:(e,t,l)=>{"use strict";l.d(t,{F:()=>i});var r=l(95155);l(12115);var a=l(21355);function i(e){let{children:t,role:l}=e,i=(0,a.useInputWrapperContext)();return i?(0,r.jsx)("div",{role:l,"aria-labelledby":i.labelId,"aria-describedby":i.describedBy,children:t}):(0,r.jsx)(r.Fragment,{children:t})}},56470:(e,t,l)=>{"use strict";l.d(t,{SwitchGroup:()=>d});var r=l(95155),a=l(57613);l(12115);var i=l(43664),n=l(36960),s=l(49902),o=l(54853),c=l(40837);let d=(0,n.factory)((e,t)=>{let{value:l,defaultValue:n,onChange:d,size:u,wrapperProps:h,children:p,readOnly:m,...x}=(0,i.useProps)("SwitchGroup",null,e),[b,w]=(0,a.useUncontrolled)({value:l,defaultValue:n,finalValue:[],onChange:d});return(0,r.jsx)(c.x,{value:{value:b,onChange:e=>{let t=e.currentTarget.value;m||w(b.includes(t)?b.filter(e=>e!==t):[...b,t])},size:u},children:(0,r.jsx)(o.Input.Wrapper,{size:u,ref:t,...h,...x,labelElement:"div",__staticSelector:"SwitchGroup",children:(0,r.jsx)(s.F,{role:"group",children:p})})})});d.classes=o.Input.Wrapper.classes,d.displayName="@mantine/core/SwitchGroup"},57613:(e,t,l)=>{"use strict";l.d(t,{useUncontrolled:()=>a});var r=l(12115);function a(e){let{value:t,defaultValue:l,finalValue:a,onChange:i=()=>{}}=e,[n,s]=(0,r.useState)(void 0!==l?l:a);return void 0!==t?[t,i,!0]:[n,function(e){for(var t=arguments.length,l=Array(t>1?t-1:0),r=1;r<t;r++)l[r-1]=arguments[r];s(e),null==i||i(e,...l)},!1]}},61262:()=>{},66121:(e,t,l)=>{"use strict";l.d(t,{Switch:()=>y});var r=l(95155),a=l(64173),i=l(57613);l(12115);var n=l(56204),s=l(68918),o=l(71180),c=l(43664),d=l(53791),u=l(99537),h=l(69604),p=l(36960),m=l(20563),x=l(40837),b=l(56470),w={root:"m_5f93f3bb",input:"m_926b4011",track:"m_9307d992",thumb:"m_93039a1d",trackLabel:"m_8277e082"};let f={labelPosition:"right",withThumbIndicator:!0},v=(0,s.createVarsResolver)((e,t)=>{let{radius:l,color:r,size:a}=t;return{root:{"--switch-radius":void 0===l?void 0:(0,n.getRadius)(l),"--switch-height":(0,n.getSize)(a,"switch-height"),"--switch-width":(0,n.getSize)(a,"switch-width"),"--switch-thumb-size":(0,n.getSize)(a,"switch-thumb-size"),"--switch-label-font-size":(0,n.getSize)(a,"switch-label-font-size"),"--switch-track-label-padding":(0,n.getSize)(a,"switch-track-label-padding"),"--switch-color":r?(0,o.getThemeColor)(r,e):void 0}}}),y=(0,p.factory)((e,t)=>{var l;let n=(0,c.useProps)("Switch",f,e),{classNames:s,className:o,style:p,styles:b,unstyled:y,vars:g,color:k,label:S,offLabel:_,onLabel:j,id:C,size:z,radius:B,wrapperProps:E,thumbIcon:I,checked:F,defaultChecked:P,onChange:N,labelPosition:M,description:G,error:R,disabled:U,variant:W,rootRef:T,mod:V,withThumbIndicator:D,attributes:L,...O}=n,A=(0,x.U)(),H=z||(null==A?void 0:A.size),q=(0,d.useStyles)({name:"Switch",props:n,classes:w,className:o,style:p,classNames:s,styles:b,unstyled:y,attributes:L,vars:g,varsResolver:v}),{styleProps:J,rest:K}=(0,u.extractStyleProps)(O),Q=(0,a.useId)(C),X=A?{checked:A.value.includes(K.value),onChange:A.onChange}:{},[Y,Z]=(0,i.useUncontrolled)({value:null!=(l=X.checked)?l:F,defaultValue:P,finalValue:!1});return(0,r.jsxs)(m.I,{...q("root"),__staticSelector:"Switch",__stylesApiProps:n,id:Q,size:H,labelPosition:M,label:S,description:G,error:R,disabled:U,bodyElement:"label",labelElement:"span",classNames:s,styles:b,unstyled:y,"data-checked":X.checked||F||void 0,variant:W,ref:T,mod:V,...J,...E,children:[(0,r.jsx)("input",{...K,disabled:U,checked:Y,"data-checked":X.checked||F||void 0,onChange:e=>{var t;A?null==(t=X.onChange)||t.call(X,e):null==N||N(e),Z(e.currentTarget.checked)},id:Q,ref:t,type:"checkbox",role:"switch",...q("input")}),(0,r.jsxs)(h.Box,{"aria-hidden":"true",component:"span",mod:{error:R,"label-position":M,"without-labels":!j&&!_},...q("track"),children:[(0,r.jsx)(h.Box,{component:"span",mod:{"reduce-motion":!0,"with-thumb-indicator":D&&!I},...q("thumb"),children:I}),(0,r.jsx)("span",{...q("trackLabel"),children:Y?j:_})]})]})});y.classes={...w,...m.M},y.displayName="@mantine/core/Switch",y.Group=b.SwitchGroup},71400:(e,t,l)=>{Promise.resolve().then(l.bind(l,49153))}},e=>{e.O(0,[2401,8198,642,4771,8805,8413,6634,3722,3464,2996,6874,630,6933,8441,5964,7358],()=>e(e.s=71400)),_N_E=e.O()}]);