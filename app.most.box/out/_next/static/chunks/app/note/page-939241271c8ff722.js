(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5555],{47296:()=>{},55242:(e,t,n)=>{Promise.resolve().then(n.bind(n,99580))},99580:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>S});var a=n(95155),l=n(12115),r=n(60688),s=n(67661),i=n(96778),o=n(13877),c=n(67623),d=n(21155),u=n(40387),h=n(63090),p=n(90101),x=n(61505);n(47296);var f=n(20063),w=n(13297),k=n(29311),m=n(21794),y=n(59126),g=n(56612),j=n(52619),v=n.n(j),b=n(90982);let C=()=>{let e=(0,f.useSearchParams)(),t=(0,w.k)(e=>e.wallet),n=(0,w.k)(e=>e.updateRootCID),j=(0,k.E)(e=>e.dotCID),[C,S]=(0,l.useState)(!0),[E,_]=(0,l.useState)(null),[B,M]=(0,l.useState)(null),z=(0,x.B)(),[N,D]=(0,l.useState)(""),[F,O]=(0,l.useState)(!1),[P,R]=(0,l.useState)(!1),[H,I]=(0,l.useState)(!1),[T,L]=(0,l.useState)(""),A=(e,t)=>{let n=new URL(window.location.href);n.searchParams.set("cid",e),t&&n.searchParams.set("uid",t),window.history.replaceState(null,"",n.href)},G=e=>{fetch("".concat(j,"/ipfs/").concat(e,"/index.md")).then(e=>e.text()).then(e=>{I(!0),R(!1),D(e)}).catch(e=>{console.error("Error:",e)}).finally(()=>{S(!1)})};(0,l.useEffect)(()=>{if(H&&t&&N.startsWith("mp://2")){let e=(0,g.OM)(N,t.public_key,t.private_key);e&&(R(!0),D(e))}},[H,t,N]);let U=async(e,a)=>{var l,r;t&&P&&(a=(0,g.yO)(a,t.public_key,t.private_key));let s=new FormData,i=new Blob([a],{type:"text/markdown"});s.append("file",i,"index.md"),s.append("path","/.note/".concat(e,"/index.md"));try{let a=null==(l=(await m.FH.put("/files.upload",s)).data)?void 0:l.cid;a&&(A(a,null==t?void 0:t.address),n(),y.notifications.show({message:"".concat(e," 保存成功"),color:"green"}))}catch(t){let e=(null==t||null==(r=t.response)?void 0:r.data)||"文件上传失败，请重试";e.includes("already has")&&(e="文件已存在"),y.notifications.show({title:"保存失败",message:e,color:"red"})}},V=async()=>{J.current&&_(await z.initViewer(J.current)),K.current&&M(await z.initEditor(K.current))},W=async()=>{let t=e.get("uid"),n=e.get("name");if(t&&n)try{let e=(await m.FH.get("/files.cid/".concat(t,"/.note/").concat(n))).data;if(e){A(e),G(e);return}}catch(e){console.info(e)}let a=e.get("cid");a&&G(a)},q=(0,l.useMemo)(()=>{let t="笔记",n=e.get("name");return n&&(t=n),P&&(t="\uD83D\uDD12 "+t),t},[P]);(0,l.useEffect)(()=>{H&&(null==E||E.setMarkdown(N),null==B||B.setMarkdown(N))},[H,N,E,B]);let J=(0,l.useRef)(null),K=(0,l.useRef)(null),Q=(0,w.k)(e=>e.nodeDark);return(0,l.useEffect)(()=>{V()},[]),(0,l.useEffect)(()=>{j&&W()},[j]),(0,a.jsxs)(o.Container,{id:"page-note",children:[(0,a.jsx)(p.AppHeader,{title:q,variant:"text",right:(0,a.jsx)(s.Group,{gap:"xs",wrap:"nowrap",children:F?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Button,{size:"xs",onClick:()=>{if(B){let t=B.getMarkdown();D(t);let n=e.get("name");n?U(n,t):b.modals.openConfirmModal({centered:!0,title:"保存笔记",children:(0,a.jsx)(r.TextInput,{placeholder:"请输入笔记名称",value:T,onChange:e=>L(e.currentTarget.value)}),labels:{confirm:"保存",cancel:"取消"},onConfirm:()=>{console.log(T)}})}O(!1)},children:"保存"}),(0,a.jsx)(i.Button,{size:"xs",variant:"outline",onClick:()=>{B&&B.setMarkdown(N),O(!1)},children:"取消"})]}):t?(0,a.jsx)(i.Button,{size:"xs",onClick:()=>O(!0),children:"编辑"}):(0,a.jsx)(i.Button,{size:"xs",variant:"gradient",component:v(),href:"/login",children:"编辑"})})}),(0,a.jsx)(c.Box,{id:"viewer-box",className:Q,ref:J,style:{display:F?"none":"block"}}),(0,a.jsx)(c.Box,{id:"editor-box",className:Q,ref:K,style:{display:F?"block":"none"}}),(0,a.jsx)(c.Box,{id:"switch-box",style:{display:F?"block":"none"},children:(0,a.jsx)(d.Switch,{checked:P,onChange:e=>R(e.currentTarget.checked),label:P?"加密":"公开"})}),C&&(0,a.jsx)(u.Center,{mt:"md",children:(0,a.jsx)(h.Loader,{size:"xl",type:"dots"})})]})},S=()=>(0,a.jsx)(l.Suspense,{children:(0,a.jsx)(C,{})})}},e=>{e.O(0,[3249,642,2794,5619,6714,8555,8835,5125,6476,9287,291,6101,101,8289,8441,1255,7358],()=>e(e.s=55242)),_N_E=e.O()}]);