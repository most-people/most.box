(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5555],{47296:()=>{},71400:(e,t,n)=>{Promise.resolve().then(n.bind(n,99580))},99580:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>C});var a=n(95155),l=n(12115),r=n(60688),s=n(67661),i=n(96778),o=n(13877),c=n(67623),d=n(21155),u=n(40387),h=n(63090),x=n(90101),f=n(61505);n(47296);var p=n(20063),w=n(13297),k=n(21794),m=n(59126),y=n(56612),g=n(52619),j=n.n(g),v=n(90982);let b=()=>{let e=(0,p.useSearchParams)(),t=(0,w.k)(e=>e.dotCID),n=(0,w.k)(e=>e.wallet),[g,b]=(0,l.useState)(!0),[C,S]=(0,l.useState)(null),[_,B]=(0,l.useState)(null),E=(0,f.B)(),[M,z]=(0,l.useState)(""),[N,F]=(0,l.useState)(!1),[O,P]=(0,l.useState)(!1),[D,H]=(0,l.useState)(!1),[R,T]=(0,l.useState)("123123"),I=(e,t)=>{let n=new URL(window.location.href);n.searchParams.set("cid",e),t&&n.searchParams.set("uid",t),window.history.replaceState(null,"",n.href)},L=e=>{fetch("".concat(t,"/ipfs/").concat(e,"/index.md")).then(e=>e.text()).then(e=>{H(!0),P(!1),z(e)}).catch(e=>{console.error("Error:",e)}).finally(()=>{b(!1)})};(0,l.useEffect)(()=>{if(D&&n&&M.startsWith("mp://2")){let e=(0,y.OM)(M,n.public_key,n.private_key);e&&(P(!0),z(e))}},[D,n,M]);let A=async(e,t)=>{var a,l;n&&O&&(t=(0,y.yO)(t,n.public_key,n.private_key));let r=new FormData,s=new Blob([t],{type:"text/markdown"});r.append("file",s,"index.md"),r.append("path","/.note/".concat(e,"/index.md"));try{let t=null==(a=(await k.FH.put("/files.upload",r)).data)?void 0:a.cid;t&&(I(t,null==n?void 0:n.address),m.notifications.show({message:"".concat(e," 保存成功"),color:"green"}))}catch(t){let e=(null==t||null==(l=t.response)?void 0:l.data)||"文件上传失败，请重试";e.includes("already has")&&(e="文件已存在"),m.notifications.show({title:"保存失败",message:e,color:"red"})}},G=async()=>{W.current&&S(await E.initViewer(W.current)),q.current&&B(await E.initEditor(q.current))},U=async()=>{let t=e.get("uid"),n=e.get("name");if(t&&n)try{let e=(await k.FH.get("/files.find.cid/".concat(t,"/.note/").concat(n))).data;if(e){I(e),L(e);return}}catch(e){console.info(e)}let a=e.get("cid");a&&L(a)},V=(0,l.useMemo)(()=>{let t="笔记",n=e.get("name");return n&&(t=n),O&&(t="\uD83D\uDD12 "+t),t},[O]);(0,l.useEffect)(()=>{D&&(null==C||C.setMarkdown(M),null==_||_.setMarkdown(M))},[D,M,C,_]);let W=(0,l.useRef)(null),q=(0,l.useRef)(null),J=(0,w.k)(e=>e.nodeDark);return(0,l.useEffect)(()=>{G()},[]),(0,l.useEffect)(()=>{t&&U()},[t]),(0,a.jsxs)(o.Container,{id:"page-note",children:[(0,a.jsx)(x.AppHeader,{title:V,variant:"text",right:(0,a.jsx)(s.Group,{gap:"xs",wrap:"nowrap",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Button,{size:"xs",onClick:()=>{if(_){let t=_.getMarkdown();z(t);let n=e.get("name");n?A(n,t):v.modals.openConfirmModal({centered:!0,title:"保存笔记",children:(0,a.jsx)(r.TextInput,{placeholder:"请输入笔记名称",value:R,onChange:e=>T(e.currentTarget.value)}),labels:{confirm:"保存",cancel:"取消"},onConfirm:()=>{console.log(R)}})}F(!1)},children:"保存"}),(0,a.jsx)(i.Button,{size:"xs",variant:"outline",onClick:()=>{_&&_.setMarkdown(M),F(!1)},children:"取消"})]}):n?(0,a.jsx)(i.Button,{size:"xs",onClick:()=>F(!0),children:"编辑"}):(0,a.jsx)(i.Button,{size:"xs",variant:"gradient",component:j(),href:"/login",children:"编辑"})})}),(0,a.jsx)(c.Box,{id:"viewer-box",className:J,ref:W,style:{display:N?"none":"block"}}),(0,a.jsx)(c.Box,{id:"editor-box",className:J,ref:q,style:{display:N?"block":"none"}}),(0,a.jsx)(c.Box,{id:"switch-box",style:{display:N?"block":"none"},children:(0,a.jsx)(d.Switch,{checked:O,onChange:e=>P(e.currentTarget.checked),label:O?"加密":"公开"})}),g&&(0,a.jsx)(u.Center,{mt:"md",children:(0,a.jsx)(h.Loader,{size:"xl",type:"dots"})})]})},C=()=>(0,a.jsx)(l.Suspense,{children:(0,a.jsx)(b,{})})}},e=>{e.O(0,[3249,8198,642,2829,5619,6714,8555,8990,5125,9287,3252,6101,101,8289,8441,1255,7358],()=>e(e.s=71400)),_N_E=e.O()}]);