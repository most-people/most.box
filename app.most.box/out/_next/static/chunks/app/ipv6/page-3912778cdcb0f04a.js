(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7278],{2769:(e,t,a)=>{Promise.resolve().then(a.bind(a,27136))},8593:(e,t,a)=>{"use strict";a.d(t,{TextInput:()=>i});var r=a(95155);a(12115);var n=a(43664),c=a(36960),o=a(24225);let i=(0,c.factory)((e,t)=>{let a=(0,n.useProps)("TextInput",null,e);return(0,r.jsx)(o.InputBase,{component:"input",ref:t,...a,__staticSelector:"TextInput"})});i.classes=o.InputBase.classes,i.displayName="@mantine/core/TextInput"},21220:(e,t,a)=>{"use strict";a.d(t,{Stack:()=>h});var r=a(95155);a(12115);var n=a(56204),c=a(68918),o=a(43664),i=a(53791),s=a(69604),l=a(36960),u={root:"m_6d731127"};let d={gap:"md",align:"stretch",justify:"flex-start"},p=(0,c.createVarsResolver)((e,t)=>{let{gap:a,align:r,justify:c}=t;return{root:{"--stack-gap":(0,n.getSpacing)(a),"--stack-align":r,"--stack-justify":c}}}),h=(0,l.factory)((e,t)=>{let a=(0,o.useProps)("Stack",d,e),{classNames:n,className:c,style:l,styles:h,unstyled:f,vars:m,align:y,justify:g,gap:v,variant:S,attributes:w,...x}=a,T=(0,i.useStyles)({name:"Stack",props:a,classes:u,className:c,style:l,classNames:n,styles:h,unstyled:f,attributes:w,vars:m,varsResolver:p});return(0,r.jsx)(s.Box,{ref:t,...T("root"),variant:S,...x})});h.classes=u,h.displayName="@mantine/core/Stack"},24225:(e,t,a)=>{"use strict";a.d(t,{InputBase:()=>s});var r=a(95155);a(12115);var n=a(64511),c=a(54853),o=a(83746);let i={__staticSelector:"InputBase",withAria:!0},s=(0,n.polymorphicFactory)((e,t)=>{let{inputProps:a,wrapperProps:n,...s}=(0,o.useInputProps)("InputBase",i,e);return(0,r.jsx)(c.Input.Wrapper,{...n,children:(0,r.jsx)(c.Input,{...a,...s,ref:t})})});s.classes={...c.Input.classes,...c.Input.Wrapper.classes},s.displayName="@mantine/core/InputBase"},27136:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var r=a(95155),n=a(80630),c=a(91590),o=a(21220),i=a(93751),s=a(70112),l=a(8593),u=a(26903),d=a(97287),p=a(58887),h=a(12115);let f="http://localhost:1976",m="".concat(f,"/api.signaling/sse"),y="".concat(f,"/api.signaling");function g(){let[e,t]=(0,h.useState)("demo-room"),[a]=(0,h.useState)(()=>"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():String(Math.random()).slice(2)),[f,g]=(0,h.useState)(null),[v,S]=(0,h.useState)(!1),[w,x]=(0,h.useState)([]),T=(0,h.useRef)(null),I=(0,h.useRef)(null),P=(0,h.useRef)(null),j=(0,h.useRef)(null),C=(0,h.useRef)(null),k=(0,h.useRef)([]),R=e=>x(t=>[e,...t].slice(0,200)),b=async e=>{try{var t;let a=await fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await a.json().catch(()=>({}));R("POST ".concat(e.type," -> delivered: ").concat(null!=(t=r.delivered)?t:0))}catch(e){R("POST error: ".concat((null==e?void 0:e.message)||e))}},D=async()=>{let t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});t.oniceconnectionstatechange=()=>{R("iceConnectionState=".concat(t.iceConnectionState))},t.onconnectionstatechange=()=>{R("connectionState=".concat(t.connectionState))},t.onicecandidate=t=>{t.candidate&&b({roomId:e,from:a,type:"candidate",payload:t.candidate})},t.ontrack=e=>{if(R("ontrack: kind=".concat(e.track.kind)),!j.current)return;let[t]=e.streams;t&&(j.current.srcObject=t,j.current.play().then(()=>R("remote element playing")).catch(e=>R("remote play blocked: ".concat(e))))};try{let e=await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:640,height:360}});C.current=e,P.current&&(P.current.srcObject=e,await P.current.play().catch(()=>{})),e.getTracks().forEach(a=>t.addTrack(a,e))}catch(a){R("getUserMedia video failed, fallback to audio-only: ".concat(a));let e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});C.current=e,P.current&&(P.current.srcObject=e,await P.current.play().catch(()=>{})),e.getTracks().forEach(a=>t.addTrack(a,e))}return I.current=t,t},E=async t=>{try{g(t),k.current=[],R("connect as ".concat(t,", room=").concat(e,", id=").concat(a)),await D(),T.current&&T.current.close();let r="".concat(m,"?roomId=").concat(encodeURIComponent(e),"&clientId=").concat(encodeURIComponent(a));R("SSE subscribe: ".concat(r));let n=new EventSource(r,{withCredentials:!1});if(n.onopen=()=>{var t;R("SSE opened"),S(!0);let r=I.current;"caller"===f&&(null==r||null==(t=r.localDescription)?void 0:t.type)==="offer"&&(b({roomId:e,from:a,type:"offer",payload:r.localDescription}),R("re-sent offer after SSE open"))},n.onerror=e=>{R("SSE error: ".concat(JSON.stringify(e)))},n.onmessage=async t=>{try{let r=JSON.parse(t.data);if(!r||!r.type)return;if("hello"===r.type)return void R("SSE hello from ".concat(r.from||"server"));R("SSE message: ".concat(r.type," from ").concat(r.from));let n=I.current;if(!n)return;if("offer"===r.type&&"callee"===f){if(await n.setRemoteDescription(new RTCSessionDescription(r.payload)),k.current.length)for(let e of k.current.splice(0))try{await n.addIceCandidate(new RTCIceCandidate(e))}catch(e){R("drain candidate error: ".concat(e))}let t=await n.createAnswer();await n.setLocalDescription(t),await b({roomId:e,from:a,type:"answer",payload:t})}else if("answer"===r.type&&"caller"===f){if(await n.setRemoteDescription(new RTCSessionDescription(r.payload)),k.current.length)for(let e of k.current.splice(0))try{await n.addIceCandidate(new RTCIceCandidate(e))}catch(e){R("drain candidate error: ".concat(e))}}else if("candidate"===r.type)try{n.remoteDescription?await n.addIceCandidate(new RTCIceCandidate(r.payload)):(k.current.push(r.payload),R("queued remote ICE candidate"))}catch(e){R("addIceCandidate error: ".concat(e))}}catch(e){R("onmessage parse error: ".concat(e))}},T.current=n,"caller"===t){let t=I.current,r=await t.createOffer();await t.setLocalDescription(r),await b({roomId:e,from:a,type:"offer",payload:r})}}catch(e){R("connect error: ".concat((null==e?void 0:e.message)||e))}};return(0,r.jsxs)(c.Container,{py:"md",children:[(0,r.jsx)(n.AppHeader,{title:"WebRTC Demo (HTTP + SSE)"}),(0,r.jsxs)(o.Stack,{gap:"md",children:[(0,r.jsx)(i.Title,{order:3,children:"WebRTC Demo - HTTP + SSE"}),(0,r.jsxs)(s.Group,{align:"center",children:[(0,r.jsx)(l.TextInput,{label:"房间 ID",value:e,onChange:e=>t(e.currentTarget.value),placeholder:"请输入房间 ID（让双方一致）",style:{minWidth:260}}),(0,r.jsx)(u.Button,{onClick:()=>E("caller"),disabled:v,children:"作为 Caller 建连"}),(0,r.jsx)(u.Button,{onClick:()=>E("callee"),disabled:v,children:"作为 Callee 等待"}),(0,r.jsx)(u.Button,{color:"red",variant:"light",onClick:()=>{var e,t;null==(e=T.current)||e.close(),T.current=null,S(!1);let a=I.current;a&&(a.getSenders().forEach(e=>{try{var t;null==(t=e.track)||t.stop()}catch(e){}}),a.onicecandidate=null,a.ontrack=null,a.close(),I.current=null),null==(t=C.current)||t.getTracks().forEach(e=>e.stop()),C.current=null,k.current=[],R("disconnected")},children:"断开"}),"caller"===f&&(0,r.jsx)(u.Button,{variant:"outline",onClick:()=>{var t;let r=I.current;(null==r||null==(t=r.localDescription)?void 0:t.type)==="offer"?(b({roomId:e,from:a,type:"offer",payload:r.localDescription}),R("手动重发 Offer")):R("当前没有可重发的 Offer（请先作为 Caller 建连）")},children:"重发 Offer"})]}),(0,r.jsxs)(s.Group,{align:"flex-start",grow:!0,children:[(0,r.jsxs)(d.Paper,{p:"sm",withBorder:!0,children:[(0,r.jsx)(p.Text,{fw:500,mb:4,children:"本地流"}),(0,r.jsx)("video",{ref:P,playsInline:!0,autoPlay:!0,muted:!0,style:{width:320}})]}),(0,r.jsxs)(d.Paper,{p:"sm",withBorder:!0,children:[(0,r.jsx)(p.Text,{fw:500,mb:4,children:"远端流"}),(0,r.jsx)("video",{ref:j,playsInline:!0,autoPlay:!0,style:{width:320}})]})]}),(0,r.jsxs)(d.Paper,{p:"sm",withBorder:!0,children:[(0,r.jsx)(p.Text,{fw:500,mb:8,children:"日志"}),(0,r.jsx)(o.Stack,{gap:4,style:{maxHeight:240,overflowY:"auto"},children:w.map((e,t)=>(0,r.jsx)(p.Text,{size:"xs",c:"dimmed",children:e},t))})]})]})]})}},35695:(e,t,a)=>{"use strict";var r=a(18999);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},83746:(e,t,a)=>{"use strict";a.d(t,{useInputProps:()=>c}),a(12115),a(95155);var r=a(43664),n=a(99537);function c(e,t,a){let c=(0,r.useProps)(e,t,a),{label:o,description:i,error:s,required:l,classNames:u,styles:d,className:p,unstyled:h,__staticSelector:f,__stylesApiProps:m,errorProps:y,labelProps:g,descriptionProps:v,wrapperProps:S,id:w,size:x,style:T,inputContainer:I,inputWrapperOrder:P,withAsterisk:j,variant:C,vars:k,mod:R,attributes:b,...D}=c,{styleProps:E,rest:_}=(0,n.extractStyleProps)(D),B={label:o,description:i,error:s,required:l,classNames:u,className:p,__staticSelector:f,__stylesApiProps:m||c,errorProps:y,labelProps:g,descriptionProps:v,unstyled:h,styles:d,size:x,style:T,inputContainer:I,inputWrapperOrder:P,withAsterisk:j,variant:C,id:w,mod:R,attributes:b,...S};return{..._,classNames:u,styles:d,unstyled:h,wrapperProps:{...B,...E},inputProps:{required:l,classNames:u,styles:d,unstyled:h,size:x,__staticSelector:f,__stylesApiProps:m||c,error:s,variant:C,id:w,attributes:b}}}},93751:(e,t,a)=>{"use strict";a.d(t,{Title:()=>m});var r=a(95155);a(12115);var n=a(68918),c=a(43664),o=a(53791),i=a(69604),s=a(36960),l=a(5903);let u=["h1","h2","h3","h4","h5","h6"],d=["xs","sm","md","lg","xl"];var p={root:"m_8a5d1357"};let h={order:1},f=(0,n.createVarsResolver)((e,t)=>{let{order:a,size:r,lineClamp:n,textWrap:c}=t,o=function(e,t){let a=void 0!==t?t:"h".concat(e);return u.includes(a)?{fontSize:"var(--mantine-".concat(a,"-font-size)"),fontWeight:"var(--mantine-".concat(a,"-font-weight)"),lineHeight:"var(--mantine-".concat(a,"-line-height)")}:d.includes(a)?{fontSize:"var(--mantine-font-size-".concat(a,")"),fontWeight:"var(--mantine-h".concat(e,"-font-weight)"),lineHeight:"var(--mantine-h".concat(e,"-line-height)")}:{fontSize:(0,l.D)(a),fontWeight:"var(--mantine-h".concat(e,"-font-weight)"),lineHeight:"var(--mantine-h".concat(e,"-line-height)")}}(a||1,r);return{root:{"--title-fw":o.fontWeight,"--title-lh":o.lineHeight,"--title-fz":o.fontSize,"--title-line-clamp":"number"==typeof n?n.toString():void 0,"--title-text-wrap":c}}}),m=(0,s.factory)((e,t)=>{let a=(0,c.useProps)("Title",h,e),{classNames:n,className:s,style:l,styles:u,unstyled:d,order:m,vars:y,size:g,variant:v,lineClamp:S,textWrap:w,mod:x,attributes:T,...I}=a,P=(0,o.useStyles)({name:"Title",props:a,classes:p,className:s,style:l,classNames:n,styles:u,unstyled:d,attributes:T,vars:y,varsResolver:f});return[1,2,3,4,5,6].includes(m)?(0,r.jsx)(i.Box,{...P("root"),component:"h".concat(m),variant:v,ref:t,mod:[{order:m,"data-line-clamp":"number"==typeof S},x],size:g,...I}):null});m.classes=p,m.displayName="@mantine/core/Title"},97287:(e,t,a)=>{"use strict";a.d(t,{Paper:()=>p});var r=a(95155);a(12115);var n=a(56204),c=a(68918),o=a(43664),i=a(53791),s=a(69604),l=a(64511),u={root:"m_1b7284a3"};let d=(0,c.createVarsResolver)((e,t)=>{let{radius:a,shadow:r}=t;return{root:{"--paper-radius":void 0===a?void 0:(0,n.getRadius)(a),"--paper-shadow":(0,n.getShadow)(r)}}}),p=(0,l.polymorphicFactory)((e,t)=>{let a=(0,o.useProps)("Paper",null,e),{classNames:n,className:c,style:l,styles:p,unstyled:h,withBorder:f,vars:m,radius:y,shadow:g,variant:v,mod:S,attributes:w,...x}=a,T=(0,i.useStyles)({name:"Paper",props:a,classes:u,className:c,style:l,classNames:n,styles:p,unstyled:h,attributes:w,vars:m,varsResolver:d});return(0,r.jsx)(s.Box,{ref:t,mod:[{"data-with-border":f},S],...T("root"),variant:v,...x})});p.classes=u,p.displayName="@mantine/core/Paper"}},e=>{e.O(0,[1257,2996,630,8441,5964,7358],()=>e(e.s=2769)),_N_E=e.O()}]);