(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1435],{25173:(e,t,n)=>{Promise.resolve().then(n.bind(n,81954))},81954:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>C});var r=n(95155),i=n(90101),s=n(44634),l=n(70305),a=n(67623),o=n(21179),d=n(67661),u=n(17998),c=n(96778),h=n(2369),x=n(75122),m=n(13877),p=n(60688),g=n(71165),j=n(77901),f=n(54025),v=n(82707),b=n(1371),k=n(12115);function w(e){let t=0,n=0;for(let r of e)t+=r.value,"A"===r.rank&&n++;for(;t>21&&n>0;)t-=10,n--;let r=2===e.length&&21===t,i=e.some(e=>"A"===e.rank)&&t<=21&&n>0;return{total:t,isSoft:i,isBlackjack:r}}function y(e){let{card:t}=e,n="♥"===t.suit||"♦"===t.suit;return(0,r.jsx)(s.Card,{style:{width:52,height:72,borderRadius:8,background:"var(--mantine-color-6)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(l.Text,{c:n?"red":"black",fw:700,size:"lg",children:"".concat(t.rank).concat(t.suit)})})}function B(){return(0,r.jsx)(a.Box,{style:{width:52,height:72,borderRadius:8,border:"1px dashed var(--mantine-color-dark-4)",background:"repeating-linear-gradient(45deg, var(--mantine-color-dark-6), var(--mantine-color-dark-6) 8px, var(--mantine-color-dark-5) 8px, var(--mantine-color-dark-5) 16px)"}})}function C(){var e,t,n,a;let[C,O]=(0,k.useState)([]),[M,S]=(0,k.useState)({hand:[],hideHole:!0}),[G,z]=(0,k.useState)([]),[D,T]=(0,k.useState)(-1),[A,H]=(0,k.useState)(""),[I,N]=(0,k.useState)(1),[_,E]=(0,k.useState)("betting"),[P,R]=(0,k.useState)(!1),[J,K]=(0,k.useState)(null),[Q,q]=(0,k.useState)(!1);function F(e,t){let n=e.filter(e=>!e.isOut);if(0===n.length)return null;if(!t)return n[0].id;let r=e.map(e=>e.id),i=Math.max(0,r.indexOf(t))+1;for(let t=0;t<r.length;t++){let t=r[i%r.length],n=e.find(e=>e.id===t);if(n&&!n.isOut)return n.id;i++}return n[0].id}function L(){let e=null!=J?J:F(C,J),t=C.filter(t=>t.id!==e&&!t.isOut);return 0!==t.length&&t.every(e=>{let t="number"==typeof e.bet?e.bet:0;return t>0&&t<=e.coins})}let U="betting"===_&&C.filter(e=>!e.isOut).length>=2&&L(),V=(0,k.useMemo)(()=>w(M.hand),[M.hand]);function W(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[];for(let r=0;r<t;r++){let t=e.pop();if(!t)throw Error("牌堆已空");n.push(t)}return n}function X(){let e=[...G],[t]=W(e);return z(e),t}function Y(){T(e=>{let t=C.findIndex((t,n)=>n>e&&"pending"===t.status&&!t.isDealer&&!t.isOut);return -1===t?(S(e=>({...e,hideHole:!1})),q(!0),-1):t})}function Z(){if(D<0||P)return;R(!0);let e=X(),t=[...C],n={...t[D]};n.hand=[...n.hand,e];let r=w(n.hand).total;r>21?n.status="bust":21===r&&(n.status="stand"),t[D]=n,O(t),setTimeout(()=>{var e;let n=t[D];(w(null!=(e=null==n?void 0:n.hand)?e:[]).total>=21||(null==n?void 0:n.status)!=="pending")&&Y(),R(!1)},0)}function $(){D<0||(O(e=>{let t=[...e];return t[D]={...t[D],status:"stand"},t}),Y())}function ee(){let e=w(M.hand).total;O(t=>{let n=0;return t.map(t=>{var r;let i;if(t.isDealer)return{...t};if(t.isOut)return{...t,result:void 0};let s=w(t.hand).total;i="bust"===t.status?"lose":e>21||"blackjack"===t.status&&21!==e||s>e?"win":s<e?"lose":"push";let l=Math.max(0,Math.min(null!=(r=t.bet)?r:0,t.coins));"win"===i?n-=l:"lose"===i&&(n+=l);let a="win"===i?t.coins+l:"lose"===i?Math.max(0,t.coins-l):t.coins,o=a<=0||t.isOut;return{...t,result:i,coins:a,isOut:o}}).map(e=>{if(!e.isDealer)return e;let t=Math.max(0,e.coins+n),r=n>0?"win":n<0?"lose":"push";return{...e,coins:t,result:r,isOut:t<=0||e.isOut}})}),E("settled"),q(!1)}function et(e){var t;let{player:n}=e,i=e=>{O(t=>t.map(t=>t.id===n.id?{...t,bet:Math.max(1,Math.min(Math.floor(e)||0,t.coins))}:t))};return(0,r.jsxs)(h.Stack,{gap:6,style:{width:"100%"},children:[(0,r.jsxs)(d.Group,{gap:"xs",wrap:"nowrap",children:[(0,r.jsx)(l.Text,{c:"gray.5",children:"下注"}),(0,r.jsx)(x.NumberInput,{value:null!=(t=n.bet)?t:0,onChange:e=>{i("number"==typeof e?e:Number(e))},min:1,max:n.coins,clampBehavior:"strict",inputMode:"numeric",style:{width:120}})]}),(0,r.jsxs)(d.Group,{gap:4,wrap:"wrap",children:[(0,r.jsx)(c.Button,{size:"xs",variant:"light",onClick:()=>i(10),children:"10"}),(0,r.jsx)(c.Button,{size:"xs",variant:"light",onClick:()=>i(20),children:"20"}),(0,r.jsx)(c.Button,{size:"xs",variant:"light",onClick:()=>i(50),children:"50"}),(0,r.jsx)(c.Button,{size:"xs",variant:"light",onClick:()=>i(Math.min(n.coins,100)),children:"最大"})]})]})}return(0,r.jsxs)(m.Container,{py:20,w:"100%",children:[(0,r.jsx)(i.AppHeader,{title:"二十一点"}),(0,r.jsxs)(s.Card,{radius:"md",withBorder:!0,mt:"md",p:"md",children:[(0,r.jsxs)(d.Group,{align:"center",gap:"xs",mb:"sm",children:[(0,r.jsx)(j.A,{size:18,color:"var(--mantine-color-blue-5)"}),(0,r.jsx)(l.Text,{children:"添加玩家"}),(0,r.jsxs)(u.Badge,{variant:"light",color:"blue",radius:"sm",size:"sm",children:[C.length,"/",6]})]}),(0,r.jsxs)(o.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",children:[(0,r.jsxs)(d.Group,{children:[(0,r.jsx)(p.TextInput,{placeholder:"例如：Alice",value:A,onChange:e=>H(e.currentTarget.value),style:{flex:1}}),(0,r.jsx)(c.Button,{size:"sm",onClick:()=>{A.trim()&&(O(e=>e.length>=6?e:[...e,{id:"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8)),name:A.trim(),hand:[],status:"pending",score:0,coins:100,bet:0,isDealer:!1,isOut:!1}]),H(""))},leftSection:(0,r.jsx)(j.A,{size:16}),disabled:C.length>=6,children:"添加"})]}),(0,r.jsxs)(d.Group,{children:[(0,r.jsx)(x.NumberInput,{value:I,onChange:e=>N("string"==typeof e?Number(e):e),min:1,max:6,clampBehavior:"strict",style:{width:120}}),(0,r.jsx)(c.Button,{size:"sm",variant:"light",onClick:()=>{var e;(e="number"==typeof I?I:1)<=0||O(t=>{let n=Math.min(Math.max(0,6-t.length),e),r=[];for(let e=0;e<n;e++){let n="".concat(Date.now(),"-").concat(e,"-").concat(Math.random().toString(36).slice(2,6));r.push({id:n,name:"玩家".concat(t.length+e+1),hand:[],status:"pending",score:0,coins:100,bet:0,isDealer:!1,isOut:!1})}return[...t,...r]})},leftSection:(0,r.jsx)(j.A,{size:16}),disabled:C.length>=6,children:"快速添加"})]})]}),(0,r.jsxs)(l.Text,{mt:"sm",c:"gray.5",children:["已添加 ",C.length,"/",6," 名；每人初始金币 100。"]}),(0,r.jsxs)(d.Group,{mt:"md",justify:"space-between",children:[(0,r.jsxs)(d.Group,{children:[(0,r.jsx)(c.Button,{onClick:function(){if(C.filter(e=>!e.isOut).length<2||!L())return;let e=function(){let e=["♠","♥","♦","♣"],t=[{r:"A",v:11},{r:"2",v:2},{r:"3",v:3},{r:"4",v:4},{r:"5",v:5},{r:"6",v:6},{r:"7",v:7},{r:"8",v:8},{r:"9",v:9},{r:"10",v:10},{r:"J",v:10},{r:"Q",v:10},{r:"K",v:10}],n=[];for(let r=0;r<2;r++)for(let r of e)for(let{r:e,v:i}of t)n.push({rank:e,value:i,suit:r});for(let e=n.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return n}();z(e);let t=null!=J?J:F(C,J);if(!t)return;K(t);let n=C.map(e=>({...e,hand:[],status:"pending",result:void 0,isDealer:e.id===t})),r={hand:[],hideHole:!0};for(let t=0;t<2;t++){for(let t=0;t<n.length;t++)n[t].isDealer||n[t].isOut||n[t].hand.push(...W(e));r.hand.push(...W(e))}let i=w(r.hand).isBlackjack;for(let e of n)e.isDealer||e.isOut||w(e.hand).isBlackjack&&(e.status="blackjack");if(O(n),S(r),E("playing"),i){O(()=>{let e=0;return n.map(t=>{var n;if(t.isDealer||t.isOut)return{...t};let r=w(t.hand).isBlackjack?"push":"lose",i=Math.max(0,Math.min(null!=(n=t.bet)?n:0,t.coins));"lose"===r&&(e+=i);let s="lose"===r?Math.max(0,t.coins-i):t.coins,l=s<=0||t.isOut;return{...t,status:t.status,result:r,coins:s,isOut:l}}).map(t=>{if(!t.isDealer)return t;let n=Math.max(0,t.coins+e),r=e>0?"win":e<0?"lose":"push";return{...t,coins:n,result:r,isOut:n<=0||t.isOut}})}),S({...r,hideHole:!1}),T(-1),E("settled"),q(!1);return}T(n.findIndex(e=>"pending"===e.status&&!e.isDealer&&!e.isOut)),q(!1)},disabled:!U,leftSection:(0,r.jsx)(f.A,{size:16,stroke:2}),children:"开始游戏"}),(0,r.jsx)(c.Button,{color:"orange",onClick:function(){let e=F(C,J);K(e),O(t=>t.map(t=>({...t,hand:[],status:"pending",result:void 0,isDealer:t.id===e}))),S({hand:[],hideHole:!0}),z([]),T(-1),q(!1),E("betting")},disabled:0===C.length||"settled"!==_,leftSection:(0,r.jsx)(v.A,{size:16,stroke:2}),children:"下一局"})]}),(0,r.jsx)(c.Button,{variant:"outline",color:"gray",onClick:function(){O([]),S({hand:[],hideHole:!0}),z([]),T(-1),E("betting"),K(null),q(!1)},leftSection:(0,r.jsx)(b.A,{size:16,stroke:2}),children:"重置"})]})]}),(0,r.jsx)(g.Divider,{variant:"dashed",labelPosition:"center",my:"md",label:"游戏区域"}),(0,r.jsxs)(h.Stack,{children:[(0,r.jsxs)(s.Card,{shadow:"md",withBorder:!0,radius:"md",p:"md",children:[(0,r.jsxs)(d.Group,{justify:"space-between",mb:8,children:[(0,r.jsxs)(d.Group,{gap:8,children:[(0,r.jsxs)(l.Text,{fw:700,children:["庄家",J?"：".concat(null!=(n=null==(e=C.find(e=>e.id===J))?void 0:e.name)?n:""):""]}),J&&(0,r.jsxs)(u.Badge,{color:"yellow",variant:"light",children:["金币：",null!=(a=null==(t=C.find(e=>e.id===J))?void 0:t.coins)?a:0]}),J&&(()=>{var e;let t=null==(e=C.find(e=>e.id===J))?void 0:e.result;return t?(0,r.jsx)(u.Badge,{color:"win"===t?"green":"lose"===t?"red":"yellow",children:"win"===t?"胜":"lose"===t?"负":"平"}):null})()]}),!M.hideHole&&(0,r.jsxs)(u.Badge,{color:V.total>21?"red":"gray",children:["点数：",V.total]})]}),(0,r.jsx)(d.Group,{children:M.hand.map((e,t)=>1===t&&M.hideHole?(0,r.jsx)(B,{},t):(0,r.jsx)(y,{card:e},t))}),Q&&"settled"!==_&&(0,r.jsxs)(d.Group,{mt:"sm",children:[(0,r.jsx)(c.Button,{onClick:function(){if(!Q||P)return;R(!0);let e=X(),t=[...M.hand,e];S({hand:t,hideHole:!1});let n=w(t);setTimeout(()=>{(n.total>21||21===n.total)&&ee(),R(!1)},0)},color:"red",disabled:P,children:"庄家要牌"}),(0,r.jsx)(c.Button,{onClick:function(){Q&&ee()},color:"blue",children:"庄家停牌"})]}),M.hideHole&&(0,r.jsx)(l.Text,{c:"gray.5",mt:"xs",children:"第二张牌未揭示"})]}),C.length>0?(0,r.jsx)(function(){return(0,r.jsx)(o.SimpleGrid,{cols:{base:1,sm:2,md:3},spacing:"md",children:C.filter(e=>!e.isDealer).map(e=>{let t=w(e.hand),n=C.findIndex(t=>t.id===e.id)===D;return(0,r.jsxs)(s.Card,{shadow:n?"md":"sm",radius:"md",p:"md",withBorder:!0,children:[(0,r.jsxs)(d.Group,{justify:"space-between",mb:8,children:[(0,r.jsxs)(d.Group,{gap:8,children:[(0,r.jsx)(l.Text,{fw:700,children:e.name}),(0,r.jsxs)(u.Badge,{color:"yellow",variant:"light",children:["金币：",e.coins]}),e.isOut&&(0,r.jsx)(u.Badge,{color:"red",children:"出局"}),n&&(0,r.jsx)(u.Badge,{color:"blue",children:"当前操作"})]}),(0,r.jsxs)(d.Group,{gap:8,children:["bust"===e.status&&(0,r.jsx)(u.Badge,{color:"red",children:"爆了"}),"blackjack"===e.status&&(0,r.jsx)(u.Badge,{color:"green",children:"黑杰克"}),"stand"===e.status&&(0,r.jsx)(u.Badge,{color:"gray",children:"停牌"}),e.result&&(0,r.jsx)(u.Badge,{color:"win"===e.result?"green":"lose"===e.result?"red":"yellow",children:"win"===e.result?"胜":"lose"===e.result?"负":"平"})]})]}),(0,r.jsx)(d.Group,{children:e.hand.map((e,t)=>(0,r.jsx)(y,{card:e},t))}),(0,r.jsxs)(d.Group,{justify:"space-between",mt:"sm",children:[(0,r.jsxs)(l.Text,{c:"gray.4",children:["点数：",t.total]}),"betting"===_&&!e.isOut&&(0,r.jsx)(et,{player:e}),n&&"playing"===_&&!e.isOut&&(0,r.jsxs)(d.Group,{children:[(0,r.jsx)(c.Button,{onClick:Z,color:"rgba(37, 132, 186, 0.8)",size:"sm",disabled:P,children:"要牌"}),(0,r.jsx)(c.Button,{onClick:$,variant:"gradient",size:"sm",children:"停牌"})]})]})]},e.id)})})},{}):(0,r.jsx)(s.Card,{withBorder:!0,radius:"md",p:"md",children:(0,r.jsx)(l.Text,{c:"gray.5",children:"请先添加至少一位玩家并点击开始游戏。"})})]})]})}}},e=>{e.O(0,[2829,9287,9919,5122,6816,101,8441,1255,7358],()=>e(e.s=25173)),_N_E=e.O()}]);