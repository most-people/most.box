(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4794],{7248:(e,s,t)=>{"use strict";t.d(s,{h:()=>r});var n=t(35695),a=t(48764);let r=()=>{let e=(0,a.k)(e=>e.firstPath),s=(0,a.k)(e=>e.setItem),t=(0,n.useRouter)(),r=(0,n.usePathname)();return()=>{e===r?(s("firstPath","/"),t.replace("/")):t.back()}}},10516:()=>{},56373:(e,s,t)=>{Promise.resolve().then(t.bind(t,92516))},72652:(e,s,t)=>{"use strict";t.d(s,{B:()=>y});var n=t(95155),a=t(69604),r=t(39926),l=t(59741),i=t(8141),o=t(26903),c=t(70112),d=t(81001),u=t(41954),x=t(63617),h=t(21220),m=t(58887),j=t(77213),p=t(53884),g=t(16701),v=t(56100),f=t(89243),b=t(755),A=t(12115),k=t(48764),C=t(9482),S=t(35695),T=t(6942),w=t(6874),z=t.n(w),I=t(30832),B=t.n(I);let y=e=>{let{messages:s,onSend:t,onDelete:w}=e,I=(0,j.useClipboard)(),[y,M]=(0,A.useState)(!1),[N,P]=(0,A.useState)(null),[D,E]=(0,A.useState)(null),[G,_]=(0,A.useState)(null),[R,F]=(0,A.useState)(""),H=(0,k.k)(e=>e.wallet),K=(0,S.usePathname)().split("/")[1],O=(0,A.useRef)(null);(0,A.useEffect)(()=>{var e;null==(e=O.current)||e.scrollIntoView({behavior:"smooth"})},[s]);let V=e=>{D&&clearTimeout(D),E(setTimeout(()=>{_(e)},500))},J=()=>{D&&(clearTimeout(D),E(null))},U=e=>{P(e),M(!0)},q=e=>{I.copy(e.text),T.notifications.show({message:"复制成功",color:"teal",autoClose:1e3}),_(null)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a.Box,{className:"messages",children:[s.map((e,t)=>{var i;let o=e.address===(null==H?void 0:H.address);return(0,n.jsxs)(a.Box,{className:"message-box ".concat(o?"me":""),onTouchStart:()=>V(e.timestamp),onTouchEnd:J,onTouchCancel:J,onContextMenu:s=>{s.preventDefault(),_(e.timestamp)},children:["topic"===K&&(0,n.jsx)(a.Box,{className:"avatar",component:z(),href:{pathname:"/friend",hash:e.address},children:e.address!==(null==H?void 0:H.address)&&e.address!==(null==(i=s[t+1])?void 0:i.address)&&(0,n.jsx)(r.Avatar,{src:C.A.avatar(e.address)})}),(0,n.jsxs)(l.Menu,{opened:G===e.timestamp,onChange:()=>G===e.timestamp&&_(null),position:o?"bottom-start":"bottom-end",children:[(0,n.jsx)(l.Menu.Target,{children:(0,n.jsx)(a.Box,{className:"message",children:(0,n.jsx)(a.Box,{className:"content",children:e.text})})}),(0,n.jsxs)(l.Menu.Dropdown,{children:[(0,n.jsx)(l.Menu.Item,{leftSection:(0,n.jsx)(p.A,{size:20}),onClick:()=>q(e),children:"复制"}),(0,n.jsx)(l.Menu.Item,{disabled:!o&&"friend"===K,leftSection:(0,n.jsx)(g.A,{size:20}),onClick:()=>U(e),children:"删除"})]})]})]},e.timestamp)}),(0,n.jsx)(a.Box,{ref:O})]}),!H&&(0,n.jsx)(i.Center,{children:(0,n.jsx)(o.Button,{mb:"lg",variant:"gradient",component:z(),href:"/login",children:"去登录"})}),(0,n.jsxs)(c.Group,{gap:"xs",className:"message-input",children:[(0,n.jsx)(d.ActionIcon,{variant:"subtle",color:"gray",size:"lg",children:(0,n.jsx)(v.A,{size:24})}),(0,n.jsx)(u.Textarea,{placeholder:"输入消息...",size:"md",radius:"md",autosize:!0,maxRows:4,style:{flex:1},value:R,onChange:e=>F(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),R.trim()&&(t(R),F("")))}}),(0,n.jsx)(d.ActionIcon,{variant:"subtle",color:"gray",size:"lg",children:(0,n.jsx)(f.A,{size:24})}),(0,n.jsx)(d.ActionIcon,{variant:"subtle",color:"gray",size:"lg",children:(0,n.jsx)(b.A,{size:24})})]}),(0,n.jsxs)(x.Modal,{opened:y,onClose:()=>M(!1),title:"确认要删除这个消息吗？",centered:!0,children:[N&&(0,n.jsxs)(h.Stack,{children:[(0,n.jsx)(m.Text,{size:"xl",children:N.text}),(0,n.jsxs)(m.Text,{c:"dimmed",children:[B()(N.timestamp).fromNow(),"：",C.A.formatTime(N.timestamp)]})]}),(0,n.jsxs)(c.Group,{justify:"space-between",children:[(0,n.jsx)(m.Text,{c:"dimmed",children:"删除后将无法恢复"}),(0,n.jsxs)(c.Group,{children:[(0,n.jsx)(o.Button,{onClick:()=>M(!1),variant:"default",children:"取消"}),(0,n.jsx)(o.Button,{onClick:()=>{N&&w&&w(N),M(!1),P(null),_(null)},children:"删除"})]})]})]})]})}},80630:(e,s,t)=>{"use strict";t.d(s,{AppHeader:()=>c});var n=t(95155),a=t(70112),r=t(81001),l=t(58887),i=t(30578),o=t(7248);let c=e=>{let{title:s,right:t}=e,c=(0,o.h)();return(0,n.jsxs)(a.Group,{className:"app-header",children:[(0,n.jsx)(r.ActionIcon,{variant:"transparent",onClick:c,color:"--text-color",children:(0,n.jsx)(i.I,{name:"back",size:24})}),(0,n.jsx)(l.Text,{lineClamp:2,variant:"gradient",children:s}),t||(0,n.jsx)(r.ActionIcon,{variant:"transparent",color:"--text-color",children:(0,n.jsx)(i.I,{name:"more",size:24})})]})}},92516:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>B});var n=t(95155),a=t(11681),r=t(65703),l=t(21220),i=t(69604),o=t(58887),c=t(90557),d=t(39926),u=t(54853),x=t(70112),h=t(66121),m=t(25345),j=t(26903),p=t(59741),g=t(70058),v=t(12115),f=t(9482),b=t(4673),A=t(80630),k=t(35695);t(10516);var C=t(72652),S=t(81603),T=t(16701),w=t(33139),z=t(7248);let I=e=>{let{onUpdate:s}=e,t=(0,k.useRouter)(),[r,{toggle:p}]=(0,a.useDisclosure)(!1),[g,A]=(0,v.useState)(""),[C,S]=(0,v.useState)(""),[T,w]=(0,v.useState)(!1);return(0,n.jsxs)(l.Stack,{gap:"md",className:"add-box",children:[(0,n.jsxs)(i.Box,{className:"header",children:[(0,n.jsx)(o.Text,{size:"xl",fw:500}),(0,n.jsx)(c.Space,{h:"sx"}),(0,n.jsx)(d.Avatar,{size:"xl",radius:"md",src:f.A.topic((0,b.BP)(g,"most.box#"+C).address),alt:"topic"})]}),(0,n.jsxs)(l.Stack,{gap:"md",children:[(0,n.jsx)(u.Input,{autoFocus:!0,placeholder:"话题名称",value:g,onChange:e=>A(e.currentTarget.value)}),(0,n.jsx)(x.Group,{justify:"flex-end",children:(0,n.jsx)(h.Switch,{label:"加密",size:"md",labelPosition:"left",checked:T,onChange:e=>{w(e.currentTarget.checked),S("")}})}),(0,n.jsx)(m.PasswordInput,{placeholder:"话题密码",visible:r,onVisibilityChange:p,value:C,disabled:!T,onChange:e=>S(e.currentTarget.value)}),(0,n.jsx)(j.Button,{onClick:()=>{let e="#"+f.A.topicJoin(g,C);t.replace("/topic"+e),s(e)},disabled:!g,children:"加入话题"})]})]})};function B(){let[e]=(0,r.useHash)(),s=(0,z.h)(),[t,a]=(0,v.useState)(null),l=e=>{try{let[s,t]=f.A.topicSplit(e),n=(0,b.BP)(s,"most.box#"+t,"I know loss mnemonic will lose my wallet.");a(n)}catch(e){console.log("hash 解析错误",e)}},[c,u]=(0,v.useState)(!1),[h,m]=(0,v.useState)(!1);return(0,v.useEffect)(()=>{u(!0),e&&l(e)},[e]),(0,n.jsxs)(i.Box,{id:"page-chat",children:[(0,n.jsx)(A.AppHeader,{title:t?"".concat(t.username,"#").concat(t.address.slice(-4)):"话题",right:(0,n.jsxs)(p.Menu,{shadow:"md",position:"bottom-end",withArrow:!0,arrowPosition:"center",disabled:!t,children:[(0,n.jsx)(p.Menu.Target,{children:(0,n.jsx)(d.Avatar,{style:{cursor:"pointer"},src:t?f.A.topic(t.address):"/icons/pwa-512x512.png"})}),(0,n.jsxs)(p.Menu.Dropdown,{children:[(0,n.jsx)(p.Menu.Item,{leftSection:(0,n.jsx)(S.A,{size:24}),onClick:()=>m(!h),children:(0,n.jsxs)(o.Text,{children:[h?"隐藏":"显示","成员"]})}),(0,n.jsx)(p.Menu.Item,{leftSection:(0,n.jsx)(T.A,{size:24}),onClick:()=>{},children:(0,n.jsx)(o.Text,{children:"清空我的消息"})}),(0,n.jsx)(p.Menu.Item,{leftSection:(0,n.jsx)(w.A,{size:24}),onClick:()=>{t&&s()},children:(0,n.jsx)(o.Text,{children:"退出话题"})})]})]})}),h&&(0,n.jsx)(x.Group,{justify:"center",pb:10,pt:10,children:[].map(e=>(0,n.jsxs)(g.Flex,{direction:"column",align:"center",gap:2,children:[(0,n.jsx)(d.Avatar,{src:f.A.avatar(e.address)}),(0,n.jsx)(o.Text,{size:"sm",children:e.username})]},e.address))}),t&&(0,n.jsx)(C.B,{onSend:()=>{},messages:[],onDelete:()=>{}}),c&&!t&&(0,n.jsx)(I,{onUpdate:l})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2119,2545,379,9816,1281,5111,2682,7989,6874,6618,4460,9421,8441,2721,7358],()=>s(56373)),_N_E=e.O()}]);