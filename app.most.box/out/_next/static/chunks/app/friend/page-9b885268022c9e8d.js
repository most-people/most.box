(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2675],{7248:(e,s,t)=>{"use strict";t.d(s,{h:()=>r});var a=t(35695),n=t(48764);let r=()=>{let e=(0,n.k)(e=>e.firstPath),s=(0,n.k)(e=>e.setItem),t=(0,a.useRouter)(),r=(0,a.usePathname)();return()=>{e===r?(s("firstPath","/"),t.replace("/")):t.back()}}},10516:()=>{},33329:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>C});var a=t(95155),n=t(21220),r=t(69604),l=t(58887),i=t(90557),o=t(39926),c=t(41954),d=t(26903),u=t(59741),x=t(11659),h=t(9482),m=t(80630);t(10516);var j=t(25062),p=t(62037),v=t(19396),g=t(48764),f=t(12115),b=t(65703),k=t(72652),A=t(33139),w=t(16701),S=t(7248);let T=()=>{let e=(0,x.m)({initialValues:{address:""},validate:{address:e=>(0,j.PW)(e)?null:"请输入有效的以太坊地址"}});return(0,a.jsxs)(n.Stack,{gap:"md",className:"add-box",children:[(0,a.jsxs)(r.Box,{className:"header",children:[(0,a.jsx)(l.Text,{size:"xl",fw:500}),(0,a.jsx)(i.Space,{h:"sx"}),(0,a.jsx)(o.Avatar,{size:"xl",radius:"md",src:(0,j.PW)(e.values.address)?h.A.avatar(e.values.address):"/icons/pwa-512x512.png",alt:"it's me"})]}),(0,a.jsx)("form",{onSubmit:e.onSubmit(()=>{e.validate().hasErrors||console.log("address",(0,p.b)(e.values.address))}),children:(0,a.jsxs)(n.Stack,{gap:"md",children:[(0,a.jsx)(c.Textarea,{withAsterisk:!0,label:"好友地址",placeholder:v.j,rows:2,maxLength:42,...e.getInputProps("address")}),(0,a.jsx)(d.Button,{type:"submit",disabled:!e.values.address,children:"添加好友"})]})})]})};function C(){let e=(0,S.h)(),[s]=(0,b.useHash)(),[t,n]=(0,f.useState)(""),i=(0,g.k)(e=>e.wallet),[c]=(0,f.useState)(null),[d,x]=(0,f.useState)(!1);(0,f.useEffect)(()=>{x(!0),s&&(0,j.PW)(s.slice(1))&&n(s.slice(1))},[s]);let p=t===(null==i?void 0:i.address)?"文件传输助手":c?"".concat(c.username,"#").concat(t.slice(-4)):"好友";return(0,a.jsxs)(r.Box,{id:"page-chat",children:[(0,a.jsx)(m.AppHeader,{title:p,right:(0,a.jsxs)(u.Menu,{shadow:"md",position:"bottom-end",withArrow:!0,arrowPosition:"center",disabled:!t,children:[(0,a.jsx)(u.Menu.Target,{children:(0,a.jsx)(o.Avatar,{style:{cursor:"pointer"},src:t?h.A.avatar(t):"/icons/pwa-512x512.png"})}),(0,a.jsxs)(u.Menu.Dropdown,{children:[(0,a.jsx)(u.Menu.Item,{leftSection:(0,a.jsx)(A.A,{size:24}),onClick:()=>{e()},children:(0,a.jsx)(l.Text,{children:"删除好友"})}),(0,a.jsx)(u.Menu.Item,{leftSection:(0,a.jsx)(w.A,{size:24}),onClick:()=>{},children:(0,a.jsx)(l.Text,{children:"清空我的消息"})})]})]})}),(null==c?void 0:c.public_key)&&(0,a.jsx)(k.B,{onSend:()=>{},messages:[],onDelete:()=>{}}),d&&!t&&(0,a.jsx)(T,{})]})}},35672:(e,s,t)=>{Promise.resolve().then(t.bind(t,33329))},72652:(e,s,t)=>{"use strict";t.d(s,{B:()=>N});var a=t(95155),n=t(69604),r=t(39926),l=t(59741),i=t(8141),o=t(26903),c=t(70112),d=t(81001),u=t(41954),x=t(63617),h=t(21220),m=t(58887),j=t(77213),p=t(53884),v=t(16701),g=t(56100),f=t(89243),b=t(755),k=t(12115),A=t(48764),w=t(9482),S=t(35695),T=t(6942),C=t(6874),z=t.n(C),B=t(30832),I=t.n(B);let N=e=>{let{messages:s,onSend:t,onDelete:C}=e,B=(0,j.useClipboard)(),[N,y]=(0,k.useState)(!1),[M,P]=(0,k.useState)(null),[E,_]=(0,k.useState)(null),[D,G]=(0,k.useState)(null),[H,R]=(0,k.useState)(""),W=(0,A.k)(e=>e.wallet),K=(0,S.usePathname)().split("/")[1],O=(0,k.useRef)(null);(0,k.useEffect)(()=>{var e;null==(e=O.current)||e.scrollIntoView({behavior:"smooth"})},[s]);let V=e=>{E&&clearTimeout(E),_(setTimeout(()=>{G(e)},500))},F=()=>{E&&(clearTimeout(E),_(null))},L=e=>{P(e),y(!0)},q=e=>{B.copy(e.text),T.notifications.show({message:"复制成功",color:"teal",autoClose:1e3}),G(null)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.Box,{className:"messages",children:[s.map((e,t)=>{var i;let o=e.address===(null==W?void 0:W.address);return(0,a.jsxs)(n.Box,{className:"message-box ".concat(o?"me":""),onTouchStart:()=>V(e.timestamp),onTouchEnd:F,onTouchCancel:F,onContextMenu:s=>{s.preventDefault(),G(e.timestamp)},children:["topic"===K&&(0,a.jsx)(n.Box,{className:"avatar",component:z(),href:{pathname:"/friend",hash:e.address},children:e.address!==(null==W?void 0:W.address)&&e.address!==(null==(i=s[t+1])?void 0:i.address)&&(0,a.jsx)(r.Avatar,{src:w.A.avatar(e.address)})}),(0,a.jsxs)(l.Menu,{opened:D===e.timestamp,onChange:()=>D===e.timestamp&&G(null),position:o?"bottom-start":"bottom-end",children:[(0,a.jsx)(l.Menu.Target,{children:(0,a.jsx)(n.Box,{className:"message",children:(0,a.jsx)(n.Box,{className:"content",children:e.text})})}),(0,a.jsxs)(l.Menu.Dropdown,{children:[(0,a.jsx)(l.Menu.Item,{leftSection:(0,a.jsx)(p.A,{size:20}),onClick:()=>q(e),children:"复制"}),(0,a.jsx)(l.Menu.Item,{disabled:!o&&"friend"===K,leftSection:(0,a.jsx)(v.A,{size:20}),onClick:()=>L(e),children:"删除"})]})]})]},e.timestamp)}),(0,a.jsx)(n.Box,{ref:O})]}),!W&&(0,a.jsx)(i.Center,{children:(0,a.jsx)(o.Button,{mb:"lg",variant:"gradient",component:z(),href:"/login",children:"去登录"})}),(0,a.jsxs)(c.Group,{gap:"xs",className:"message-input",children:[(0,a.jsx)(d.ActionIcon,{variant:"subtle",color:"gray",size:"lg",children:(0,a.jsx)(g.A,{size:24})}),(0,a.jsx)(u.Textarea,{placeholder:"输入消息...",size:"md",radius:"md",autosize:!0,maxRows:4,style:{flex:1},value:H,onChange:e=>R(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),H.trim()&&(t(H),R("")))}}),(0,a.jsx)(d.ActionIcon,{variant:"subtle",color:"gray",size:"lg",children:(0,a.jsx)(f.A,{size:24})}),(0,a.jsx)(d.ActionIcon,{variant:"subtle",color:"gray",size:"lg",children:(0,a.jsx)(b.A,{size:24})})]}),(0,a.jsxs)(x.Modal,{opened:N,onClose:()=>y(!1),title:"确认要删除这个消息吗？",centered:!0,children:[M&&(0,a.jsxs)(h.Stack,{children:[(0,a.jsx)(m.Text,{size:"xl",children:M.text}),(0,a.jsxs)(m.Text,{c:"dimmed",children:[I()(M.timestamp).fromNow(),"：",w.A.formatTime(M.timestamp)]})]}),(0,a.jsxs)(c.Group,{justify:"space-between",children:[(0,a.jsx)(m.Text,{c:"dimmed",children:"删除后将无法恢复"}),(0,a.jsxs)(c.Group,{children:[(0,a.jsx)(o.Button,{onClick:()=>y(!1),variant:"default",children:"取消"}),(0,a.jsx)(o.Button,{onClick:()=>{M&&C&&C(M),y(!1),P(null),G(null)},children:"删除"})]})]})]})]})}},80630:(e,s,t)=>{"use strict";t.d(s,{AppHeader:()=>c});var a=t(95155),n=t(70112),r=t(81001),l=t(58887),i=t(30578),o=t(7248);let c=e=>{let{title:s,right:t}=e,c=(0,o.h)();return(0,a.jsxs)(n.Group,{className:"app-header",children:[(0,a.jsx)(r.ActionIcon,{variant:"transparent",onClick:c,color:"--text-color",children:(0,a.jsx)(i.I,{name:"back",size:24})}),(0,a.jsx)(l.Text,{lineClamp:2,variant:"gradient",children:s}),t||(0,a.jsx)(r.ActionIcon,{variant:"transparent",color:"--text-color",children:(0,a.jsx)(i.I,{name:"more",size:24})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2119,2545,8161,7725,9857,3643,4440,8853,7244,6870,9421,8441,2721,7358],()=>s(35672)),_N_E=e.O()}]);