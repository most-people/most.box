(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6769],{4673:(e,t,r)=>{"use strict";r.d(t,{BP:()=>m,OM:()=>h,yO:()=>f});var o=r(30167),n=r(71425),a=r(44532),s=r(87788),i=r(56076),l=r(88413),c=r(70358),u=r(26634),d=r.n(u);let m=(e,t,r)=>{let c=(0,o.YW)(t),u=(0,o.YW)("/most.box/"+e),m=(0,n.A)(c,u,3,32,"sha512"),f=(0,a.q5)((0,s.s)(m)),h=f.slice(0,32),g=d().box.keyPair.fromSecretKey(h),p=(0,a.c$)(g.publicKey),v=(0,a.c$)(g.secretKey),y=i.v.entropyToPhrase(f);return{username:e,address:l.QX.fromPhrase(y).address,public_key:p,private_key:v,mnemonic:"I know loss mnemonic will lose my wallet."===r?y:""}},f=(e,t,r)=>{let o=new TextEncoder().encode(e),n=d().randomBytes(d().box.nonceLength),s=d().box(o,n,new Uint8Array((0,a.q5)(t)),new Uint8Array((0,a.q5)(r)));return s?["mp://2",(0,c.W)(n),(0,c.W)(s)].join("."):(console.info("加密失败"),"")},h=(e,t,r)=>{let[o,n,s]=e.split(".");if("mp://2"!==o)return console.info("无效协议"),"";let i=d().box.open((0,c.y)(s),(0,c.y)(n),new Uint8Array((0,a.q5)(t)),new Uint8Array((0,a.q5)(r)));return i?new TextDecoder().decode(i):(console.info("解密失败"),"")}},9482:(e,t,r)=>{"use strict";r.d(t,{A:()=>j});var o=r(70358),n=r(30167),a=r(88413),s=r(19396),i=r(96842),l=r(42995),c=r(3648),u=r(4673),d=r(59909),m=r(30832),f=r.n(m),h=r(99758),g=r.n(h);r(38464);var p=r(76920),v=r.n(p);f().extend(v()),f().extend(g()),f().locale("zh-cn");let y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYMMDD",r=f()().format(t),o=sessionStorage.getItem("fingerprint");if(!o)throw Error("请先获取设备指纹");let n=[location.origin,o].join("/"),{public_key:a,private_key:s}=(0,u.BP)(r,n);return(0,u.yO)(JSON.stringify(e),a,s)},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYMMDD",r=f()().format(t),o=sessionStorage.getItem("fingerprint");if(!o)throw Error("请先获取设备指纹");let n=[location.origin,o].join("/"),{public_key:a,private_key:s}=(0,u.BP)(r,n),i=(0,u.OM)(e,a,s);if(i)try{let e=JSON.parse(i);if(e.address)return e}catch(e){console.error(e)}return console.log("jwt 过期"),null},w=async e=>{let t=Date.now().toString(),r=a.QX.fromPhrase(e.mnemonic),o=await r.signMessage(t);localStorage.token=[e.address,t,o].join(".")},x=e=>{try{var t;let r=y(e);if((null==(t=b(r))?void 0:t.address)===e.address)return localStorage.setItem("jwt",r),w(e),e}catch(e){console.log("登录失败:",e)}return null},j={avatar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,i.gn)(l,{seed:"most.box@"+e,flip:!0,backgroundType:["gradientLinear"]}).toDataUri()},avatarCID:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,i.gn)(c,{seed:"most.box#"+e,flip:!0,backgroundType:["gradientLinear","solid"]}).toDataUri()},formatTime:e=>{let t;if(!e)return"";let r=f()(Number(e)),o=r.hour();return t=o>=0&&o<3?"凌晨":o>=3&&o<6?"拂晓":o>=6&&o<9?"早晨":o>=9&&o<12?"上午":o>=12&&o<15?"下午":o>=15&&o<18?"傍晚":o>=18&&o<21?"薄暮":"深夜",r.format("YYYY年M月D日 ".concat(t,"h点m分"))},formatDate:e=>{let t=f()(Number(e)),r=f()();return t.isSame(r,"day")?t.format("HH:mm"):t.isSame(r.subtract(1,"day"),"day")?"昨天 ".concat(t.format("HH:mm")):t.isoWeek()===r.isoWeek()?"".concat(["周日","周一","周二","周三","周四","周五","周六"][t.day()]," ").concat(t.format("HH:mm")):t.year()===r.year()?t.format("M月D日"):t.format("YY年M月D日")},formatAddress:e=>e?e.slice(0,6)+"..."+e.slice(-4):"",enBase64:e=>(0,o.W)((0,n.YW)(e)),deBase64:e=>(0,n._v)((0,o.y)(e)),createJWT:y,verifyJWT:b,login:(e,t)=>x((0,u.BP)(e,t,"I know loss mnemonic will lose my wallet.")),loginSave:x,ZeroAddress:s.j,createToken:w,pinyin:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(t.length<r)return!1;if(e.toLowerCase().includes(t.toLowerCase()))return!0;let o=(0,d.YW)(e,t,{continuous:!0});return!!o&&!!(o.length>=r)}}},10866:(e,t,r)=>{"use strict";r.d(t,{isElement:()=>n});var o=r(12115);function n(e){return!Array.isArray(e)&&null!==e&&"object"==typeof e&&e.type!==o.Fragment}},35695:(e,t,r)=>{"use strict";var o=r(18999);r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},45383:(e,t,r)=>{Promise.resolve().then(r.bind(r,60447))},48764:(e,t,r)=>{"use strict";r.d(t,{k:()=>i});var o=r(9482),n=r(65453),a=r(54205),s=r(6942);let i=(0,n.v)((e,t)=>({wallet:void 0,initWallet(r){e({fingerprint:r});let n=localStorage.getItem("jwt");if(n){let r=o.A.verifyJWT(n);r?(o.A.createToken(r),e({wallet:r})):t().exit()}},async updateDot(t){try{let r=new URL(t).origin,o=new AbortController,n=setTimeout(()=>o.abort(),3e3),s=await fetch(r+"/api.dot",{signal:o.signal});if(clearTimeout(n),!s.ok)throw Error("HTTP error! status: ".concat(s.status));let i=await s.json();a.FH.defaults.baseURL=r,e({dotAPI:r}),localStorage.setItem("dotAPI",r);let l=i.CIDs[0];return r.endsWith(":1976")&&(l=r.slice(0,-5)+":8080"),l&&(e({dotCID:l}),localStorage.setItem("dotCID",l)),e({notes:void 0,files:void 0}),i.APIs}catch(r){s.notifications.show({title:"节点切换失败",message:t,color:"red"}),console.info(r),e({dotAPI:a.FH.defaults.baseURL||""})}return null},setItem:(t,r)=>e(e=>({...e,[t]:r})),firstPath:"",dotAPI:a.MN,dotCID:a.AF,dotNodes:[],notes:void 0,notesQuery:"",files:void 0,filesPath:"",fingerprint:"",exit(){e({wallet:void 0,notes:void 0,files:void 0}),localStorage.removeItem("jwt"),localStorage.removeItem("token")}}))},54205:(e,t,r)=>{"use strict";r.d(t,{AF:()=>a,C2:()=>s,FH:()=>i,MN:()=>n});var o=r(23464);let n="https://dot.most.red",a="https://cid.most.red",s="https://most.box/auth/callback",i=o.A.create({baseURL:n});i.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>("ERR_NETWORK"===e.code&&(window.location.href="/dot"),Promise.reject(e)))},58750:(e,t,r)=>{"use strict";r.d(t,{getDefaultZIndex:()=>n});let o={app:100,modal:200,popover:300,overlay:400,max:9999};function n(e){return o[e]}},60447:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var o=r(95155),n=r(12115),a=r(35695),s=r(91590),i=r(21220),l=r(83347),c=r(58887),u=r(63617),d=r(74634),m=r(25345),f=r(70112),h=r(26903),g=r(79117),p=r(9482),v=r(48764),y=r(65703),b=r(11681),w=r(6942);function x(){let e=(0,a.useRouter)(),t=(0,v.k)(e=>e.setItem),[r]=(0,y.useHash)(),[x,{toggle:j}]=(0,b.useDisclosure)(!1),[P,S]=(0,n.useState)(""),[A,k]=(0,n.useState)(!1),[C,I]=(0,n.useState)(""),[_,N]=(0,n.useState)(""),[E,D]=(0,n.useState)(null),B=(r,o)=>{let n=r.email||r.id.slice(-6),a=[r.created_at,r.id,"most.box!"+o].join("|"),s=p.A.login(n,a);s&&setTimeout(()=>{t("wallet",s)},0),e.replace("/")},T=async()=>{try{var t;let{data:r,error:o}=await g.N.auth.getSession();if(o)return void console.error("Auth callback error:",o);let n=null==(t=r.session)?void 0:t.user;n?(g.N.auth.signOut(),D(n),P?B(n,P):k(!0)):e.push("/login")}catch(e){console.error("Get session error:",e)}};return(0,n.useEffect)(()=>{T()},[]),(0,n.useEffect)(()=>{if(r){let e=new URLSearchParams(r.slice(1));e.get("error")&&(console.error("Auth callback error:",r),w.notifications.show({color:"red",title:e.get("error"),message:e.get("error_description")}))}},[r]),(0,o.jsxs)(s.Container,{children:[(0,o.jsxs)(i.Stack,{align:"center",children:[(0,o.jsx)(l.Loader,{size:"lg"}),(0,o.jsx)(c.Text,{children:"正在处理登录..."})]}),(0,o.jsx)(u.Modal,{opened:A,onClose:()=>{},closeOnClickOutside:!1,closeOnEscape:!1,withCloseButton:!1,centered:!0,children:(0,o.jsxs)(i.Stack,{children:[(0,o.jsx)(d.Alert,{children:"为了确保资金安全，即使社交账户被盗也能保护您的资产。"}),(0,o.jsx)(m.PasswordInput,{placeholder:"建议您设置密码",visible:x,onVisibilityChange:j,value:C,onChange:e=>{I(e.currentTarget.value),N("")},error:_}),(0,o.jsxs)(f.Group,{justify:"space-between",children:[(0,o.jsx)(h.Button,{variant:"outline",onClick:()=>{k(!1),E&&B(E,"")},children:"不设置密码"}),(0,o.jsx)(h.Button,{onClick:()=>{if(!C)return void N("请输入密码");S(C),k(!1),E&&B(E,C)},children:"设置密码"})]})]})})]})}},62143:(e,t,r)=>{"use strict";r.d(t,{OptionalPortal:()=>i});var o=r(95155);r(12115);var n=r(13656),a=r(36960),s=r(79407);let i=(0,a.factory)((e,t)=>{let{withinPortal:r=!0,children:a,...i}=e;return"test"!==(0,n.useMantineEnv)()&&r?(0,o.jsx)(s.Portal,{ref:t,...i,children:a}):(0,o.jsx)(o.Fragment,{children:a})});i.displayName="@mantine/core/OptionalPortal"},65703:(e,t,r)=>{"use strict";r.d(t,{useHash:()=>a});var o=r(12115),n=r(28261);function a(){let{getInitialValueInEffect:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,o.useState)(e?"":window.location.hash||"");return(0,n.useWindowEvent)("hashchange",()=>{let e=window.location.hash;t!==e&&r(e)}),(0,o.useEffect)(()=>{e&&r(window.location.hash)},[]),[t,e=>{let t=e.startsWith("#")?e:"#".concat(e);window.location.hash=t,r(t)}]}},71281:()=>{},74634:(e,t,r)=>{"use strict";r.d(t,{Alert:()=>h});var o=r(95155),n=r(64173);r(12115);var a=r(56204),s=r(68918),i=r(43664),l=r(53791),c=r(69604),u=r(36960),d=r(95642),m={root:"m_66836ed3",wrapper:"m_a5d60502",body:"m_667c2793",title:"m_6a03f287",label:"m_698f4f23",icon:"m_667f2a6a",message:"m_7fa78076",closeButton:"m_87f54839"};let f=(0,s.createVarsResolver)((e,t)=>{let{radius:r,color:o,variant:n,autoContrast:s}=t,i=e.variantColorResolver({color:o||e.primaryColor,theme:e,variant:n||"light",autoContrast:s});return{root:{"--alert-radius":void 0===r?void 0:(0,a.getRadius)(r),"--alert-bg":o||n?i.background:void 0,"--alert-color":i.color,"--alert-bd":o||n?i.border:void 0}}}),h=(0,u.factory)((e,t)=>{let r=(0,i.useProps)("Alert",null,e),{classNames:a,className:s,style:u,styles:h,unstyled:g,vars:p,radius:v,color:y,title:b,children:w,id:x,icon:j,withCloseButton:P,onClose:S,closeButtonLabel:A,variant:k,autoContrast:C,attributes:I,..._}=r,N=(0,l.useStyles)({name:"Alert",classes:m,props:r,className:s,style:u,classNames:a,styles:h,unstyled:g,attributes:I,vars:p,varsResolver:f}),E=(0,n.useId)(x),D=b&&"".concat(E,"-title")||void 0,B="".concat(E,"-body");return(0,o.jsx)(c.Box,{id:E,...N("root",{variant:k}),variant:k,ref:t,..._,role:"alert","aria-describedby":B,"aria-labelledby":D,children:(0,o.jsxs)("div",{...N("wrapper"),children:[j&&(0,o.jsx)("div",{...N("icon"),children:j}),(0,o.jsxs)("div",{...N("body"),children:[b&&(0,o.jsx)("div",{...N("title"),"data-with-close-button":P||void 0,children:(0,o.jsx)("span",{id:D,...N("label"),children:b})}),w&&(0,o.jsx)("div",{id:B,...N("message"),"data-variant":k,children:w})]}),P&&(0,o.jsx)(d.CloseButton,{...N("closeButton"),onClick:S,variant:"transparent",size:16,iconSize:16,"aria-label":A,unstyled:g})]})})});h.classes=m,h.displayName="@mantine/core/Alert"},79117:(e,t,r)=>{"use strict";r.d(t,{N:()=>o});let o=(0,r(72354).UU)("https://vibeseycqiisftkweeat.supabase.co","sb_publishable_BN0UEj0bBXC9EOkeeHrK7w_TgPpB9_X")},79407:(e,t,r)=>{"use strict";r.d(t,{Portal:()=>m});var o=r(95155),n=r(12115),a=r(47650),s=r(73141),i=r(88551),l=r(43664),c=r(36960);function u(e){let t=document.createElement("div");return t.setAttribute("data-portal","true"),"string"==typeof e.className&&t.classList.add(...e.className.split(" ").filter(Boolean)),"object"==typeof e.style&&Object.assign(t.style,e.style),"string"==typeof e.id&&t.setAttribute("id",e.id),t}let d={reuseTargetNode:!0},m=(0,c.factory)((e,t)=>{let{children:r,target:c,reuseTargetNode:m,...f}=(0,l.useProps)("Portal",d,e),[h,g]=(0,n.useState)(!1),p=(0,n.useRef)(null);return((0,s.useIsomorphicEffect)(()=>(g(!0),p.current=function(e){let{target:t,reuseTargetNode:r,...o}=e;if(t)return"string"==typeof t?document.querySelector(t)||u(o):t;if(r){let e=document.querySelector("[data-mantine-shared-portal-node]");if(e)return e;let t=u(o);return t.setAttribute("data-mantine-shared-portal-node","true"),document.body.appendChild(t),t}return u(o)}({target:c,reuseTargetNode:m,...f}),(0,i.assignRef)(t,p.current),c||m||!p.current||document.body.appendChild(p.current),()=>{c||m||!p.current||document.body.removeChild(p.current)}),[c]),h&&p.current)?(0,a.createPortal)((0,o.jsx)(o.Fragment,{children:r}),p.current):null});m.displayName="@mantine/core/Portal"}},e=>{e.O(0,[8198,2545,1257,8805,8413,3464,6634,3722,4956,4726,6431,6305,6952,8441,5964,7358],()=>e(e.s=45383)),_N_E=e.O()}]);