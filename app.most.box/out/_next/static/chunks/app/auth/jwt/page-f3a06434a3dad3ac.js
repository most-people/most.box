(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3899,6961],{13297:(e,t,n)=>{"use strict";n.d(t,{k:()=>m});var a=n(56612),s=n(25959),r=n(59126),i=n(53987),o=n(21794),l=n(81216),p=n(38798),c=n(41524),u=n(76476),d=n(29311);let m=(0,s.v)((e,t)=>({wallet:void 0,setWallet(n){e({wallet:n});let{initRootCID:a,initBalance:s}=t();a(),s()},firstPath:"",notes:void 0,notesQuery:"",nodeDark:"",files:void 0,filesPath:"",fingerprint:"",exit(){e({wallet:void 0,notes:void 0,files:void 0}),localStorage.removeItem("jwt"),localStorage.removeItem("token")},rootCID:"",async updateRootCID(){let{wallet:n}=t();if(n){let{RPC:t}=d.E.getState(),s=new l.FR(t),r=p.QX.fromPhrase(n.mnemonic).connect(s),u=new c.NZ(i.i5,i.yc,r),[m,y]=await Promise.all([o.FH.post("/files.cid"),u.getCID(n.address)]),g=m.data,f=(0,a.OM)(y,n.public_key,n.private_key);if(g&&g!==f){let t=(0,a.yO)(g,n.public_key,n.private_key),s=await u.setCID(t);await s.wait(),e({rootCID:g})}}},async initRootCID(){let{wallet:n}=t();if(!n)return console.log("未登录");let{RPC:s}=d.E.getState(),p=new l.FR(s),u=new c.NZ(i.i5,i.yc,p),[m,y]=await Promise.all([o.FH.post("/files.cid"),u.getCID(n.address)]),g=m.data,f=(0,a.OM)(y,n.public_key,n.private_key);f&&(f===g||(await o.FH.put("/files.import/".concat(f))).data.ok?e({rootCID:f}):r.notifications.show({message:"根目录 CID 导入失败",color:"red"}))},balance:"",async initBalance(){let{wallet:n}=t();if(!n)return console.log("未登录");let{RPC:a}=d.E.getState(),s=new l.FR(a),r=await s.getBalance(n.address);e({balance:(0,u.ck)(r)}),0===Number(r)&&o.FH.post("/api.testnet.gas")},setItem:(t,n)=>e(e=>({...e,[t]:n}))}))},20063:(e,t,n)=>{"use strict";var a=n(47260);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},21794:(e,t,n)=>{"use strict";n.d(t,{C2:()=>s,FH:()=>r});var a=n(95125);let s="https://most.box/auth/callback",r=a.A.create({baseURL:""});r.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>Promise.reject(e))},25959:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});var a=n(12115);let s=e=>{let t,n=new Set,a=(e,a)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=a?a:"object"!=typeof s||null===s)?s:Object.assign({},t,s),n.forEach(n=>n(t,e))}},s=()=>t,r={setState:a,getState:s,getInitialState:()=>i,subscribe:e=>(n.add(e),()=>n.delete(e))},i=t=e(a,s,r);return r},r=e=>{let t=(e=>e?s(e):s)(e),n=e=>(function(e,t=e=>e){let n=a.useSyncExternalStore(e.subscribe,a.useCallback(()=>t(e.getState()),[e,t]),a.useCallback(()=>t(e.getInitialState()),[e,t]));return a.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},i=e=>e?r(e):r},29311:(e,t,n)=>{"use strict";n.d(t,{E:()=>p,P:()=>l});var a=n(25959),s=n(53987),r=n(21794),i=n(81216),o=n(41524);let l=e=>new Promise(t=>{if(!e.APIs||0===e.APIs.length)return void t({isOnline:!1,responseTime:0});let n=e.APIs[0],a=Date.now(),s=new AbortController,r=setTimeout(()=>s.abort(),2e3);fetch("".concat(n,"/api.dot"),{signal:s.signal,mode:"cors"}).then(()=>{clearTimeout(r),t({isOnline:!0,responseTime:Date.now()-a})}).catch(()=>{clearTimeout(r),t({isOnline:!1,responseTime:Date.now()-a})})}),p=(0,a.v)((e,t)=>({dotAPI:"",dotCID:"",dotNodes:[],fetchNodes:async e=>{let{RPC:n}=t(),a=new i.FR(e||n),r=new o.NZ(s.MT,s.Wf,a),[l,p,c,u,d]=await r.getAllDots();return l.map((e,t)=>({address:e,name:p[t]||"节点 ".concat(t+1),APIs:c[t]||[],CIDs:u[t]||[],lastUpdate:Number(d[t])}))},async updateDot(t){try{let n=new URL(t).origin,a=(await r.FH.get("/api.dot",{baseURL:n})).data;r.FH.defaults.baseURL=n,e({dotAPI:n}),localStorage.setItem("dotAPI",n);let s=a.CIDs[0];return n.endsWith(":1976")&&(s=n.slice(0,-5)+":8080"),s&&(e({dotCID:s}),localStorage.setItem("dotCID",s)),a.APIs}catch(t){console.info(t),e({dotAPI:r.FH.defaults.baseURL||""})}return null},network:"testnet",RPC:s.WC.testnet.rpc,Explorer:s.WC.testnet.explorer,setNetwork(t){let n=s.WC[t];e({network:t,RPC:n.rpc,Explorer:n.explorer}),localStorage.setItem("network",t)},setItem:(t,n)=>e(e=>({...e,[t]:n}))}))},44648:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y});var a=n(95155),s=n(90101),r=n(56612),i=n(36117),o=n.n(i),l=n(12115),p=n(97443),c=n(13297),u=n(13877),d=n(2369),m=n(63090);function y(){let e=(0,c.k)(e=>e.fingerprint);return(0,l.useEffect)(()=>{e&&(()=>{let e=new URLSearchParams(window.location.search).get("token");if(e){window.history.replaceState(null,"",window.location.pathname);let t=o()().format("YY/M/D HH:mm"),{public_key:n,private_key:a}=(0,r.BP)("auth/jwt",t),s=(0,r.OM)(e,n,a);try{let e=JSON.parse(s);p.A.loginSave(e)}catch(e){console.error(e)}}window.location.replace("/")})()},[e]),(0,a.jsxs)(u.Container,{py:"xl",children:[(0,a.jsx)(s.AppHeader,{title:"Auth JWT"}),(0,a.jsx)(d.Stack,{align:"center",children:(0,a.jsx)(m.Loader,{color:"black",size:"lg",type:"dots"})})]})}},53987:(e,t,n)=>{"use strict";n.d(t,{Wf:()=>o,yc:()=>l,MT:()=>s,i5:()=>r,WC:()=>i});let a=JSON.parse('[{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"CIDs","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"Data","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"delCID","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"delData","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"delName","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_address","type":"address"}],"name":"getCID","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_address","type":"address"}],"name":"getData","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_address","type":"address"}],"name":"getName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_name","type":"string"}],"name":"getOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"nameOwners","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"names","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_cid","type":"string"}],"name":"setCID","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_data","type":"string"}],"name":"setData","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_newName","type":"string"}],"name":"setName","outputs":[],"stateMutability":"nonpayable","type":"function"}]'),s="0xB67662F0d2BB106B055503062e1dba4f072f5781",r="0x8F175B89C1A5Bb27f050FC88F0894d684A45f299",i={mainnet:{chainId:8453,rpc:"https://mainnet.base.org",name:"Base 主网",color:"blue",explorer:"https://basescan.org",RPCs:["https://base.llamarpc.com","https://mainnet.base.org","https://developer-access-mainnet.base.org","https://base-mainnet.diamondswap.org/rpc","https://base.public.blockpi.network/v1/rpc/public","https://1rpc.io/base","https://base-pokt.nodies.app","https://base.meowrpc.com","https://base-mainnet.public.blastapi.io","https://base.gateway.tenderly.co","https://gateway.tenderly.co/public/base","https://rpc.notadegen.com/base","https://base-rpc.publicnode.com","https://base.drpc.org","https://base.api.onfinality.io/public","https://public.stackup.sh/api/v1/node/base-mainnet","https://base-mainnet.gateway.tatum.io","https://base.rpc.subquery.network/public","https://api.zan.top/base-mainnet","https://endpoints.omniatech.io/v1/base/mainnet/public","https://base.lava.build","https://rpc.numa.network/base","https://node.histori.xyz/base-mainnet/8ry9f6t9dct1se2hlagxnd9n2a","https://0xrpc.io/base","https://rpc.owlracle.info/base/70d38ce1826c4a60bb2a8e05a6c8b20f","https://base.therpc.io"]},testnet:{chainId:84532,rpc:"https://sepolia.base.org",name:"Base 测试网",color:"orange",explorer:"https://sepolia.basescan.org",RPCs:["https://base-sepolia.gateway.tenderly.co","https://base-sepolia.drpc.org","https://base-sepolia-public.nodies.app","https://base-sepolia.therpc.io","https://base-sepolia.api.onfinality.io/public","https://sepolia.base.org","https://base-sepolia-rpc.publicnode.com"]}},o=[{inputs:[],name:"getAllDots",outputs:[{internalType:"address[]",name:"addresses",type:"address[]"},{internalType:"string[]",name:"names",type:"string[]"},{internalType:"string[][]",name:"APIss",type:"string[][]"},{internalType:"string[][]",name:"CIDss",type:"string[][]"},{internalType:"uint256[]",name:"updates",type:"uint256[]"}],stateMutability:"view",type:"function"}],l=a},56612:(e,t,n)=>{"use strict";n.d(t,{BP:()=>d,OM:()=>y,yO:()=>m});var a=n(68110),s=n(330),r=n(16405),i=n(42779),o=n(10179),l=n(38798),p=n(43591),c=n(28555),u=n.n(c);let d=(e,t,n)=>{let p=(0,a.YW)(t),c=(0,a.YW)("/most.box/"+e),d=(0,s.A)(p,c,3,32,"sha512"),m=(0,r.q5)((0,i.s)(d)),y=m.slice(0,32),g=u().box.keyPair.fromSecretKey(y),f=(0,r.c$)(g.publicKey),b=(0,r.c$)(g.secretKey),h=u().sign.keyPair.fromSeed(y),w=(0,r.c$)(h.publicKey),v=o.v.entropyToPhrase(m);return{username:e,address:l.QX.fromPhrase(v).address,public_key:f,private_key:b,mnemonic:"I know loss mnemonic will lose my wallet."===n?v:"",ed_public_key:w}},m=(e,t,n)=>{let a=new TextEncoder().encode(e),s=u().randomBytes(u().box.nonceLength),i=u().box(a,s,new Uint8Array((0,r.q5)(t)),new Uint8Array((0,r.q5)(n)));return i?["mp://2",(0,p.W)(s),(0,p.W)(i)].join("."):(console.info("加密失败"),"")},y=(e,t,n)=>{let[a,s,i]=e.split(".");if("mp://2"!==a)return console.info("无效协议"),"";let o=u().box.open((0,p.y)(i),(0,p.y)(s),new Uint8Array((0,r.q5)(t)),new Uint8Array((0,r.q5)(n)));return o?new TextDecoder().decode(o):(console.info("无法解密"),"")}},63078:(e,t,n)=>{"use strict";n.d(t,{useDocumentTitle:()=>s});var a=n(98200);function s(e){(0,a.useIsomorphicEffect)(()=>{"string"==typeof e&&e.trim().length>0&&(document.title=e.trim())},[e])}},71281:()=>{},86237:(e,t,n)=>{Promise.resolve().then(n.bind(n,44648))},97443:(e,t,n)=>{"use strict";n.d(t,{A:()=>C});var a=n(43591),s=n(68110),r=n(38798),i=n(16405),o=n(82127),l=n(34477),p=n(55544),c=n(85179),u=n(56612),d=n(86710),m=n(36117),y=n.n(m),g=n(44839),f=n.n(g);n(28223);var b=n(78595),h=n.n(b),w=n(28555),v=n.n(w);y().extend(h()),y().extend(f()),y().locale("zh-cn");let k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYYMM",n=y()().isoWeek(),a=y()().format(t)+n,s=sessionStorage.getItem("fingerprint");if(!s)throw Error("请先获取设备指纹");let r=[location.origin,s].join("/"),{public_key:i,private_key:o}=(0,u.BP)(a,r);return(0,u.yO)(JSON.stringify(e),i,o)},I=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYYMM",n=y()().isoWeek(),a=y()().format(t)+n,s=sessionStorage.getItem("fingerprint");if(!s)throw Error("请先获取设备指纹");let r=[location.origin,s].join("/"),{public_key:i,private_key:o}=(0,u.BP)(a,r),l=(0,u.OM)(e,i,o);if(!l)throw Error("jwt 解析失败");let p=JSON.parse(l);if(!p.address)throw Error("jwt json 解析失败");return p},P=async e=>{let t=Date.now().toString(),n=r.QX.fromPhrase(e.mnemonic),a=await n.signMessage(t);localStorage.token=[e.address,t,a].join(".")},D=e=>{try{var t;let n=k(e);if((null==(t=I(n))?void 0:t.address)===e.address)return localStorage.setItem("jwt",n),P(e),e}catch(e){console.log("登录失败:",e)}return null},T=(e,t)=>{let n=t.slice(2),a=new Uint8Array((0,i.q5)(e+n));return v().sign.keyPair.fromSecretKey(a)},S={avatar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,l.gn)(p,{seed:"most.box@"+e,flip:!0,backgroundType:["gradientLinear"]}).toDataUri()},avatarCID:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,l.gn)(c,{seed:"most.box#"+e,flip:!0,backgroundType:["gradientLinear","solid"]}).toDataUri()},formatTime:e=>{let t;if(!e)return"";let n=y()(Number(e)),a=n.hour();return t=a>=0&&a<3?"凌晨":a>=3&&a<6?"拂晓":a>=6&&a<9?"早晨":a>=9&&a<12?"上午":a>=12&&a<15?"下午":a>=15&&a<18?"傍晚":a>=18&&a<21?"薄暮":"深夜",n.format("YYYY年M月D日 ".concat(t,"h点m分"))},formatDate:e=>{let t=y()(Number(e)),n=y()();if(t.isSame(n,"minute"))return t.format("HH:mm:ss");if(t.isSame(n,"day"))return t.format("HH:mm");if(t.isSame(n.subtract(1,"day"),"day"))return"昨天 ".concat(t.format("HH:mm"));if(t.isoWeek()===n.isoWeek())return"".concat(["周日","周一","周二","周三","周四","周五","周六"][t.day()]," ").concat(t.format("HH:mm"));if(t.year()===n.year())return t.format("M月D日");else return t.format("YY年M月D日")},formatAddress:e=>e?e.slice(0,6)+"..."+e.slice(-4):"",enBase64:e=>(0,a.W)((0,s.YW)(e)),deBase64:e=>(0,s._v)((0,a.y)(e)),createJWT:k,verifyJWT:I,login:(e,t)=>D((0,u.BP)(e,t,"I know loss mnemonic will lose my wallet.")),loginSave:D,ZeroAddress:o.j,createToken:P,pinyin:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(t.length<n)return!1;if(e.toLowerCase().includes(t.toLowerCase()))return!0;let a=(0,d.YW)(e,t,{continuous:!0});return!!a&&!!(a.length>=n)},openDot:e=>{let t=new URL("/auth/jwt/",e),n=localStorage.getItem("jwt");if(n){let e=S.verifyJWT(n);if(e){let n=y()().format("YY/M/D HH:mm"),{public_key:a,private_key:s}=(0,u.BP)("auth/jwt",n),r=(0,u.yO)(JSON.stringify(e),a,s);t.searchParams.set("token",r)}}window.open(t.href)},getEdKeyPair:T,getIPNS:(e,t)=>{let n=(e=>{let t=new Uint8Array([8,1,18,...(e=>{let t=[];for(;e>=128;)t.push(127&e|128),e>>=7;return t.push(e),t})(e.length)]),n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n})(T(e,t).publicKey),a=new Uint8Array(2+n.length);a[0]=0,a[1]=36,a.set(n,2);let s=new Uint8Array([1,114]),r=new Uint8Array(s.length+a.length);return r.set(s,0),r.set(a,s.length),"k"+((e,t)=>{if(0===e.length)return"";let n=t.length,a=0;for(;a<e.length&&0===e[a];)a++;let s=[0];for(let t=a;t<e.length;t++){let a=e[t];for(let e=0;e<s.length;e++){let t=256*s[e]+a;s[e]=t%n,a=Math.floor(t/n)}for(;a>0;)s.push(a%n),a=Math.floor(a/n)}let r="";for(let e=0;e<a;e++)r+=t[0];for(let e=s.length-1;e>=0;e--)r+=t[s[e]];return r})(r,"0123456789abcdefghijklmnopqrstuvwxyz")}},C=S}},e=>{e.O(0,[8198,2794,5619,6714,8555,8835,5125,6476,3584,101,8441,1255,7358],()=>e(e.s=86237)),_N_E=e.O()}]);