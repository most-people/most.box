(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{5941:()=>{},38639:(e,n,t)=>{"use strict";t.d(n,{A:()=>r});let r="IPv6 (Internet Protocol version 6) 是下一代互联网的核心协议，旨在解决 IPv4 地址枯竭问题并提升网络性能。\r\n\r\n**核心功能：每个设备可拥有全球唯一公网 IP，消除对 NAT 的依赖，回归端到端通信。**\r\n\r\n- IPv4 的 32 位地址（约 43 亿个）已耗尽。IPv6 采用 128 位地址，提供近乎无限的地址空间，满足物联网、5G 等海量设备连接需求。\r\n\r\n- [test-ipv6.com](https://test-ipv6.com) | [itdog.cn](https://www.itdog.cn/localhost/) | [ipw.cn](https://ipw.cn) | [test6.ustc.edu.cn](https://test6.ustc.edu.cn) 可以测试当前网络是否支持 IPv6\r\n"},41487:()=>{},54216:()=>{},63934:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>X});var r=t(95155),i=t(12115),l=t(58380),s=t(45766),o=t(70305),a=t(99682);t(5941);var c=t(52619),d=t.n(c),u=t(67623),h=t(67661),x=t(5480),m=t(2369),j=t(13297),p=t(97443);function f(){let e=(0,j.k)(e=>e.wallet),n=(null==e?void 0:e.address)||p.A.ZeroAddress,t=(0,j.k)(e=>e.exit);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Box,{className:"header",children:(0,r.jsxs)(h.Group,{wrap:"nowrap",children:[(0,r.jsx)(x.Avatar,{component:d(),href:"/profile",size:"md",radius:"sm",src:(null==e?void 0:e.address)?p.A.avatar(e.address):"/icons/pwa-512x512.png",alt:"it's me"}),(0,r.jsxs)(u.Box,{children:[(0,r.jsx)(o.Text,{size:"lg",fw:500,lineClamp:2,children:(null==e?void 0:e.username)||"Most.Box"}),(0,r.jsxs)(o.Text,{size:"sm",c:"dimmed",component:d(),href:"/profile",children:["地址: ",p.A.formatAddress(n)]})]}),(0,r.jsx)(l.ActionIcon,{ml:"auto",variant:"subtle",color:"gray",component:d(),href:{pathname:"/card",query:{uid:n}},children:(0,r.jsx)(a.I,{name:"QRCode",size:18})})]})}),(0,r.jsxs)(m.Stack,{className:"menu-list",mb:"xs",gap:0,children:[(0,r.jsx)(g,{icon:"Web3",label:"Web3",link:"/web3"}),(0,r.jsx)(g,{icon:"Website",label:"个人主页",link:"/@".concat(n)}),(0,r.jsx)(g,{icon:"Earth",label:"节点",link:"/dot"}),(0,r.jsx)(g,{icon:"Chat",label:"聊天",link:"/chat/?id=001"})]}),(0,r.jsxs)(m.Stack,{className:"menu-list",gap:0,children:[(0,r.jsx)(g,{icon:"About",label:"关于",link:"/about"}),(0,r.jsx)(g,{icon:"Setting",label:"设置",link:"/setting"}),(0,r.jsx)(g,{icon:"Join",label:"志同道合",link:"/join"})]}),(0,r.jsx)(m.Stack,{className:"menu-list",mt:"xs",children:(0,r.jsx)(g,{icon:"Exit",label:e?"退出账户":"去登录",link:"/login",onClick:()=>{e&&t()}})})]})}function g(e){let{icon:n,label:t,link:i,onClick:l}=e;return(0,r.jsxs)(u.Box,{component:d(),href:i,className:"menu-item",onClick:l,children:[(0,r.jsxs)(h.Group,{children:[(0,r.jsx)(a.I,{name:n,size:32}),(0,r.jsx)(o.Text,{children:t})]}),(0,r.jsx)(a.I,{name:"Arrow",size:18})]})}var w=t(40387),y=t(60688),v=t(18244),k=t(17998),C=t(9457),b=t(44634),D=t(64153),I=t(77147),S=t(33864),A=t(85784),T=t(96778),M=t(90632),P=t(18845),z=t(21794);t(54216);var B=t(1371),F=t(89712),E=t(85648),G=t(44482),N=t(2186),H=t(59126),O=t(29311);let Y=[".note"];function R(){let e=(0,j.k)(e=>e.wallet),n=(0,j.k)(e=>e.files),t=(0,j.k)(e=>e.filesPath),s=(0,j.k)(e=>e.setItem),a=(0,j.k)(e=>e.rootCID),c=(0,j.k)(e=>e.updateRootCID),u=(0,O.E)(e=>e.dotCID),[x,f]=(0,i.useState)(!1),[g,R]=(0,i.useState)(!1),[L,U]=(0,i.useState)([]),[W,q]=(0,i.useState)(!1),[_,J]=(0,i.useState)(""),[K,V]=(0,i.useState)(100),[Q,Z]=(0,i.useState)(!1),[$,X]=(0,i.useState)(null),[ee,en]=(0,i.useState)(""),[et,er]=(0,i.useState)(""),[ei,el]=(0,i.useState)(!1),[es,eo]=(0,i.useState)(!1),[ea,ec]=(0,i.useState)(""),[ed,eu]=(0,i.useState)(!1),eh=(0,i.useRef)(null),ex=(0,i.useRef)(null),em=async e=>{try{f(!0);let n=await z.FH.post("/files/".concat(e));J(""),s("files",n.data)}catch(e){console.info(e)}finally{f(!1)}},ej=async()=>{if(!ea)return void H.notifications.show({title:"提示",message:"文件夹名称不能为空",color:"red"});if(null==n?void 0:n.some(e=>"directory"===e.type&&e.name===ea))return void H.notifications.show({title:"提示",message:"文件夹已存在",color:"red"});try{var e;eu(!0);let n=t?"".concat(t,"/").concat(ea):ea,r=new Blob(["Most.Box"],{type:"text/plain"}),i=new FormData;if(i.append("file",r,"hello.txt"),i.append("path","".concat(n,"/hello.txt")),null==(e=(await z.FH.put("/files.upload",i)).data)?void 0:e.cid)c(),H.notifications.show({message:"文件夹创建成功",color:"green"}),await em(t),eo(!1),ec("");else throw Error("文件夹创建失败")}catch(e){console.info(e),H.notifications.show({message:e.message,color:"red"})}finally{eu(!1)}},ep=e=>{if(0===e)return"0 B";let n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(2))+" "+["B","KB","MB","GB"][n]},ef=n?n.filter(e=>p.A.pinyin(e.name,_,0)).sort((e,n)=>"directory"===e.type&&"directory"!==n.type?-1:+("directory"!==e.type&&"directory"===n.type)):[],eg=ef.slice(0,K),ew=ef.length>K;(0,i.useEffect)(()=>{V(100)},[_]);let ey=async e=>{var n,r;if(!e||0===e.length)return;R(!0);let i=H.notifications.show({title:"上传中",message:"请稍后...",color:"blue",autoClose:!1});try{for(let r=0;r<e.length;r++){let l=e[r],s=new FormData;s.append("file",l);let o=l.webkitRelativePath,a=t?"".concat(t,"/").concat(o):o;s.append("path",a+l.name),(null==(n=(await z.FH.put("/files.upload",s)).data)?void 0:n.cid)&&H.notifications.update({id:i,title:"上传中",message:"".concat(l.name," 上传成功")})}H.notifications.update({id:i,title:"上传完成",message:"共上传 ".concat(e.length," 个文件"),color:"green",autoClose:!0}),c(),await em(t),q(!1),U([])}catch(n){let e=(null==n||null==(r=n.response)?void 0:r.data)||"文件上传失败，请重试";e.includes("already has")&&(e="文件已存在"),H.notifications.update({id:i,title:"上传失败",message:e,color:"red",autoClose:!0})}finally{R(!1)}},ev=e=>{let n=e.target.files;if(n&&n.length>0){let e=Array.from(n);1!==e.length||e[0].webkitRelativePath?(U(e.map(e=>({file:e,path:e.webkitRelativePath||e.name,size:ep(e.size)}))),q(!0)):ey(e)}e.target.value=""},ek=()=>{q(!1),U([])},eC=async e=>{try{let n=t?"".concat(t,"/").concat(e):e;await z.FH.delete("/files/".concat(n)),H.notifications.show({title:"删除成功",message:"文件 ".concat(e," 已删除"),color:"green"}),await em(t)}catch(n){console.error("删除失败:",n),H.notifications.show({title:"删除失败",message:"删除文件 ".concat(e," 失败，请重试"),color:"red"})}},eb=async()=>{let e=e=>(e||"").replace(/^\/+|\/+$/g,"");if(!$||!ee.trim())return void Z(!1);let n=t?"".concat(t,"/").concat($.name):$.name,r=e(et||""),i=r?"".concat(r,"/").concat(ee.trim()):ee.trim();if(e(n)===e(i))return void Z(!1);el(!0);try{await z.FH.put("/files.rename",{oldName:"/".concat(e(n)),newName:"/".concat(e(i))}),c(),H.notifications.show({title:"重命名成功",message:'新路径名称 "'.concat(e(i),'"'),color:"green"}),await em(t),Z(!1),X(null),en(""),er("")}catch(e){console.error("重命名失败:",e),H.notifications.show({title:"重命名失败",message:'重命名文件 "'.concat($.name,'" 失败，请重试'),color:"red"})}finally{el(!1)}},eD=e=>{let n=t?"".concat(t,"/").concat(e):e;s("filesPath",n),em(n)},eI=e=>{let n=(t||"").split("/").filter(Boolean);if(e<0){s("filesPath",""),em("");return}let r=n.slice(0,e+1).join("/");s("filesPath",r),em(r)},eS=e=>{try{let n=new URL(u);n.pathname="/ipfs/".concat(e.cid["/"]),e.name&&n.searchParams.set("filename",e.name),window.open(n.toString(),"_blank")}catch(e){console.error("打开失败",e)}};(0,i.useEffect)(()=>{a&&e&&!n&&em(t)},[a,e,n]);let eA=e=>(e||"").replace(/^\/+|\/+$/g,""),eT=$?eA(t?"".concat(t,"/").concat($.name):$.name):"",eM=eA(((et?"".concat(et,"/"):"")+ee).trim());return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(m.Stack,{gap:"md",p:"md",children:[(0,r.jsx)(w.Center,{children:(0,r.jsx)(y.TextInput,{placeholder:"搜索文件名称",value:_,onChange:e=>J(e.currentTarget.value),size:"md",radius:"md",w:400,styles:{input:{textAlign:"center"}}})}),(0,r.jsxs)(h.Group,{justify:"space-between",align:"center",pos:"relative",children:[(0,r.jsx)(v.LoadingOverlay,{visible:x,overlayProps:{backgroundOpacity:0},loaderProps:{type:"dots"}}),(0,r.jsxs)(k.Badge,{variant:"light",size:"lg",children:[_?"显示 ".concat(eg.length," / ").concat(ef.length," (总共 ").concat((null==n?void 0:n.length)||0,")"):"显示 ".concat(eg.length," / ").concat((null==n?void 0:n.length)||0)," ","个文件"]}),(0,r.jsxs)(h.Group,{children:[(0,r.jsx)(C.Tooltip,{label:"刷新",children:(0,r.jsx)(l.ActionIcon,{size:"lg",onClick:()=>em(t),color:"blue",disabled:!e,children:(0,r.jsx)(B.A,{size:18})})}),(0,r.jsx)(C.Tooltip,{label:"上传文件",children:(0,r.jsx)(l.ActionIcon,{size:"lg",onClick:()=>{var e;null==(e=eh.current)||e.click()},color:"green",disabled:!e||g,children:(0,r.jsx)(F.A,{size:18})})}),(0,r.jsx)(C.Tooltip,{label:"上传文件夹",children:(0,r.jsx)(l.ActionIcon,{size:"lg",onClick:()=>{var e;null==(e=ex.current)||e.click()},color:"yellow",disabled:!e||g,children:(0,r.jsx)(E.A,{size:18})})})]})]}),_&&0===ef.length?(0,r.jsxs)(m.Stack,{align:"center",justify:"center",h:200,children:[(0,r.jsx)(o.Text,{size:"lg",c:"dimmed",children:"未找到文件"}),(0,r.jsx)(o.Text,{size:"sm",c:"dimmed",children:"尝试用其他关键词搜索"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.Card,{radius:"md",withBorder:!0,children:(0,r.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:4,children:[(0,r.jsxs)(h.Group,{gap:8,wrap:"nowrap",children:[(0,r.jsx)(o.Text,{fw:500,children:"\uD83D\uDCC1"}),(0,r.jsxs)(D.Breadcrumbs,{separator:"›",children:[(0,r.jsx)(I.Anchor,{fw:500,onClick:()=>eI(-1),underline:"never",children:"根目录"}),(t||"").split("/").filter(Boolean).map((e,n)=>(0,r.jsx)(I.Anchor,{fw:500,onClick:()=>eI(n),underline:"never",children:e},n))]})]}),(0,r.jsxs)(S.Menu,{shadow:"md",children:[(0,r.jsx)(S.Menu.Target,{children:(0,r.jsx)(l.ActionIcon,{variant:"subtle",color:"gray",children:(0,r.jsx)(G.A,{size:14})})}),(0,r.jsxs)(S.Menu.Dropdown,{children:[(0,r.jsx)(S.Menu.Item,{onClick:()=>eo(!0),leftSection:"\uD83D\uDCC1",disabled:!e,children:"新建文件夹"}),(0,r.jsx)(S.Menu.Item,{onClick:()=>eS({name:"root",type:"directory",cid:{"/":a},size:0}),leftSection:"\uD83C\uDF10",disabled:!e,children:"根目录 CID"})]})]})]})}),(0,r.jsxs)(A.Grid,{gutter:"md",pos:"relative",children:[(0,r.jsx)(v.LoadingOverlay,{visible:x,overlayProps:{backgroundOpacity:0},loaderProps:{opacity:0}}),eg.map((e,n)=>(0,r.jsx)(A.Grid.Col,{span:{base:12,xs:6,sm:4,md:3,lg:3,xl:2},children:(0,r.jsx)(b.Card,{radius:"md",withBorder:!0,children:(0,r.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:4,children:[(0,r.jsx)(m.Stack,{flex:1,style:{cursor:"directory"===e.type?"pointer":""},onClick:()=>{"directory"===e.type&&eD(e.name)},children:(0,r.jsxs)(o.Text,{fw:500,lineClamp:1,children:["directory"===e.type?"\uD83D\uDCC1":"\uD83D\uDCC4"," ",e.name]})}),(0,r.jsxs)(S.Menu,{shadow:"md",width:120,children:[(0,r.jsx)(S.Menu.Target,{children:(0,r.jsx)(l.ActionIcon,{variant:"subtle",color:"gray",children:(0,r.jsx)(G.A,{size:14})})}),(0,r.jsxs)(S.Menu.Dropdown,{children:[(0,r.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCD6",onClick:()=>{"directory"===e.type?eD(e.name):eS(e)},children:"directory"===e.type?"打开":"查看"}),(0,r.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCE4",onClick:()=>{let n=e.cid["/"],t=new URLSearchParams({filename:e.name});"directory"===e.type&&t.set("type","dir");let r="/ipfs/".concat(n,"/?").concat(t.toString());window.open(r)},children:"分享"}),(0,r.jsx)(S.Menu.Item,{leftSection:"✏️",onClick:()=>{X(e),en(e.name),er(t||""),Z(!0)},children:"重命名"}),(0,r.jsx)(S.Menu.Divider,{}),(0,r.jsx)(S.Menu.Item,{leftSection:"⬇️",component:d(),target:"_blank",href:(e=>{let n=new URLSearchParams({download:"true",filename:e.name});return"directory"===e.type&&(n.set("format","tar"),n.set("filename","".concat(e.name,".tar"))),"".concat(u,"/ipfs/").concat(e.cid["/"],"?").concat(n.toString())})(e),children:"下载"}),(0,r.jsx)(S.Menu.Item,{disabled:""===t&&"directory"===e.type&&Y.includes(e.name),leftSection:"\uD83D\uDDD1️",onClick:()=>{window.confirm('确定要删除文件 "'.concat(e.name,'" 吗？'))&&eC(e.name)},children:"删除"}),e.size>0&&(0,r.jsx)(S.Menu.Label,{children:(0,r.jsx)(w.Center,{children:(0,r.jsx)(o.Text,{size:"xs",c:"dimmed",children:ep(e.size)})})})]})]})]})})},n))]}),ew&&(0,r.jsx)(w.Center,{children:(0,r.jsxs)(T.Button,{variant:"light",onClick:()=>{V(e=>e+100)},size:"md",children:["继续加载 (",ef.length-K," 个剩余)"]})})]})]}),!e&&(0,r.jsx)(w.Center,{children:(0,r.jsx)(T.Button,{variant:"gradient",component:d(),href:"/login",children:"去登录"})}),(0,r.jsx)("input",{ref:eh,type:"file",multiple:!0,style:{display:"none"},onChange:ev}),(0,r.jsx)("input",{ref:ex,type:"file",webkitdirectory:"",multiple:!0,style:{display:"none"},onChange:ev}),(0,r.jsx)(M.Modal,{opened:W,onClose:ek,title:"文件预览",size:"lg",centered:!0,children:(0,r.jsxs)(m.Stack,{gap:"md",children:[(0,r.jsx)(h.Group,{justify:"space-between",children:(0,r.jsxs)(o.Text,{size:"sm",c:"dimmed",children:["共 ",L.length," 个文件，总大小: ",ep(L.reduce((e,n)=>e+n.file.size,0))]})}),(0,r.jsx)(P.ScrollArea,{h:300,children:(0,r.jsx)(m.Stack,{gap:"xs",children:L.map((e,n)=>(0,r.jsx)(b.Card,{p:"sm",withBorder:!0,children:(0,r.jsxs)(h.Group,{justify:"space-between",align:"center",wrap:"nowrap",children:[(0,r.jsxs)(h.Group,{align:"center",children:[(0,r.jsx)(o.Text,{size:"sm",children:"\uD83D\uDCC4"}),(0,r.jsxs)(m.Stack,{gap:2,children:[(0,r.jsx)(o.Text,{size:"sm",fw:500,children:e.path}),(0,r.jsx)(o.Text,{size:"xs",c:"dimmed",children:e.size})]})]}),(0,r.jsx)(l.ActionIcon,{variant:"subtle",color:"gray",onClick:()=>(e=>{let n=L.filter((n,t)=>t!==e);U(n),0===n.length&&q(!1)})(n),children:(0,r.jsx)(N.A,{})})]})},n))})}),(0,r.jsxs)(h.Group,{justify:"flex-end",gap:"sm",children:[(0,r.jsx)(T.Button,{variant:"outline",onClick:ek,disabled:g,children:"取消"}),(0,r.jsx)(T.Button,{onClick:()=>{ey(L.map(e=>e.file))},loading:g,disabled:0===L.length,children:"确认上传"})]})]})}),(0,r.jsx)(M.Modal,{opened:es,onClose:()=>eo(!1),title:"新建文件夹",centered:!0,children:(0,r.jsxs)(m.Stack,{gap:"md",children:[(0,r.jsx)(y.TextInput,{value:ea,onChange:e=>ec(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&ej()},disabled:ed,autoFocus:!0}),(0,r.jsxs)(h.Group,{justify:"flex-end",gap:"sm",children:[(0,r.jsx)(T.Button,{onClick:()=>eo(!1),variant:"default",children:"取消"}),(0,r.jsx)(T.Button,{onClick:ej,loading:ed,children:"确认"})]})]})}),(0,r.jsx)(M.Modal,{opened:Q,onClose:()=>{Z(!1),X(null),en(""),er("")},title:"重命名 / 移动",centered:!0,children:(0,r.jsxs)(m.Stack,{gap:"md",children:[(0,r.jsx)(y.TextInput,{label:"目录路径",placeholder:"根目录留空，例如: foo/bar",value:et,onChange:e=>er(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&eb()},disabled:ei}),(0,r.jsx)(y.TextInput,{label:"文件/文件夹名称",placeholder:"请输入新的名称",value:ee,onChange:e=>en(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&eb()},disabled:ei,autoFocus:!0}),(0,r.jsxs)(h.Group,{justify:"flex-end",gap:"sm",children:[(0,r.jsx)(T.Button,{variant:"outline",onClick:()=>{Z(!1),X(null),en(""),er("")},disabled:ei,children:"取消"}),(0,r.jsx)(T.Button,{onClick:eb,disabled:!ee.trim()||eT===eM||ei,loading:ei,children:"确认"})]})]})})]})}t(94842),t(97030);var L=t(31064);function U(){let e=(0,j.k)(e=>e.wallet),n=(0,j.k)(e=>e.notes),t=(0,j.k)(e=>e.rootCID),s=(0,j.k)(e=>e.updateRootCID),a=(0,j.k)(e=>e.notesQuery),c=(0,j.k)(e=>e.setItem),[x,f]=(0,i.useState)(!1),[g,D]=(0,i.useState)(100),[I,{open:P,close:E}]=(0,L.useDisclosure)(!1),[N,O]=(0,i.useState)(""),[Y,R]=(0,i.useState)(""),[U,W]=(0,i.useState)(""),[q,_]=(0,i.useState)(!1),[J,{open:K,close:V}]=(0,L.useDisclosure)(!1),[Q,Z]=(0,i.useState)(null),[$,X]=(0,i.useState)(""),[ee,en]=(0,i.useState)(!1),[et,er]=(0,i.useState)(""),[ei,el]=(0,i.useState)(""),es=n=>{let t=new URL(window.location.href);return t.pathname="/note/",t.searchParams.set("uid",(null==e?void 0:e.address)||""),t.searchParams.set("name",n.name),t.searchParams.set("cid",n.cid),t.href},eo=n?n.filter(e=>p.A.pinyin(e.name,a,0)):[],ea=eo.slice(0,g),ec=eo.length>g;(0,i.useEffect)(()=>{D(100)},[a]);let ed=async()=>{try{f(!0);let e=(await z.FH.post("/files/.note")).data;if(e){let n=e.map(e=>({name:e.name,cid:e.cid["/"]}));c("notes",n)}}catch(e){console.info(e)}finally{f(!1)}},eu=async()=>{let e=Y.trim(),t=N.trim();if(!t)return void W("请输入笔记名称");if(e.includes("/")||t.includes("/"))return void W("不能包含字符 /");let r=e?"".concat(e,"-").concat(t):t;if(null==n?void 0:n.some(e=>e.name===r))return void W("笔记名称已存在");try{var i;_(!0);let e=new FormData,n=new Blob([""],{type:"text/markdown"});e.append("file",n,"index.md"),e.append("path","/.note/".concat(r,"/index.md")),(null==(i=(await z.FH.put("/files.upload",e)).data)?void 0:i.cid)&&(s(),H.notifications.show({color:"green",message:"笔记创建成功"}),E(),await ed(),O(""),R(""))}catch(e){H.notifications.show({color:"red",message:e instanceof Error?e.message:"创建失败，请重试"})}finally{_(!1)}},eh=e=>{Z(e),X("");let n=e.name.indexOf("-");if(n>0){let t=e.name.slice(0,n),r=e.name.slice(n+1);er(t),el(r)}else er(""),el(e.name);K()},ex=e=>{let n=es(e);window.open(n)},em=async()=>{if(!Q)return;let e=et.trim(),t=ei.trim();if(!t)return void X("请输入名称");if(e.includes("/")||t.includes("/"))return void X("不能包含字符 /");let r=e?"".concat(e,"-").concat(t):t;if(r===Q.name)return void V();if(null==n?void 0:n.some(e=>e.name===r))return void X("笔记名称已存在");try{en(!0),await z.FH.put("/files.rename",{oldName:"/.note/".concat(Q.name),newName:"/.note/".concat(r)}),s(),H.notifications.show({color:"green",message:"重命名成功"}),V(),await ed()}catch(e){H.notifications.show({color:"red",message:e instanceof Error?e.message:"重命名失败"})}finally{en(!1)}},ej=async e=>{if(confirm('确定要删除笔记"'.concat(e.name,'"吗？此操作不可撤销。')))try{await z.FH.delete("/files/.note/".concat(e.name)),H.notifications.show({color:"green",message:"删除成功"}),await ed()}catch(e){H.notifications.show({color:"red",message:e instanceof Error?e.message:"删除失败"})}},ep=e=>{window.open("/ipfs/".concat(e.cid,"/?filename=").concat(e.name,"&type=note"))},ef=()=>{O(""),R(""),W(""),E()},eg=()=>{Z(null),er(""),el(""),X(""),V()};return(0,i.useEffect)(()=>{t&&e&&!n&&ed()},[t,e,n]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(m.Stack,{gap:"md",p:"md",children:[(0,r.jsx)(w.Center,{children:(0,r.jsx)(y.TextInput,{placeholder:"搜索笔记名称",value:a,onChange:e=>c("notesQuery",e.currentTarget.value),size:"md",radius:"md",w:400,styles:{input:{textAlign:"center"}}})}),(0,r.jsxs)(h.Group,{justify:"space-between",align:"center",pos:"relative",children:[(0,r.jsx)(v.LoadingOverlay,{visible:x,overlayProps:{backgroundOpacity:0},loaderProps:{type:"dots"}}),(0,r.jsxs)(k.Badge,{variant:"light",size:"lg",children:[a?"显示 ".concat(ea.length," / ").concat(eo.length," (总共 ").concat((null==n?void 0:n.length)||0,")"):"显示 ".concat(ea.length," / ").concat((null==n?void 0:n.length)||0)," ","","个笔记"]}),(0,r.jsxs)(h.Group,{children:[(0,r.jsx)(C.Tooltip,{label:"刷新",children:(0,r.jsx)(l.ActionIcon,{size:"lg",onClick:ed,color:"blue",disabled:!e,children:(0,r.jsx)(B.A,{size:18})})}),(0,r.jsx)(C.Tooltip,{label:"新笔记",children:(0,r.jsx)(l.ActionIcon,{size:"lg",onClick:P,color:"green",disabled:!e,children:(0,r.jsx)(F.A,{size:18})})})]})]}),a&&0===eo.length?(0,r.jsxs)(m.Stack,{align:"center",justify:"center",h:200,children:[(0,r.jsx)(o.Text,{size:"lg",c:"dimmed",children:"未找到笔记"}),(0,r.jsx)(o.Text,{size:"sm",c:"dimmed",children:"尝试用其他关键词搜索"})]}):(0,r.jsxs)(r.Fragment,{children:[(()=>{let e=new Map,n=[];return ea.forEach(t=>{let r=t.name.indexOf("-");if(r>0){let n=t.name.slice(0,r),i=e.get(n)||[];i.push(t),e.set(n,i)}else n.push(t)}),(0,r.jsxs)(A.Grid,{gutter:"md",children:[[...e.entries()].map(e=>{let[n,t]=e;return(0,r.jsx)(A.Grid.Col,{span:{base:12,xs:6,sm:4,md:3,lg:3,xl:2},children:(0,r.jsxs)(b.Card,{radius:"md",withBorder:!0,children:[(0,r.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:4,mb:"xs",children:[(0,r.jsx)(o.Text,{fw:700,children:n}),(0,r.jsx)(k.Badge,{variant:"light",children:t.length})]}),(0,r.jsx)(m.Stack,{gap:0,children:t.map(e=>{let t=e.name.slice(n.length+1);return(0,r.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:0,children:[(0,r.jsx)(u.Box,{py:6,className:"mp-hover",flex:1,component:d(),href:es(e),children:(0,r.jsx)(o.Text,{fw:500,lineClamp:1,c:"var(--mantine-color-text)",children:t||e.name})}),(0,r.jsxs)(S.Menu,{shadow:"md",width:120,children:[(0,r.jsx)(S.Menu.Target,{children:(0,r.jsx)(l.ActionIcon,{variant:"subtle",color:"gary",children:(0,r.jsx)(G.A,{size:14})})}),(0,r.jsxs)(S.Menu.Dropdown,{children:[(0,r.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCD6",onClick:()=>ex(e),children:"打开"}),(0,r.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCE4",onClick:()=>ep(e),children:"分享"}),(0,r.jsx)(S.Menu.Item,{leftSection:"✏️",onClick:()=>eh(e),children:"重命名"}),(0,r.jsx)(S.Menu.Divider,{}),(0,r.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDDD1️",onClick:()=>ej(e),children:"删除"})]})]})]},e.name)})})]})},"group-".concat(n))}),n.map(e=>(0,r.jsx)(A.Grid.Col,{span:{base:12,xs:6,sm:4,md:3,lg:3,xl:2},children:(0,r.jsx)(b.Card,{radius:"md",withBorder:!0,children:(0,r.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:0,children:[(0,r.jsx)(o.Text,{flex:1,fw:500,lineClamp:1,component:d(),href:es(e),children:e.name}),(0,r.jsxs)(S.Menu,{shadow:"md",width:120,children:[(0,r.jsx)(S.Menu.Target,{children:(0,r.jsx)(l.ActionIcon,{variant:"subtle",color:"gary",children:(0,r.jsx)(G.A,{size:14})})}),(0,r.jsxs)(S.Menu.Dropdown,{children:[(0,r.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCD6",onClick:()=>ex(e),children:"打开"}),(0,r.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCE4",onClick:()=>ep(e),children:"分享"}),(0,r.jsx)(S.Menu.Item,{leftSection:"✏️",onClick:()=>eh(e),children:"重命名"}),(0,r.jsx)(S.Menu.Divider,{}),(0,r.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDDD1️",onClick:()=>ej(e),children:"删除"})]})]})]})})},e.name))]})})(),ec&&(0,r.jsx)(w.Center,{children:(0,r.jsxs)(T.Button,{variant:"light",onClick:()=>{D(e=>e+100)},size:"md",children:["继续加载 (",eo.length-g," 个剩余)"]})})]})]}),!e&&(0,r.jsx)(w.Center,{children:(0,r.jsx)(T.Button,{variant:"gradient",component:d(),href:"/login",children:"去登录"})}),(0,r.jsx)(M.Modal,{opened:I,onClose:ef,title:"创建新笔记",centered:!0,children:(0,r.jsxs)(m.Stack,{gap:"md",children:[(0,r.jsx)(y.TextInput,{label:"分组（可选）",value:Y,onChange:e=>{R(e.currentTarget.value),W("")}}),(0,r.jsx)(y.TextInput,{placeholder:"请输入笔记名称",value:N,onChange:e=>{O(e.currentTarget.value),W("")},error:U,autoFocus:!0}),(0,r.jsxs)(h.Group,{justify:"flex-end",children:[(0,r.jsx)(T.Button,{variant:"default",onClick:ef,children:"取消"}),(0,r.jsx)(T.Button,{loading:q,onClick:eu,children:"创建"})]})]})}),(0,r.jsx)(M.Modal,{opened:J,onClose:eg,title:"笔记重命名",centered:!0,children:(0,r.jsxs)(m.Stack,{gap:"md",children:[(0,r.jsx)(y.TextInput,{label:"分组（可选）",value:et,onChange:e=>{er(e.currentTarget.value),X("")}}),(0,r.jsx)(y.TextInput,{label:"名称",placeholder:"请输入名称",value:ei,onChange:e=>{el(e.currentTarget.value),X("")},error:$}),(0,r.jsxs)(h.Group,{justify:"flex-end",children:[(0,r.jsx)(T.Button,{variant:"default",onClick:eg,children:"取消"}),(0,r.jsx)(T.Button,{loading:ee,onClick:em,children:"确认"})]})]})})]})}let W=JSON.parse('["批评与自我批评","密切联系群众","理论联系实际","统一战线","武装斗争","党的建设","实事求是","独立自主","抱定必死的决心","没有调查，就没有发言权","我为人人，人人为我","具体问题，具体分析","不同条件，不同结果","实践是检验真理的唯一标准","从最坏处着眼，往最好处努力","见微知著","读史以明志，鉴往而知来","爱的本质是付出","团结 紧张 严肃 活泼","出发就能到达","没说不行就是可以","真正的勇士敢于直面惨淡的人生和淋漓的鲜血","君子用人如器，各取所长","合抱之木，生于毫末","九层之台，起于累土","千里之行，始于足下","出发就能到达","人生的最高法则是什么：斗争","广厦千间，夜眠仅需六尺","不积跬步，无以至千里也","你若一往无前，自有人紧跟相随","家财万贯，日食不过三餐","碌碌百载，终归仅需寸土","芸芸众生，遍寻不过一人","把事情变简单","凡夫畏果，菩萨畏因","光灿烂时，星已死灭","聪明是一种天赋，而善良是一种选择","你打你的，我打我的","以斗争求和平则和平存，以妥协求和平则和平亡","抓住主要矛盾不放手"]');var q=t(13877),_=t(74264),J=t(71165),K=t(33380),V=t(61505),Q=t(38639);function Z(){let[e,n]=(0,i.useState)(""),t=(0,i.useRef)(null),l=(0,i.useRef)(null),s=(0,i.useRef)(null),c=(0,j.k)(e=>e.nodeDark),x=(0,V.B)(),m=async()=>{t.current&&(await x.initViewer(t.current)).setMarkdown("IPFS (InterPlanetary File System) 是一种点对点的分布式文件系统协议。旨在创建一个更开放、更快速、更安全、更持久化的网络，以取代或补充目前主导互联网的 http 协议。\r\n\r\n**核心思想：从“位置寻址”到“内容寻址”**\r\n\r\n- IPFS：你通过一个内容本身的唯一加密哈希值 (称为 CID - Content Identifier) 来访问内容。这个哈希值就像是内容的数字指纹，完全由内容本身计算得来。只要内容不变，哈希值就不变。这称为 “内容寻址” - 你通过内容本身（其指纹）请求内容。\r\n\r\n- [/ipfs/bafkreihp5o7tdipf6ajkgkdxknnffkuxpeecwqydi4q5iqt4gko6r2agk4](/ipfs/bafkreihp5o7tdipf6ajkgkdxknnffkuxpeecwqydi4q5iqt4gko6r2agk4)\r\n"),l.current&&(await x.initViewer(l.current)).setMarkdown(Q.A),s.current&&(await x.initViewer(s.current)).setMarkdown("Most.Box 节点是 IPFS 网关的开源封装。部署节点即可运行独立应用，并通过区块链共享信息。随着用户增多，通过内容寻址在 IPFS 网络中查找和分享文件将变得更加高效。\r\n\r\n[Windows 部署教程](/build/?system=windows) | [Linux 部署教程](/build/?system=linux)\r\n\r\n节点实现前后端分离，可以直接切换当前已部署的公开节点：[/dot](/dot)\r\n")};return(0,i.useEffect)(()=>{m();let e=Math.floor(Math.random()*W.length);n(W[e])},[]),(0,r.jsxs)(q.Container,{py:"md",children:[(0,r.jsx)(_.Title,{size:"h3",children:"Most.Box - 如影随形"}),(0,r.jsx)(o.Text,{c:"dimmed",children:"——「轻松简单、开源免费、部署自己的节点」"}),(0,r.jsx)(J.Divider,{my:"md"}),(0,r.jsxs)(K.Accordion,{my:"md",variant:"separated",defaultValue:"IPFS",children:[(0,r.jsxs)(K.Accordion.Item,{value:"IPFS",children:[(0,r.jsx)(K.Accordion.Control,{icon:"\uD83C\uDF4E",children:"1. IPFS"}),(0,r.jsx)(K.Accordion.Panel,{children:(0,r.jsx)(u.Box,{className:c,ref:t})})]}),(0,r.jsxs)(K.Accordion.Item,{value:"IPv6",children:[(0,r.jsx)(K.Accordion.Control,{icon:"\uD83C\uDF4C",children:"2. 公网 IPV6"}),(0,r.jsx)(K.Accordion.Panel,{children:(0,r.jsx)(u.Box,{className:c,ref:l})})]}),(0,r.jsxs)(K.Accordion.Item,{value:"DOT",children:[(0,r.jsx)(K.Accordion.Control,{icon:"\uD83E\uDD66",children:"3. 运行节点"}),(0,r.jsx)(K.Accordion.Panel,{children:(0,r.jsx)(u.Box,{className:c,ref:s})})]})]}),(0,r.jsx)(_.Title,{size:"h3",children:"使用说明"}),(0,r.jsx)(o.Text,{c:"dimmed",children:"——「回归数据存储本质」"}),(0,r.jsx)(J.Divider,{my:"md"}),(0,r.jsxs)(K.Accordion,{my:"md",variant:"separated",children:[(0,r.jsxs)(K.Accordion.Item,{value:"DOT",children:[(0,r.jsx)(K.Accordion.Control,{icon:"\uD83C\uDF10",children:"节点切换"}),(0,r.jsxs)(K.Accordion.Panel,{children:["点击左上角 ",(0,r.jsx)(a.I,{name:"Earth",size:24})," 图标选择 IPFS 网关"]})]}),(0,r.jsxs)(K.Accordion.Item,{value:"NOTE",children:[(0,r.jsx)(K.Accordion.Control,{icon:"✏️",children:"笔记"}),(0,r.jsxs)(K.Accordion.Panel,{children:["点击底部 ",(0,r.jsx)(a.I,{name:"Note",size:24})," 图标，创建 Markdown 笔记"]})]}),(0,r.jsxs)(K.Accordion.Item,{value:"IPFS",children:[(0,r.jsx)(K.Accordion.Control,{icon:"\uD83D\uDCC2",children:"文件系统"}),(0,r.jsxs)(K.Accordion.Panel,{children:["点击左下角 ",(0,r.jsx)(a.I,{name:"File",size:24})," 图标，打开 IPFS 星级文件系统"]})]})]}),(0,r.jsx)(J.Divider,{my:"md"}),(0,r.jsx)(h.Group,{justify:"flex-end",children:(0,r.jsxs)(o.Text,{c:"dimmed",children:["——「",e,"」"]})}),(0,r.jsx)(_.Title,{size:"h3",children:"快捷入口"}),(0,r.jsx)(J.Divider,{my:"md"}),(0,r.jsx)(K.Accordion,{my:"md",variant:"separated",children:(0,r.jsxs)(K.Accordion.Item,{value:"GAME",children:[(0,r.jsx)(K.Accordion.Control,{icon:"\uD83E\uDD95",children:"小游戏"}),(0,r.jsx)(K.Accordion.Panel,{children:(0,r.jsxs)(h.Group,{children:[(0,r.jsx)(I.Anchor,{component:d(),href:"/game/5",children:(0,r.jsx)(o.Text,{children:"五子棋"})}),(0,r.jsx)(I.Anchor,{component:d(),href:"/game/black",children:(0,r.jsx)(o.Text,{children:"黑白棋"})}),(0,r.jsx)(I.Anchor,{component:d(),href:"/game/21",children:(0,r.jsx)(o.Text,{children:"二十一点"})})]})})]})})]})}t(41487);var $=t(90101);function X(){let[e,n]=(0,i.useState)(null);return(0,i.useEffect)(()=>{n(localStorage.getItem("homeTab")||"explore")},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)($.AppHeader,{title:"Most.Box - 如影随形",left:(0,r.jsx)(l.ActionIcon,{variant:"transparent",color:"--text-color",component:d(),href:"/dot",children:(0,r.jsx)(a.I,{name:"Earth",size:24})})}),(0,r.jsxs)(s.Tabs,{id:"page-home",variant:"pills",radius:0,value:e,onChange:e=>{n(e),localStorage.setItem("homeTab",e||"explore")},children:[(0,r.jsx)(s.Tabs.Panel,{keepMounted:!0,value:"file",children:(0,r.jsx)(R,{})}),(0,r.jsx)(s.Tabs.Panel,{keepMounted:!0,value:"note",children:(0,r.jsx)(U,{})}),(0,r.jsx)(s.Tabs.Panel,{keepMounted:!0,value:"explore",children:(0,r.jsx)(Z,{})}),(0,r.jsx)(s.Tabs.Panel,{keepMounted:!0,value:"mine",children:(0,r.jsx)(f,{})}),(0,r.jsxs)(s.Tabs.List,{children:[(0,r.jsxs)(s.Tabs.Tab,{value:"file",children:[(0,r.jsx)(a.I,{name:"file"===e?"FileActive":"File"}),(0,r.jsx)(o.Text,{children:"文件"})]}),(0,r.jsxs)(s.Tabs.Tab,{value:"note",children:[(0,r.jsx)(a.I,{name:"note"===e?"NoteActive":"Note"}),(0,r.jsx)(o.Text,{children:"笔记"})]}),(0,r.jsxs)(s.Tabs.Tab,{value:"explore",children:[(0,r.jsx)(a.I,{name:"explore"===e?"ExploreActive":"Explore"}),(0,r.jsx)(o.Text,{children:"探索"})]}),(0,r.jsxs)(s.Tabs.Tab,{value:"mine",children:[(0,r.jsx)(a.I,{name:"mine"===e?"MineActive":"Mine"}),(0,r.jsx)(o.Text,{children:"我的"})]})]})]})]})}},65388:(e,n,t)=>{Promise.resolve().then(t.bind(t,63934))},94842:()=>{},97030:()=>{},97443:(e,n,t)=>{"use strict";t.d(n,{A:()=>S});var r=t(43591),i=t(68110),l=t(38798),s=t(16405),o=t(82127),a=t(34477),c=t(55544),d=t(85179),u=t(56612),h=t(86710),x=t(36117),m=t.n(x),j=t(44839),p=t.n(j);t(28223);var f=t(78595),g=t.n(f),w=t(28555),y=t.n(w);m().extend(g()),m().extend(p()),m().locale("zh-cn");let v=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYYMM",t=m()().isoWeek(),r=m()().format(n)+t,i=sessionStorage.getItem("fingerprint");if(!i)throw Error("请先获取设备指纹");let l=[location.origin,i].join("/"),{public_key:s,private_key:o}=(0,u.BP)(r,l);return(0,u.yO)(JSON.stringify(e),s,o)},k=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYYMM",t=m()().isoWeek(),r=m()().format(n)+t,i=sessionStorage.getItem("fingerprint");if(!i)throw Error("请先获取设备指纹");let l=[location.origin,i].join("/"),{public_key:s,private_key:o}=(0,u.BP)(r,l),a=(0,u.OM)(e,s,o);if(!a)throw Error("jwt 解析失败");let c=JSON.parse(a);if(!c.address)throw Error("jwt json 解析失败");return c},C=async e=>{let n=Date.now().toString(),t=l.QX.fromPhrase(e.mnemonic),r=await t.signMessage(n);localStorage.token=[e.address,n,r].join(".")},b=e=>{try{var n;let t=v(e);if((null==(n=k(t))?void 0:n.address)===e.address)return localStorage.setItem("jwt",t),C(e),e}catch(e){console.log("登录失败:",e)}return null},D=(e,n)=>{let t=n.slice(2),r=new Uint8Array((0,s.q5)(e+t));return y().sign.keyPair.fromSecretKey(r)},I={avatar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,a.gn)(c,{seed:"most.box@"+e,flip:!0,backgroundType:["gradientLinear"]}).toDataUri()},avatarCID:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,a.gn)(d,{seed:"most.box#"+e,flip:!0,backgroundType:["gradientLinear","solid"]}).toDataUri()},formatTime:e=>{let n;if(!e)return"";let t=m()(Number(e)),r=t.hour();return n=r>=0&&r<3?"凌晨":r>=3&&r<6?"拂晓":r>=6&&r<9?"早晨":r>=9&&r<12?"上午":r>=12&&r<15?"下午":r>=15&&r<18?"傍晚":r>=18&&r<21?"薄暮":"深夜",t.format("YYYY年M月D日 ".concat(n,"h点m分"))},formatDate:e=>{let n=m()(Number(e)),t=m()();if(n.isSame(t,"minute"))return n.format("HH:mm:ss");if(n.isSame(t,"day"))return n.format("HH:mm");if(n.isSame(t.subtract(1,"day"),"day"))return"昨天 ".concat(n.format("HH:mm"));if(n.isoWeek()===t.isoWeek())return"".concat(["周日","周一","周二","周三","周四","周五","周六"][n.day()]," ").concat(n.format("HH:mm"));if(n.year()===t.year())return n.format("M月D日");else return n.format("YY年M月D日")},formatAddress:e=>e?e.slice(0,6)+"..."+e.slice(-4):"",enBase64:e=>(0,r.W)((0,i.YW)(e)),deBase64:e=>(0,i._v)((0,r.y)(e)),createJWT:v,verifyJWT:k,login:(e,n)=>b((0,u.BP)(e,n,"I know loss mnemonic will lose my wallet.")),loginSave:b,ZeroAddress:o.j,createToken:C,pinyin:function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(n.length<t)return!1;if(e.toLowerCase().includes(n.toLowerCase()))return!0;let r=(0,h.YW)(e,n,{continuous:!0});return!!r&&!!(r.length>=t)},openDot:e=>{let n=new URL("/auth/jwt/",e),t=localStorage.getItem("jwt");if(t){let e=I.verifyJWT(t);if(e){let t=m()().format("YY/M/D HH:mm"),{public_key:r,private_key:i}=(0,u.BP)("auth/jwt",t),l=(0,u.yO)(JSON.stringify(e),r,i);n.searchParams.set("token",l)}}window.open(n.href)},getEdKeyPair:D,getIPNS:(e,n)=>{let t=(e=>{let n=new Uint8Array([8,1,18,...(e=>{let n=[];for(;e>=128;)n.push(127&e|128),e>>=7;return n.push(e),n})(e.length)]),t=new Uint8Array(n.length+e.length);return t.set(n,0),t.set(e,n.length),t})(D(e,n).publicKey),r=new Uint8Array(2+t.length);r[0]=0,r[1]=36,r.set(t,2);let i=new Uint8Array([1,114]),l=new Uint8Array(i.length+r.length);return l.set(i,0),l.set(r,i.length),"k"+((e,n)=>{if(0===e.length)return"";let t=n.length,r=0;for(;r<e.length&&0===e[r];)r++;let i=[0];for(let n=r;n<e.length;n++){let r=e[n];for(let e=0;e<i.length;e++){let n=256*i[e]+r;i[e]=n%t,r=Math.floor(n/t)}for(;r>0;)i.push(r%t),r=Math.floor(r/t)}let l="";for(let e=0;e<r;e++)l+=n[0];for(let e=i.length-1;e>=0;e--)l+=n[i[e]];return l})(l,"0123456789abcdefghijklmnopqrstuvwxyz")}},S=I}},e=>{e.O(0,[2859,8198,2545,642,2794,5619,6714,8555,8835,5125,6476,9287,3584,5595,291,9457,380,9032,7285,6982,722,6549,101,8289,8441,1255,7358],()=>e(e.s=65388)),_N_E=e.O()}]);