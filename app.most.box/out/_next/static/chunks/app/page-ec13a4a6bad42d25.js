(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{4673:(e,t,n)=>{"use strict";n.d(t,{BP:()=>u,OM:()=>x,yO:()=>h});var s=n(30167),r=n(71425),a=n(44532),l=n(87788),i=n(56076),o=n(88413),c=n(70358),d=n(26634),m=n.n(d);let u=(e,t,n)=>{let c=(0,s.YW)(t),d=(0,s.YW)("/most.box/"+e),u=(0,r.A)(c,d,3,32,"sha512"),h=(0,a.q5)((0,l.s)(u)),x=h.slice(0,32),g=m().box.keyPair.fromSecretKey(x),j=(0,a.c$)(g.publicKey),f=(0,a.c$)(g.secretKey),p=i.v.entropyToPhrase(h);return{username:e,address:o.QX.fromPhrase(p).address,public_key:j,private_key:f,mnemonic:"I know loss mnemonic will lose my wallet."===n?p:""}},h=(e,t,n)=>{let s=new TextEncoder().encode(e),r=m().randomBytes(m().box.nonceLength),l=m().box(s,r,new Uint8Array((0,a.q5)(t)),new Uint8Array((0,a.q5)(n)));return l?["mp://2",(0,c.W)(r),(0,c.W)(l)].join("."):(console.info("加密失败"),"")},x=(e,t,n)=>{let[s,r,l]=e.split(".");if("mp://2"!==s)return console.info("无效的密文"),"";let i=m().box.open((0,c.y)(l),(0,c.y)(r),new Uint8Array((0,a.q5)(t)),new Uint8Array((0,a.q5)(n)));return i?new TextDecoder().decode(i):(console.info("解密失败"),"")}},6396:()=>{},9482:(e,t,n)=>{"use strict";n.d(t,{A:()=>w});var s=n(70358),r=n(30167),a=n(88413),l=n(19396),i=n(96842),o=n(42995),c=n(3648),d=n(4673),m=n(59909),u=n(30832),h=n.n(u),x=n(99758),g=n.n(x);n(38464);var j=n(76920),f=n.n(j);h().extend(f()),h().extend(g()),h().locale("zh-cn");let p=e=>{let t=String(Date.now()),n=(0,s.W)(crypto.getRandomValues(new Uint8Array(32))),r=sessionStorage.getItem("fingerprint")||"",a=[location.origin,r].join("/"),l=[t,n].join("."),{public_key:i,private_key:o}=(0,d.BP)(a,l);return{jwt:(0,d.yO)(JSON.stringify(e),i,o),jwtSecret:l}},b=(e,t)=>{let[n]=t.split(".");if(Date.now()-Number(n)>288e5)return console.log("jwt 已过期"),null;try{let n=sessionStorage.getItem("fingerprint")||"",s=[location.origin,n].join("/"),{public_key:r,private_key:a}=(0,d.BP)(s,t),l=(0,d.OM)(e,r,a);if(l)return JSON.parse(l)}catch(e){console.log("验证失败:",e)}return null},k=async e=>{let t=Date.now().toString(),n=a.QX.fromPhrase(e.mnemonic),s=await n.signMessage(t);localStorage.token=[e.address,t,s].join(".")},w={avatar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,i.gn)(o,{seed:"most.box@"+e,flip:!0,backgroundType:["gradientLinear"]}).toDataUri()},avatarCID:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,i.gn)(c,{seed:"most.box#"+e,flip:!0,backgroundType:["gradientLinear","solid"]}).toDataUri()},formatTime:e=>{let t;if(!e)return"";let n=h()(Number(e)),s=n.hour();return t=s>=0&&s<3?"凌晨":s>=3&&s<6?"拂晓":s>=6&&s<9?"早晨":s>=9&&s<12?"上午":s>=12&&s<15?"下午":s>=15&&s<18?"傍晚":s>=18&&s<21?"薄暮":"深夜",n.format("YYYY年M月D日 ".concat(t,"h点m分"))},formatDate:e=>{let t=h()(Number(e)),n=h()();return t.isSame(n,"day")?t.format("HH:mm"):t.isSame(n.subtract(1,"day"),"day")?"昨天 ".concat(t.format("HH:mm")):t.isoWeek()===n.isoWeek()?"".concat(["周日","周一","周二","周三","周四","周五","周六"][t.day()]," ").concat(t.format("HH:mm")):t.year()===n.year()?t.format("M月D日"):t.format("YY年M月D日")},formatAddress:e=>e?e.slice(0,6)+"..."+e.slice(-4):"",enBase64:e=>(0,s.W)((0,r.YW)(e)),deBase64:e=>(0,r._v)((0,s.y)(e)),createJWT:p,verifyJWT:b,login:(e,t)=>{try{var n;let s=(0,d.BP)(e,t,"I know loss mnemonic will lose my wallet."),{jwt:r,jwtSecret:a}=p(s);if((null==(n=b(r,a))?void 0:n.address)===s.address)return localStorage.setItem("jwt",r),localStorage.setItem("jwtSecret",a),k(s),s}catch(e){console.log("登录失败:",e)}return null},ZeroAddress:l.j,createToken:k,pinyin:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(t.length<n)return!1;if(e.toLowerCase().includes(t.toLowerCase()))return!0;let s=(0,m.YW)(e,t,{continuous:!0});return!!s&&!!(s.length>=n)}}},29439:()=>{},48764:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});var s=n(9482),r=n(65453),a=n(54205),l=n(6942);let i=(0,r.v)((e,t)=>({wallet:void 0,initWallet(){let n=localStorage.getItem("jwt"),r=localStorage.getItem("jwtSecret");if(n&&r){let a=s.A.verifyJWT(n,r);a?(s.A.createToken(a),e({wallet:a})):t().exit()}},async updateDot(t){let n=new URL(t).origin;try{let t=(await a.FH.get(n+"/api.dot",{timeout:3e3})).data;a.FH.defaults.baseURL=n,e({dotAPI:n}),localStorage.setItem("dotAPI",n);let s=t.CIDs[0];return n.endsWith(":1976")&&(s=n.slice(0,-5)+":8080"),s&&(e({dotCID:s}),localStorage.setItem("dotCID",s)),t.APIs}catch(t){l.notifications.show({title:"节点切换失败",message:n,color:"red"}),console.error(t),e({dotAPI:a.FH.defaults.baseURL||""})}return null},setItem:(t,n)=>e(e=>({...e,[t]:n})),firstPath:"",dotAPI:a.MN,dotCID:a.AF,dotNodes:[],exit(){e({wallet:void 0}),localStorage.removeItem("jwt"),localStorage.removeItem("jwtSecret"),localStorage.removeItem("token")},notes:[]}))},54205:(e,t,n)=>{"use strict";n.d(t,{AF:()=>a,C2:()=>l,FH:()=>i,MN:()=>r});var s=n(23464);let r="https://dot.most.red",a="https://cid.most.red",l="https://most.box/auth/callback",i=s.A.create({baseURL:r});i.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e},e=>Promise.reject(e))},71281:()=>{},83572:()=>{},92826:(e,t,n)=>{Promise.resolve().then(n.bind(n,97913))},97237:()=>{},97913:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>B});var s=n(95155),r=n(12115),a=n(46647),l=n(58887),i=n(20042);n(29439);var o=n(6874),c=n.n(o),d=n(69604),m=n(70112),u=n(39926),h=n(81001),x=n(21220),g=n(6942),j=n(48764),f=n(9482);function p(){let e=(0,j.k)(e=>e.wallet),t=(null==e?void 0:e.address)||f.A.ZeroAddress,n=(0,j.k)(e=>e.exit);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Box,{className:"header",children:(0,s.jsxs)(m.Group,{wrap:"nowrap",children:[(0,s.jsx)(u.Avatar,{size:"md",radius:"sm",src:(null==e?void 0:e.address)?f.A.avatar(e.address):"/icons/pwa-512x512.png",alt:"it's me"}),(0,s.jsxs)(d.Box,{children:[(0,s.jsx)(l.Text,{size:"lg",fw:500,lineClamp:2,children:(null==e?void 0:e.username)||"Most.Box"}),(0,s.jsxs)(l.Text,{size:"sm",c:"dimmed",children:["地址: ",f.A.formatAddress(t)]})]}),(0,s.jsx)(h.ActionIcon,{ml:"auto",variant:"subtle",color:"gray",onClick:()=>g.notifications.show({title:"二维码",message:"开发中"}),children:(0,s.jsx)(i.I,{name:"QRCode",size:18})})]})}),(0,s.jsxs)(x.Stack,{className:"menu-list",mb:"xs",gap:0,children:[(0,s.jsx)(b,{icon:"Web3",label:"Web3",link:"/web3"}),(0,s.jsx)(b,{icon:"Earth",label:"节点",link:"/dot"})]}),(0,s.jsxs)(x.Stack,{className:"menu-list",gap:0,children:[(0,s.jsx)(b,{icon:"About",label:"关于",link:"/about"}),(0,s.jsx)(b,{icon:"Setting",label:"设置",link:"/setting"}),(0,s.jsx)(b,{icon:"Join",label:"志同道合",link:"/join"})]}),(0,s.jsx)(x.Stack,{className:"menu-list",mt:"xs",children:(0,s.jsx)(b,{icon:"Exit",label:e?"退出账户":"去登录",link:"/login",onClick:()=>{setTimeout(()=>{n()},1e3)}})})]})}function b(e){let{icon:t,label:n,link:r,onClick:a}=e;return(0,s.jsxs)(d.Box,{component:c(),href:r,className:"menu-item",onClick:a,children:[(0,s.jsxs)(m.Group,{children:[(0,s.jsx)(i.I,{name:t,size:32}),(0,s.jsx)(l.Text,{children:n})]}),(0,s.jsx)(i.I,{name:"Arrow",size:18})]})}let k=JSON.parse('["没有调查，就没有发言权","我为人人，人人为我","具体问题，具体分析","实践是检验真理的唯一标准","从最坏处着眼，往最好处努力","见微知著","读史以明志，鉴往而知来","爱的本质是付出","团结 紧张 严肃 活泼","出发就能到达","没说不行就是可以","真正的勇士敢于直面惨淡的人生和淋漓的鲜血","君子用人如器，各取所长","合抱之木，生于毫末","九层之台，起于累土","千里之行，始于足下","出发就能到达","人生的最高法则是什么:斗争","广厦千间，夜眠仅需六尺","家财万贯，日食不过三餐","碌碌百载，终归仅需寸土","芸芸众生，遍寻不过一人","把事情变简单","凡夫畏果，菩萨畏因","光灿烂时，星已死灭","聪明是一种天赋，而善良是一种选择","你打你的，我打我的","以斗争求和平则和平存，以妥协求和平则和平亡","抓住主要矛盾不放手"]');function w(){let[e,t]=(0,r.useState)("");return(0,r.useEffect)(()=>{let e=Math.floor(Math.random()*k.length);t(k[e])},[]),(0,s.jsx)(l.Text,{children:e})}n(97237),n(83572);var v=n(8141),y=n(26903),S=n(26029),T=n(8593),A=n(89047),I=n(18403),C=n(41698),N=n(54395),M=n(54205);function P(){let e=(0,j.k)(e=>e.wallet),t=(0,j.k)(e=>e.notes),n=(0,j.k)(e=>e.setItem),[a,i]=(0,r.useState)(!1),[o,d]=(0,r.useState)(""),[u,g]=(0,r.useState)(100),p=t.filter(e=>f.A.pinyin(e.name,o,0)),b=p.slice(0,u),k=p.length>u;(0,r.useEffect)(()=>{g(100)},[o]);let w=async()=>{try{i(!0);let e=(await M.FH.post("/files/.note")).data;if(e){let t=e.map(e=>({name:e.name,cid:e.cid["/"]}));n("notes",t)}}catch(e){console.error(e)}finally{i(!1)}};return((0,r.useEffect)(()=>{e&&0===t.length&&w()},[e]),e)?t.length?(0,s.jsxs)(x.Stack,{gap:"md",p:"md",className:"note-box",children:[(0,s.jsx)(m.Group,{justify:"space-between",align:"center",children:(0,s.jsxs)(S.Badge,{variant:"light",size:"lg",children:[o?"显示 ".concat(b.length," / ").concat(p.length," (总共 ").concat(t.length,")"):"显示 ".concat(b.length," / ").concat(t.length)," ","个笔记"]})}),(0,s.jsx)(v.Center,{children:(0,s.jsx)(T.TextInput,{placeholder:"搜索笔记名称...",value:o,onChange:e=>d(e.currentTarget.value),rightSection:o?(0,s.jsx)(N.A,{size:16,style:{cursor:"pointer"},onClick:()=>d("")}):null,size:"md",radius:"md",w:400,styles:{input:{textAlign:"center"}}})}),o&&0===p.length?(0,s.jsxs)(x.Stack,{align:"center",justify:"center",h:200,children:[(0,s.jsx)(l.Text,{size:"lg",c:"dimmed",children:"未找到笔记"}),(0,s.jsx)(l.Text,{size:"sm",c:"dimmed",children:"尝试用其他关键词搜索"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.Grid,{gutter:"md",children:b.map(t=>(0,s.jsx)(A.Grid.Col,{span:{base:12,xs:6,sm:4,md:3,lg:3,xl:2},children:(0,s.jsx)(I.Card,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,className:"note-card",component:c(),href:{pathname:"/note",hash:t.cid,query:{uid:e.address,name:t.name}},children:(0,s.jsx)(x.Stack,{justify:"space-between",h:"100%",children:(0,s.jsx)(l.Text,{fw:500,size:"sm",lineClamp:1,title:t.name,style:{wordBreak:"break-word",lineHeight:1.4},children:t.name})})})},t.name))}),k&&(0,s.jsx)(v.Center,{mt:"lg",children:(0,s.jsxs)(y.Button,{variant:"light",onClick:()=>{g(e=>e+100)},size:"md",children:["继续加载 (",p.length-u," 个剩余)"]})})]})]}):(0,s.jsxs)(x.Stack,{align:"center",justify:"center",h:200,children:[(0,s.jsx)(l.Text,{size:"lg",c:"dimmed",children:a?"正在加载":"暂无笔记"}),(0,s.jsx)(h.ActionIcon,{size:"lg",onClick:w,mt:"md",children:(0,s.jsx)(C.A,{size:18})})]}):(0,s.jsx)(v.Center,{children:(0,s.jsx)(y.Button,{variant:"gradient",component:c(),href:"/login",children:"去登录"})})}function z(){return(0,s.jsx)(l.Text,{children:"Explore tab content"})}function B(){let[e,t]=(0,r.useState)(null);return(0,r.useEffect)(()=>{t(localStorage.getItem("homeTab")||"disk")},[]),(0,s.jsxs)(a.Tabs,{id:"page-home",variant:"pills",radius:0,value:e,onChange:e=>{t(e),localStorage.setItem("homeTab",e||"disk")},children:[(0,s.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"disk",children:(0,s.jsx)(w,{})}),(0,s.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"note",children:(0,s.jsx)(P,{})}),(0,s.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"explore",children:(0,s.jsx)(z,{})}),(0,s.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"mine",children:(0,s.jsx)(p,{})}),(0,s.jsxs)(a.Tabs.List,{children:[(0,s.jsxs)(a.Tabs.Tab,{value:"disk",children:[(0,s.jsx)(i.I,{name:"disk"===e?"ChatActive":"Chat"}),(0,s.jsx)(l.Text,{children:"网盘"})]}),(0,s.jsxs)(a.Tabs.Tab,{value:"note",children:[(0,s.jsx)(i.I,{name:"note"===e?"NoteActive":"Note"}),(0,s.jsx)(l.Text,{children:"笔记"})]}),(0,s.jsxs)(a.Tabs.Tab,{value:"explore",children:[(0,s.jsx)(i.I,{name:"explore"===e?"ExploreActive":"Explore"}),(0,s.jsx)(l.Text,{children:"探索"})]}),(0,s.jsxs)(a.Tabs.Tab,{value:"mine",children:[(0,s.jsx)(i.I,{name:"mine"===e?"MineActive":"Mine"}),(0,s.jsx)(l.Text,{children:"我的"})]})]})]})}n(6396)}},e=>{e.O(0,[663,8198,8887,9549,4291,8805,4853,2598,8694,3464,6874,8925,2107,4607,42,8441,5881,7358],()=>e(e.s=92826)),_N_E=e.O()}]);