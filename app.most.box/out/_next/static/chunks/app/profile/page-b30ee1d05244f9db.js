(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6636],{13297:(e,t,a)=>{"use strict";a.d(t,{k:()=>o});var n=a(97443),s=a(25959),i=a(21794),r=a(59126);let o=(0,s.v)((e,t)=>({wallet:void 0,initWallet(a){e({fingerprint:a});let s=localStorage.getItem("jwt");if(s)try{let t=n.A.verifyJWT(s);t&&(n.A.createToken(t),e({wallet:t}))}catch(e){r.notifications.show({message:"登录过期",color:"red"}),console.warn("登录过期",e),t().exit()}},async updateDot(t){try{let a=new URL(t).origin,n=(await i.FH.get("/api.dot",{baseURL:a})).data;i.FH.defaults.baseURL=a,e({dotAPI:a}),localStorage.setItem("dotAPI",a);let s=n.CIDs[0];return a.endsWith(":1976")&&(s=a.slice(0,-5)+":8080"),s&&(e({dotCID:s}),localStorage.setItem("dotCID",s)),e({notes:void 0,files:void 0}),n.APIs}catch(t){console.info(t),e({dotAPI:i.FH.defaults.baseURL||""})}return null},setItem:(t,a)=>e(e=>({...e,[t]:a})),firstPath:"",dotAPI:"",dotCID:"",dotNodes:[],notes:void 0,notesQuery:"",nodeDark:"",files:void 0,filesPath:"",fingerprint:"",exit(){e({wallet:void 0,notes:void 0,files:void 0}),localStorage.removeItem("jwt"),localStorage.removeItem("token")}}))},21794:(e,t,a)=>{"use strict";a.d(t,{C2:()=>s,FH:()=>i});var n=a(95125);let s="https://most.box/auth/callback",i=n.A.create({baseURL:""});i.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>Promise.reject(e))},24695:(e,t,a)=>{Promise.resolve().then(a.bind(a,44345))},44345:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var n=a(95155),s=a(90101),i=a(5480),r=a(67661),o=a(77147),l=a(12115),c=a(70305),d=a(2369),u=a(17998),m=a(60688),p=a(96778),f=a(13877),h=a(53987),g=a(13297),y=a(81216),w=a(41524),b=a(38798),v=a(59126),x=a(90982),j=a(52619),M=a.n(j),T=a(97443),k=a(99682),S=a(54047);let P=()=>{let e=(0,g.k)(e=>e.wallet),[t,a]=(0,l.useState)(""),[s,f]=(0,l.useState)(""),[j,k]=(0,l.useState)(!1),[P,A]=(0,l.useState)(!1),[D,I]=(0,l.useState)(!1),N=h.WC.mainnet.rpc,B=(0,l.useMemo)(()=>new y.FR(N),[N]),C=(0,l.useMemo)(()=>new w.NZ(h.i5,h.yc,B),[B]),G=async()=>{if(e)try{k(!0);let t=await C.getName(e.address);a(t),!s&&t&&f(t)}catch(e){console.warn("获取用户名失败",e)}finally{k(!1)}};(0,l.useEffect)(()=>{G()},[e]);let E=()=>{try{if(null==e?void 0:e.mnemonic){let t=b.QX.fromPhrase(e.mnemonic).connect(B);return new w.NZ(h.i5,h.yc,t)}}catch(e){console.warn("获取签名器失败",e)}return null},W=async()=>{if(!e)return v.notifications.show({message:"请先登录",color:"red"});let t=s.trim();if(!t)return v.notifications.show({message:"请输入用户名",color:"yellow"});if(t.length<1)return v.notifications.show({message:"用户名太短（至少1个字符）",color:"yellow"});if(t.length>32)return v.notifications.show({message:"用户名太长（最多32个字符）",color:"yellow"});let n=E();if(!n)return void v.notifications.show({message:"未检测到可用钱包，无法发起交易。请安装钱包或使用助记词登录。",color:"red"});try{var i;A(!0);let[s,r]=await Promise.all([B.getBalance(e.address),B.getFeeData()]),o=null!=(i=r.maxFeePerGas)?i:r.gasPrice;if(o){let e=0n;try{e=await n.estimateGas.setName(t)}catch(e){}if(e>0n){let t=e*o;if(s<t)throw v.notifications.show({message:"余额不足以支付 Gas，请先充值",color:"red"}),Error("余额不足以支付 Gas，请先充值")}}let l=await n.setName(t);v.notifications.show({message:"交易已提交，等待确认…",color:"blue"}),await l.wait(),v.notifications.show({message:"设置成功",color:"green"}),a(t),G()}catch(e){console.warn(e),v.notifications.show({message:(null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||"设置失败",color:"red"})}finally{A(!1)}},Y=async()=>{if(!e)return v.notifications.show({message:"请先登录",color:"red"});if(!t)return v.notifications.show({message:"当前未设置用户名",color:"yellow"});let n=E();if(!n)return void v.notifications.show({message:"未检测到可用钱包，无法发起交易。请安装钱包或使用助记词登录。",color:"red"});try{var s;I(!0);let[t,i]=await Promise.all([B.getBalance(e.address),B.getFeeData()]),r=null!=(s=i.maxFeePerGas)?s:i.gasPrice;if(r){let e=0n;try{e=await n.estimateGas.deleteName()}catch(e){}if(e>0n){let a=e*r;if(t<a)throw v.notifications.show({message:"余额不足以支付 Gas，请先充值",color:"red"}),Error("余额不足以支付 Gas，请先充值")}}let o=await n.deleteName();v.notifications.show({message:"交易已提交，等待确认…",color:"blue"}),await o.wait(),v.notifications.show({message:"删除成功",color:"green"}),a(""),f(""),G()}catch(e){console.warn(e),v.notifications.show({message:(null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||"删除失败",color:"red"})}finally{I(!1)}};return(0,n.jsxs)(d.Stack,{children:[(0,n.jsx)(i.Avatar,{size:100,radius:"lg",src:(null==e?void 0:e.address)?T.A.avatar(e.address):"/icons/pwa-512x512.png",alt:"头像",style:{boxShadow:"0 8px 32px rgba(0, 0, 0, 0.2)"}}),(0,n.jsx)(c.Text,{children:(null==e?void 0:e.address)||T.A.ZeroAddress}),(0,n.jsxs)(r.Group,{align:"center",gap:"xs",children:[(0,n.jsx)(c.Text,{children:"用户名"}),j?(0,n.jsx)(u.Badge,{variant:"light",color:"gray",children:"加载中"}):t?(0,n.jsx)(u.Badge,{style:{cursor:"pointer"},variant:"light",color:"blue",children:t}):(0,n.jsx)(u.Badge,{variant:"light",color:"gray",children:"未设置"})]}),(0,n.jsx)(m.TextInput,{description:"链上唯一，可修改或删除",leftSection:(0,n.jsx)(S.A,{size:16}),variant:"filled",placeholder:"请输入新用户名",value:s,onChange:e=>f(e.currentTarget.value),maxLength:32,disabled:P||D}),(0,n.jsxs)(r.Group,{children:[(0,n.jsx)(p.Button,{loading:P,onClick:()=>{x.modals.openConfirmModal({centered:!0,title:"确认操作",children:(0,n.jsx)(c.Text,{c:"dimmed",children:"是否继续保存用户名？"}),labels:{confirm:"继续",cancel:"取消"},onConfirm:W})},disabled:!s||!e||t===s,size:"sm",children:"上链"}),(0,n.jsx)(p.Button,{variant:"light",loading:D,onClick:()=>{x.modals.openConfirmModal({centered:!0,title:"确认操作",children:(0,n.jsx)(c.Text,{c:"dimmed",children:"是否继续删除用户名？"}),labels:{confirm:"继续",cancel:"取消"},onConfirm:Y})},disabled:!e||!t,size:"sm",children:"删除"})]}),t&&(0,n.jsxs)(o.Anchor,{size:"sm",c:"blue",component:M(),href:"/@"+t,target:"_blank",children:["个人主页 /@",t]})]})},A=()=>{let e=(0,g.k)(e=>e.wallet),t=(0,g.k)(e=>e.dotAPI),[a,s]=(0,l.useState)(!1),[i,o]=(0,l.useState)(!1),[u,f]=(0,l.useState)(""),x=h.WC.mainnet.rpc,j=(0,l.useMemo)(()=>new y.FR(x),[x]),T=(0,l.useMemo)(()=>new w.NZ(h.i5,h.yc,j),[j]),S=()=>{try{if(null==e?void 0:e.mnemonic){let t=b.QX.fromPhrase(e.mnemonic).connect(j);return new w.NZ(h.i5,h.yc,t)}}catch(e){console.warn("获取签名器失败",e)}return null},P=async()=>{if(e)try{let t=await T.getData(e.address);f(t||"")}catch(e){console.warn("获取用户数据失败",e)}};(0,l.useEffect)(()=>{P()},[e]);let A=(0,l.useMemo)(()=>{if(!u)return"";try{let e=JSON.parse(u);if(null==e?void 0:e.dot)return e.dot}catch(e){}return""},[u]),D=async()=>{if(!e)return v.notifications.show({message:"请先登录",color:"red"});let a=S();if(!a)return void v.notifications.show({message:"未检测到可用钱包，无法发起交易。请安装钱包或使用助记词登录。",color:"red"});let n=JSON.stringify({dot:t});try{var i;s(!0);let[t,r]=await Promise.all([j.getBalance(e.address),j.getFeeData()]),o=null!=(i=r.maxFeePerGas)?i:r.gasPrice;if(o){let e=0n;try{e=await a.estimateGas.setData(n)}catch(e){}if(e>0n){let a=e*o;if(t<a)throw v.notifications.show({message:"余额不足以支付 Gas，请先充值",color:"red"}),Error("余额不足以支付 Gas，请先充值")}}let l=await a.setData(n);v.notifications.show({message:"交易已提交，等待确认…",color:"blue"}),await l.wait(),v.notifications.show({message:"设置成功",color:"green"}),f(n)}catch(e){console.warn(e),v.notifications.show({message:(null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||"设置失败",color:"red"})}finally{s(!1)}},I=async()=>{if(!e)return v.notifications.show({message:"请先登录",color:"red"});if(!A)return v.notifications.show({message:"当前未设置节点",color:"yellow"});let t=S();if(!t)return void v.notifications.show({message:"未检测到可用钱包，无法发起交易。请安装钱包或使用助记词登录。",color:"red"});try{var a;o(!0);let[n,s]=await Promise.all([j.getBalance(e.address),j.getFeeData()]),i=null!=(a=s.maxFeePerGas)?a:s.gasPrice;if(i){let e=0n;try{e=await t.estimateGas.deleteData()}catch(e){}if(e>0n){let t=e*i;if(n<t)throw v.notifications.show({message:"余额不足以支付 Gas，请先充值",color:"red"}),Error("余额不足以支付 Gas，请先充值")}}let r=await t.deleteData();v.notifications.show({message:"交易已提交，等待确认…",color:"blue"}),await r.wait(),v.notifications.show({message:"删除成功",color:"green"}),f("")}catch(e){console.warn(e),v.notifications.show({message:(null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||"删除失败",color:"red"})}finally{o(!1)}};return(0,n.jsxs)(d.Stack,{children:[(0,n.jsx)(c.Text,{children:"用户数据"}),(0,n.jsx)(m.TextInput,{description:"默认节点，个人主页使用该节点查询数据",leftSection:(0,n.jsx)(k.I,{name:"Earth",size:16}),variant:"filled",placeholder:"请设置默认节点",value:A,disabled:!0}),(0,n.jsxs)(r.Group,{align:"flex-end",children:[(0,n.jsx)(m.TextInput,{flex:1,description:"当前节点",leftSection:(0,n.jsx)(k.I,{name:"Earth",size:16}),variant:"filled",value:t,readOnly:!0}),(0,n.jsx)(p.Button,{component:M(),href:"/dot/?back",children:"切换节点"})]}),(0,n.jsxs)(r.Group,{children:[(0,n.jsx)(p.Button,{size:"sm",loading:a,onClick:D,disabled:!e||!t||A===t,children:"上链"}),(0,n.jsx)(p.Button,{variant:"light",size:"sm",loading:i,onClick:I,disabled:!e||!A,children:"删除"})]})]})};function D(){let e=h.WC.mainnet.explorer;return(0,n.jsxs)(f.Container,{p:"md",w:"100%",children:[(0,n.jsx)(s.AppHeader,{title:"个人资料"}),(0,n.jsxs)(d.Stack,{children:[(0,n.jsx)(P,{}),(0,n.jsx)(A,{}),(0,n.jsx)(r.Group,{children:(0,n.jsxs)(o.Anchor,{size:"sm",c:"blue",component:M(),href:e+"/address/"+h.i5,target:"_blank",children:["合约地址 ",T.A.formatAddress(h.i5)]})})]})]})}},53987:(e,t,a)=>{"use strict";a.d(t,{Wf:()=>c,yc:()=>d,MT:()=>i,i5:()=>r,WC:()=>l,Pt:()=>o});let n=JSON.parse('[{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"Data","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_DATA_LENGTH","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_NAME_LENGTH","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_NAME_LENGTH","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"deleteData","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"deleteName","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_address","type":"address"}],"name":"getData","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_address","type":"address"}],"name":"getName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_name","type":"string"}],"name":"getOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"nameOwners","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"names","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_data","type":"string"}],"name":"setData","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_newName","type":"string"}],"name":"setName","outputs":[],"stateMutability":"nonpayable","type":"function"}]'),s=["https://base.llamarpc.com","https://mainnet.base.org","https://developer-access-mainnet.base.org","https://base-mainnet.diamondswap.org/rpc","https://base.public.blockpi.network/v1/rpc/public","https://1rpc.io/base","https://base-pokt.nodies.app","https://base.meowrpc.com","https://base-mainnet.public.blastapi.io","https://base.gateway.tenderly.co","https://gateway.tenderly.co/public/base","https://rpc.notadegen.com/base","https://base-rpc.publicnode.com","https://base.drpc.org","https://base.api.onfinality.io/public","https://public.stackup.sh/api/v1/node/base-mainnet","https://base-mainnet.gateway.tatum.io","https://base.rpc.subquery.network/public","https://api.zan.top/base-mainnet","https://endpoints.omniatech.io/v1/base/mainnet/public","https://base.lava.build","https://rpc.numa.network/base","https://node.histori.xyz/base-mainnet/8ry9f6t9dct1se2hlagxnd9n2a","https://0xrpc.io/base","https://rpc.owlracle.info/base/70d38ce1826c4a60bb2a8e05a6c8b20f","https://base.therpc.io"],i="0xB67662F0d2BB106B055503062e1dba4f072f5781",r="0x1bcB1bD1c669e154c1d69D7c7C2Ab5D19C9109DB",o=()=>s[Math.floor(Math.random()*s.length)],l={mainnet:{chainId:8453,rpc:"https://mainnet.base.org",name:"Base 主网",color:"blue",explorer:"https://basescan.org"},testnet:{chainId:84532,rpc:"https://sepolia.base.org",name:"Base 测试网",color:"orange",explorer:"https://sepolia.basescan.org"}},c=[{inputs:[],name:"getAllDots",outputs:[{internalType:"address[]",name:"addresses",type:"address[]"},{internalType:"string[]",name:"names",type:"string[]"},{internalType:"string[][]",name:"APIss",type:"string[][]"},{internalType:"string[][]",name:"CIDss",type:"string[][]"},{internalType:"uint256[]",name:"updates",type:"uint256[]"}],stateMutability:"view",type:"function"}],d=n},56612:(e,t,a)=>{"use strict";a.d(t,{BP:()=>m,OM:()=>f,yO:()=>p});var n=a(68110),s=a(330),i=a(16405),r=a(42779),o=a(10179),l=a(38798),c=a(43591),d=a(28555),u=a.n(d);let m=(e,t,a)=>{let c=(0,n.YW)(t),d=(0,n.YW)("/most.box/"+e),m=(0,s.A)(c,d,3,32,"sha512"),p=(0,i.q5)((0,r.s)(m)),f=p.slice(0,32),h=u().box.keyPair.fromSecretKey(f),g=(0,i.c$)(h.publicKey),y=(0,i.c$)(h.secretKey),w=u().sign.keyPair.fromSeed(f),b=(0,i.c$)(w.publicKey),v=o.v.entropyToPhrase(p);return{username:e,address:l.QX.fromPhrase(v).address,public_key:g,private_key:y,mnemonic:"I know loss mnemonic will lose my wallet."===a?v:"",ed_public_key:b}},p=(e,t,a)=>{let n=new TextEncoder().encode(e),s=u().randomBytes(u().box.nonceLength),r=u().box(n,s,new Uint8Array((0,i.q5)(t)),new Uint8Array((0,i.q5)(a)));return r?["mp://2",(0,c.W)(s),(0,c.W)(r)].join("."):(console.info("加密失败"),"")},f=(e,t,a)=>{let[n,s,r]=e.split(".");if("mp://2"!==n)return console.info("无效协议"),"";let o=u().box.open((0,c.y)(r),(0,c.y)(s),new Uint8Array((0,i.q5)(t)),new Uint8Array((0,i.q5)(a)));return o?new TextDecoder().decode(o):(console.info("无法解密"),"")}},71281:()=>{},97443:(e,t,a)=>{"use strict";a.d(t,{A:()=>M});var n=a(43591),s=a(68110),i=a(38798),r=a(82127),o=a(34477),l=a(55544),c=a(85179),d=a(56612),u=a(86710),m=a(36117),p=a.n(m),f=a(44839),h=a.n(f);a(28223);var g=a(78595),y=a.n(g);p().extend(y()),p().extend(h()),p().locale("zh-cn");let w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYYMM",a=p()().isoWeek(),n=p()().format(t)+a,s=sessionStorage.getItem("fingerprint");if(!s)throw Error("请先获取设备指纹");let i=[location.origin,s].join("/"),{public_key:r,private_key:o}=(0,d.BP)(n,i);return(0,d.yO)(JSON.stringify(e),r,o)},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYYMM",a=p()().isoWeek(),n=p()().format(t)+a,s=sessionStorage.getItem("fingerprint");if(!s)throw Error("请先获取设备指纹");let i=[location.origin,s].join("/"),{public_key:r,private_key:o}=(0,d.BP)(n,i),l=(0,d.OM)(e,r,o);if(!l)throw Error("jwt 解析失败");let c=JSON.parse(l);if(!c.address)throw Error("jwt json 解析失败");return c},v=async e=>{let t=Date.now().toString(),a=i.QX.fromPhrase(e.mnemonic),n=await a.signMessage(t);localStorage.token=[e.address,t,n].join(".")},x=e=>{try{var t;let a=w(e);if((null==(t=b(a))?void 0:t.address)===e.address)return localStorage.setItem("jwt",a),v(e),e}catch(e){console.log("登录失败:",e)}return null},j={avatar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,o.gn)(l,{seed:"most.box@"+e,flip:!0,backgroundType:["gradientLinear"]}).toDataUri()},avatarCID:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Most";return(0,o.gn)(c,{seed:"most.box#"+e,flip:!0,backgroundType:["gradientLinear","solid"]}).toDataUri()},formatTime:e=>{let t;if(!e)return"";let a=p()(Number(e)),n=a.hour();return t=n>=0&&n<3?"凌晨":n>=3&&n<6?"拂晓":n>=6&&n<9?"早晨":n>=9&&n<12?"上午":n>=12&&n<15?"下午":n>=15&&n<18?"傍晚":n>=18&&n<21?"薄暮":"深夜",a.format("YYYY年M月D日 ".concat(t,"h点m分"))},formatDate:e=>{let t=p()(Number(e)),a=p()();if(t.isSame(a,"minute"))return t.format("HH:mm:ss");if(t.isSame(a,"day"))return t.format("HH:mm");if(t.isSame(a.subtract(1,"day"),"day"))return"昨天 ".concat(t.format("HH:mm"));if(t.isoWeek()===a.isoWeek())return"".concat(["周日","周一","周二","周三","周四","周五","周六"][t.day()]," ").concat(t.format("HH:mm"));if(t.year()===a.year())return t.format("M月D日");else return t.format("YY年M月D日")},formatAddress:e=>e?e.slice(0,6)+"..."+e.slice(-4):"",enBase64:e=>(0,n.W)((0,s.YW)(e)),deBase64:e=>(0,s._v)((0,n.y)(e)),createJWT:w,verifyJWT:b,login:(e,t)=>x((0,d.BP)(e,t,"I know loss mnemonic will lose my wallet.")),loginSave:x,ZeroAddress:r.j,createToken:v,pinyin:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(t.length<a)return!1;if(e.toLowerCase().includes(t.toLowerCase()))return!0;let n=(0,u.YW)(e,t,{continuous:!0});return!!n&&!!(n.length>=a)},openDot:e=>{let t=new URL("/auth/jwt/",e),a=localStorage.getItem("jwt");if(a){let e=j.verifyJWT(a);if(e){let a=p()().format("YY/M/D HH:mm"),{public_key:n,private_key:s}=(0,d.BP)("auth/jwt",a),i=(0,d.yO)(JSON.stringify(e),n,s);t.searchParams.set("token",i)}}window.open(t.href)}},M=j}},e=>{e.O(0,[8198,2829,5619,6714,8555,8990,5125,9287,3252,8835,822,101,8441,1255,7358],()=>e(e.s=24695)),_N_E=e.O()}]);