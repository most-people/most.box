(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{1371:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});let i=(0,t(30313).A)("outline","refresh","Refresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]])},2186:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});let i=(0,t(30313).A)("outline","x","X",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]])},5941:()=>{},25959:(e,n,t)=>{"use strict";t.d(n,{v:()=>a});var i=t(12115);let l=e=>{let n,t=new Set,i=(e,i)=>{let l="function"==typeof e?e(n):e;if(!Object.is(l,n)){let e=n;n=(null!=i?i:"object"!=typeof l||null===l)?l:Object.assign({},n,l),t.forEach(t=>t(n,e))}},l=()=>n,r={setState:i,getState:l,getInitialState:()=>a,subscribe:e=>(t.add(e),()=>t.delete(e))},a=n=e(i,l,r);return r},r=e=>{let n=(e=>e?l(e):l)(e),t=e=>(function(e,n=e=>e){let t=i.useSyncExternalStore(e.subscribe,i.useCallback(()=>n(e.getState()),[e,n]),i.useCallback(()=>n(e.getInitialState()),[e,n]));return i.useDebugValue(t),t})(n,e);return Object.assign(t,n),t},a=e=>e?r(e):r},30313:(e,n,t)=>{"use strict";t.d(n,{A:()=>r});var i=t(12115),l={outline:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},filled:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none"}};let r=(e,n,t,r)=>{let a=(0,i.forwardRef)((t,a)=>{let{color:s="currentColor",size:o=24,stroke:c=2,title:d,className:u,children:h,...x}=t;return(0,i.createElement)("svg",{ref:a,...l[e],width:o,height:o,className:["tabler-icon","tabler-icon-".concat(n),u].join(" "),..."filled"===e?{fill:s}:{strokeWidth:c,stroke:s},...x},[d&&(0,i.createElement)("title",{key:"svg-title"},d),...r.map(e=>{let[n,t]=e;return(0,i.createElement)(n,t)}),...Array.isArray(h)?h:[h]])});return a.displayName="".concat(t),a}},38639:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});let i="IPv6 (Internet Protocol version 6) 是下一代互联网的核心协议，旨在解决 IPv4 地址枯竭问题并提升网络性能。\r\n\r\n**核心功能：每个设备可拥有全球唯一公网 IP，消除对 NAT 的依赖，回归端到端通信。**\r\n\r\n- IPv4 的 32 位地址（约 43 亿个）已耗尽。IPv6 采用 128 位地址，提供近乎无限的地址空间，满足物联网、5G 等海量设备连接需求。\r\n\r\n- [test-ipv6.com](https://test-ipv6.com) | [itdog.cn](https://www.itdog.cn/localhost/) | [ipw.cn](https://ipw.cn) | [test6.ustc.edu.cn](https://test6.ustc.edu.cn) 可以测试当前网络是否支持 IPv6\r\n"},41487:()=>{},43299:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>ee});var i=t(95155),l=t(12115),r=t(58380),a=t(45766),s=t(70305),o=t(99682);t(5941);var c=t(52619),d=t.n(c),u=t(67623),h=t(67661),x=t(5480),m=t(2369),p=t(13297),j=t(97443);function f(){let e=(0,p.k)(e=>e.wallet),n=(null==e?void 0:e.address)||j.A.ZeroAddress,t=(0,p.k)(e=>e.exit);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Box,{className:"header",children:(0,i.jsxs)(h.Group,{wrap:"nowrap",children:[(0,i.jsx)(x.Avatar,{component:d(),href:"/profile",size:"md",radius:"sm",src:(null==e?void 0:e.address)?j.A.avatar(e.address):"/icons/pwa-512x512.png",alt:"it's me"}),(0,i.jsxs)(u.Box,{children:[(0,i.jsx)(s.Text,{size:"lg",fw:500,lineClamp:2,children:(null==e?void 0:e.username)||"Most.Box"}),(0,i.jsxs)(s.Text,{size:"sm",c:"dimmed",component:d(),href:"/profile",children:["地址: ",j.A.formatAddress(n)]})]}),(0,i.jsx)(r.ActionIcon,{ml:"auto",variant:"subtle",color:"gray",component:d(),href:{pathname:"/card",query:{uid:n}},children:(0,i.jsx)(o.I,{name:"QRCode",size:18})})]})}),(0,i.jsxs)(m.Stack,{className:"menu-list",mb:"xs",gap:0,children:[(0,i.jsx)(g,{icon:"Web3",label:"Web3",link:"/web3"}),(0,i.jsx)(g,{icon:"Website",label:"个人主页",link:"/@".concat(n)}),(0,i.jsx)(g,{icon:"Earth",label:"节点",link:"/dot"}),(0,i.jsx)(g,{icon:"Chat",label:"聊天",link:"/chat/?id=001"})]}),(0,i.jsxs)(m.Stack,{className:"menu-list",gap:0,children:[(0,i.jsx)(g,{icon:"About",label:"关于",link:"/about"}),(0,i.jsx)(g,{icon:"Setting",label:"设置",link:"/setting"}),(0,i.jsx)(g,{icon:"Join",label:"志同道合",link:"/join"})]}),(0,i.jsx)(m.Stack,{className:"menu-list",mt:"xs",children:(0,i.jsx)(g,{icon:"Exit",label:e?"退出账户":"去登录",link:"/login",onClick:()=>{e&&t()}})})]})}function g(e){let{icon:n,label:t,link:l,onClick:r}=e;return(0,i.jsxs)(u.Box,{component:d(),href:l,className:"menu-item",onClick:r,children:[(0,i.jsxs)(h.Group,{children:[(0,i.jsx)(o.I,{name:n,size:32}),(0,i.jsx)(s.Text,{children:t})]}),(0,i.jsx)(o.I,{name:"Arrow",size:18})]})}var w=t(40387),v=t(60688),y=t(18244),k=t(17998),C=t(9457),b=t(44634),D=t(64153),I=t(77147),S=t(33864),M=t(85784),T=t(96778),A=t(90632),P=t(18845),z=t(21794);t(54216);var B=t(1371),F=t(30313);let E=(0,F.A)("outline","plus","Plus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),G=(0,F.A)("outline","folder-plus","FolderPlus",[["path",{d:"M12 19h-7a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v3.5",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}]]),N=(0,F.A)("outline","dots-vertical","DotsVertical",[["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]);var O=t(2186),R=t(59126);let H=[".note"];function L(){let e=(0,p.k)(e=>e.wallet),n=(0,p.k)(e=>e.dotCID),t=(0,p.k)(e=>e.files),a=(0,p.k)(e=>e.filesPath),o=(0,p.k)(e=>e.setItem),[c,u]=(0,l.useState)(!1),[x,f]=(0,l.useState)(!1),[g,F]=(0,l.useState)([]),[L,_]=(0,l.useState)(!1),[q,V]=(0,l.useState)(""),[W,K]=(0,l.useState)(100),[Q,U]=(0,l.useState)(!1),[$,J]=(0,l.useState)(null),[X,Z]=(0,l.useState)(""),[Y,ee]=(0,l.useState)(""),[en,et]=(0,l.useState)(!1),[ei,el]=(0,l.useState)(!1),[er,ea]=(0,l.useState)(""),[es,eo]=(0,l.useState)(!1),ec=(0,l.useRef)(null),ed=(0,l.useRef)(null),eu=async e=>{try{u(!0);let n=await z.FH.post("/files/".concat(e));V(""),o("files",n.data)}catch(e){console.info(e)}finally{u(!1)}},eh=async()=>{if(!er)return void R.notifications.show({title:"提示",message:"文件夹名称不能为空",color:"red"});if(null==t?void 0:t.some(e=>"directory"===e.type&&e.name===er))return void R.notifications.show({title:"提示",message:"文件夹已存在",color:"red"});try{eo(!0);let e=a?"".concat(a,"/").concat(er):er,n=new Blob(["MOST.BOX"],{type:"text/plain"}),t=new FormData;t.append("file",n,"hello.txt"),t.append("path","".concat(e,"/hello.txt")),await z.FH.put("/files.upload",t),R.notifications.show({message:"文件夹创建成功",color:"green"}),await eu(a),el(!1),ea("")}catch(e){console.info(e),R.notifications.show({message:e.message,color:"red"})}finally{eo(!1)}},ex=e=>{if(0===e)return"0 B";let n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(2))+" "+["B","KB","MB","GB"][n]},em=t?t.filter(e=>j.A.pinyin(e.name,q,0)).sort((e,n)=>"directory"===e.type&&"directory"!==n.type?-1:+("directory"!==e.type&&"directory"===n.type)):[],ep=em.slice(0,W),ej=em.length>W;(0,l.useEffect)(()=>{K(100)},[q]);let ef=async e=>{var n,t;if(!e||0===e.length)return;f(!0);let i=R.notifications.show({title:"上传中",message:"请稍后...",color:"blue",autoClose:!1});try{for(let t=0;t<e.length;t++){let l=e[t],r=new FormData;r.append("file",l);let s=l.webkitRelativePath,o=a?"".concat(a,"/").concat(s):s;r.append("path",o+l.name),(null==(n=(await z.FH.put("/files.upload",r)).data)?void 0:n.cid)&&R.notifications.update({id:i,title:"上传中",message:"".concat(l.name," 上传成功")})}R.notifications.update({id:i,title:"上传完成",message:"共上传 ".concat(e.length," 个文件"),color:"green",autoClose:!0}),await eu(a),_(!1),F([])}catch(n){let e=(null==n||null==(t=n.response)?void 0:t.data)||"文件上传失败，请重试";e.includes("already has")&&(e="文件已存在"),R.notifications.update({id:i,title:"上传失败",message:e,color:"red",autoClose:!0})}finally{f(!1)}},eg=e=>{let n=e.target.files;if(n&&n.length>0){let e=Array.from(n);1!==e.length||e[0].webkitRelativePath?(F(e.map(e=>({file:e,path:e.webkitRelativePath||e.name,size:ex(e.size)}))),_(!0)):ef(e)}e.target.value=""},ew=()=>{_(!1),F([])},ev=async e=>{try{let n=a?"".concat(a,"/").concat(e):e;await z.FH.delete("/files/".concat(n)),R.notifications.show({title:"删除成功",message:"文件 ".concat(e," 已删除"),color:"green"}),await eu(a)}catch(n){console.error("删除失败:",n),R.notifications.show({title:"删除失败",message:"删除文件 ".concat(e," 失败，请重试"),color:"red"})}},ey=async()=>{let e=e=>(e||"").replace(/^\/+|\/+$/g,"");if(!$||!X.trim())return void U(!1);let n=a?"".concat(a,"/").concat($.name):$.name,t=e(Y||""),i=t?"".concat(t,"/").concat(X.trim()):X.trim();if(e(n)===e(i))return void U(!1);et(!0);try{await z.FH.put("/files.rename",{oldName:"/".concat(e(n)),newName:"/".concat(e(i))}),R.notifications.show({title:"重命名成功",message:'新路径名称 "'.concat(e(i),'"'),color:"green"}),await eu(a),U(!1),J(null),Z(""),ee("")}catch(e){console.error("重命名失败:",e),R.notifications.show({title:"重命名失败",message:'重命名文件 "'.concat($.name,'" 失败，请重试'),color:"red"})}finally{et(!1)}},ek=e=>{let n=a?"".concat(a,"/").concat(e):e;o("filesPath",n),eu(n)},eC=e=>{let n=(a||"").split("/").filter(Boolean);if(e<0){o("filesPath",""),eu("");return}let t=n.slice(0,e+1).join("/");o("filesPath",t),eu(t)};(0,l.useEffect)(()=>{e&&!t&&eu(a)},[e,t]);let eb=e=>(e||"").replace(/^\/+|\/+$/g,""),eD=$?eb(a?"".concat(a,"/").concat($.name):$.name):"",eI=eb(((Y?"".concat(Y,"/"):"")+X).trim());return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(m.Stack,{gap:"md",p:"md",children:[(0,i.jsx)(w.Center,{children:(0,i.jsx)(v.TextInput,{placeholder:"搜索文件名称",value:q,onChange:e=>V(e.currentTarget.value),size:"md",radius:"md",w:400,styles:{input:{textAlign:"center"}}})}),(0,i.jsxs)(h.Group,{justify:"space-between",align:"center",pos:"relative",children:[(0,i.jsx)(y.LoadingOverlay,{visible:c,overlayProps:{backgroundOpacity:0},loaderProps:{type:"dots"}}),(0,i.jsxs)(k.Badge,{variant:"light",size:"lg",children:[q?"显示 ".concat(ep.length," / ").concat(em.length," (总共 ").concat((null==t?void 0:t.length)||0,")"):"显示 ".concat(ep.length," / ").concat((null==t?void 0:t.length)||0)," ","个文件"]}),(0,i.jsxs)(h.Group,{children:[(0,i.jsx)(C.Tooltip,{label:"刷新",children:(0,i.jsx)(r.ActionIcon,{size:"lg",onClick:()=>eu(a),color:"blue",disabled:!e,children:(0,i.jsx)(B.A,{size:18})})}),(0,i.jsx)(C.Tooltip,{label:"上传文件",children:(0,i.jsx)(r.ActionIcon,{size:"lg",onClick:()=>{var e;null==(e=ec.current)||e.click()},color:"green",disabled:!e||x,children:(0,i.jsx)(E,{size:18})})}),(0,i.jsx)(C.Tooltip,{label:"上传文件夹",children:(0,i.jsx)(r.ActionIcon,{size:"lg",onClick:()=>{var e;null==(e=ed.current)||e.click()},color:"yellow",disabled:!e||x,children:(0,i.jsx)(G,{size:18})})})]})]}),q&&0===em.length?(0,i.jsxs)(m.Stack,{align:"center",justify:"center",h:200,children:[(0,i.jsx)(s.Text,{size:"lg",c:"dimmed",children:"未找到文件"}),(0,i.jsx)(s.Text,{size:"sm",c:"dimmed",children:"尝试用其他关键词搜索"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.Card,{radius:"md",withBorder:!0,children:(0,i.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:4,children:[(0,i.jsxs)(h.Group,{gap:8,wrap:"nowrap",children:[(0,i.jsx)(s.Text,{fw:500,children:"\uD83D\uDCC1"}),(0,i.jsxs)(D.Breadcrumbs,{separator:"›",children:[(0,i.jsx)(I.Anchor,{fw:500,onClick:()=>eC(-1),underline:"never",children:"根目录"}),(a||"").split("/").filter(Boolean).map((e,n)=>(0,i.jsx)(I.Anchor,{fw:500,onClick:()=>eC(n),underline:"never",children:e},n))]})]}),(0,i.jsxs)(S.Menu,{shadow:"md",children:[(0,i.jsx)(S.Menu.Target,{children:(0,i.jsx)(r.ActionIcon,{variant:"subtle",color:"gray",children:(0,i.jsx)(N,{size:14})})}),(0,i.jsx)(S.Menu.Dropdown,{children:(0,i.jsx)(S.Menu.Item,{onClick:()=>el(!0),leftSection:"\uD83D\uDCC1",disabled:!e,children:"新建文件夹"})})]})]})}),(0,i.jsxs)(M.Grid,{gutter:"md",pos:"relative",children:[(0,i.jsx)(y.LoadingOverlay,{visible:c,overlayProps:{backgroundOpacity:0},loaderProps:{opacity:0}}),ep.map((e,t)=>(0,i.jsx)(M.Grid.Col,{span:{base:12,xs:6,sm:4,md:3,lg:3,xl:2},children:(0,i.jsx)(b.Card,{radius:"md",withBorder:!0,children:(0,i.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:4,children:[(0,i.jsx)(m.Stack,{flex:1,style:{cursor:"directory"===e.type?"pointer":""},onClick:()=>{"directory"===e.type&&ek(e.name)},children:(0,i.jsxs)(s.Text,{fw:500,lineClamp:1,children:["directory"===e.type?"\uD83D\uDCC1":"\uD83D\uDCC4"," ",e.name]})}),(0,i.jsxs)(S.Menu,{shadow:"md",width:120,children:[(0,i.jsx)(S.Menu.Target,{children:(0,i.jsx)(r.ActionIcon,{variant:"subtle",color:"gray",children:(0,i.jsx)(N,{size:14})})}),(0,i.jsxs)(S.Menu.Dropdown,{children:[(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCD6",onClick:()=>{if("directory"===e.type)ek(e.name);else{let t="".concat(n,"/ipfs/").concat(e.cid["/"],"?filename=").concat(e.name);window.open(t,"_blank")}},children:"directory"===e.type?"打开":"查看"}),(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCE4",onClick:()=>{let n=e.cid["/"],t=new URLSearchParams({filename:e.name});"directory"===e.type&&t.set("type","dir");let i="/ipfs/".concat(n,"/?").concat(t.toString());window.open(i)},children:"分享"}),(0,i.jsx)(S.Menu.Item,{leftSection:"✏️",onClick:()=>{J(e),Z(e.name),ee(a||""),U(!0)},children:"重命名"}),(0,i.jsx)(S.Menu.Divider,{}),(0,i.jsx)(S.Menu.Item,{leftSection:"⬇️",component:d(),target:"_blank",href:(e=>{let t=new URLSearchParams({download:"true",filename:e.name});return"directory"===e.type&&(t.set("format","tar"),t.set("filename","".concat(e.name,".tar"))),"".concat(n,"/ipfs/").concat(e.cid["/"],"?").concat(t.toString())})(e),children:"下载"}),(0,i.jsx)(S.Menu.Item,{disabled:""===a&&"directory"===e.type&&H.includes(e.name),leftSection:"\uD83D\uDDD1️",onClick:()=>{window.confirm('确定要删除文件 "'.concat(e.name,'" 吗？'))&&ev(e.name)},children:"删除"}),e.size>0&&(0,i.jsx)(S.Menu.Label,{children:(0,i.jsx)(w.Center,{children:(0,i.jsx)(s.Text,{size:"xs",c:"dimmed",children:ex(e.size)})})})]})]})]})})},t))]}),ej&&(0,i.jsx)(w.Center,{children:(0,i.jsxs)(T.Button,{variant:"light",onClick:()=>{K(e=>e+100)},size:"md",children:["继续加载 (",em.length-W," 个剩余)"]})})]})]}),!e&&(0,i.jsx)(w.Center,{children:(0,i.jsx)(T.Button,{variant:"gradient",component:d(),href:"/login",children:"去登录"})}),(0,i.jsx)("input",{ref:ec,type:"file",multiple:!0,style:{display:"none"},onChange:eg}),(0,i.jsx)("input",{ref:ed,type:"file",webkitdirectory:"",multiple:!0,style:{display:"none"},onChange:eg}),(0,i.jsx)(A.Modal,{opened:L,onClose:ew,title:"文件预览",size:"lg",centered:!0,children:(0,i.jsxs)(m.Stack,{gap:"md",children:[(0,i.jsx)(h.Group,{justify:"space-between",children:(0,i.jsxs)(s.Text,{size:"sm",c:"dimmed",children:["共 ",g.length," 个文件，总大小: ",ex(g.reduce((e,n)=>e+n.file.size,0))]})}),(0,i.jsx)(P.ScrollArea,{h:300,children:(0,i.jsx)(m.Stack,{gap:"xs",children:g.map((e,n)=>(0,i.jsx)(b.Card,{p:"sm",withBorder:!0,children:(0,i.jsxs)(h.Group,{justify:"space-between",align:"center",wrap:"nowrap",children:[(0,i.jsxs)(h.Group,{align:"center",children:[(0,i.jsx)(s.Text,{size:"sm",children:"\uD83D\uDCC4"}),(0,i.jsxs)(m.Stack,{gap:2,children:[(0,i.jsx)(s.Text,{size:"sm",fw:500,children:e.path}),(0,i.jsx)(s.Text,{size:"xs",c:"dimmed",children:e.size})]})]}),(0,i.jsx)(r.ActionIcon,{variant:"subtle",color:"gray",onClick:()=>(e=>{let n=g.filter((n,t)=>t!==e);F(n),0===n.length&&_(!1)})(n),children:(0,i.jsx)(O.A,{})})]})},n))})}),(0,i.jsxs)(h.Group,{justify:"flex-end",gap:"sm",children:[(0,i.jsx)(T.Button,{variant:"outline",onClick:ew,disabled:x,children:"取消"}),(0,i.jsx)(T.Button,{onClick:()=>{ef(g.map(e=>e.file))},loading:x,disabled:0===g.length,children:"确认上传"})]})]})}),(0,i.jsx)(A.Modal,{opened:ei,onClose:()=>el(!1),title:"新建文件夹",centered:!0,children:(0,i.jsxs)(m.Stack,{gap:"md",children:[(0,i.jsx)(v.TextInput,{value:er,onChange:e=>ea(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&eh()},disabled:es,autoFocus:!0}),(0,i.jsxs)(h.Group,{justify:"flex-end",gap:"sm",children:[(0,i.jsx)(T.Button,{onClick:()=>el(!1),variant:"default",children:"取消"}),(0,i.jsx)(T.Button,{onClick:eh,loading:es,children:"确认"})]})]})}),(0,i.jsx)(A.Modal,{opened:Q,onClose:()=>{U(!1),J(null),Z(""),ee("")},title:"重命名 / 移动",centered:!0,children:(0,i.jsxs)(m.Stack,{gap:"md",children:[(0,i.jsx)(v.TextInput,{label:"目录路径",placeholder:"根目录留空，例如: foo/bar",value:Y,onChange:e=>ee(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&ey()},disabled:en}),(0,i.jsx)(v.TextInput,{label:"文件/文件夹名称",placeholder:"请输入新的名称",value:X,onChange:e=>Z(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&ey()},disabled:en,autoFocus:!0}),(0,i.jsxs)(h.Group,{justify:"flex-end",gap:"sm",children:[(0,i.jsx)(T.Button,{variant:"outline",onClick:()=>{U(!1),J(null),Z(""),ee("")},disabled:en,children:"取消"}),(0,i.jsx)(T.Button,{onClick:ey,disabled:!X.trim()||eD===eI||en,loading:en,children:"确认"})]})]})})]})}t(94842),t(97030);var _=t(31064);function q(){let e=(0,p.k)(e=>e.wallet),n=(0,p.k)(e=>e.notes),t=(0,p.k)(e=>e.notesQuery),a=(0,p.k)(e=>e.setItem),[o,c]=(0,l.useState)(!1),[u,x]=(0,l.useState)(100),[f,{open:g,close:D}]=(0,_.useDisclosure)(!1),[I,P]=(0,l.useState)(""),[F,G]=(0,l.useState)(""),[O,H]=(0,l.useState)(""),[L,q]=(0,l.useState)(!1),[V,{open:W,close:K}]=(0,_.useDisclosure)(!1),[Q,U]=(0,l.useState)(null),[$,J]=(0,l.useState)(""),[X,Z]=(0,l.useState)(!1),[Y,ee]=(0,l.useState)(""),[en,et]=(0,l.useState)(""),ei=n=>{let t=new URL(window.location.href);return t.pathname="/note/",t.searchParams.set("uid",(null==e?void 0:e.address)||""),t.searchParams.set("name",n.name),t.searchParams.set("cid",n.cid),t.href},el=n?n.filter(e=>j.A.pinyin(e.name,t,0)):[],er=el.slice(0,u),ea=el.length>u;(0,l.useEffect)(()=>{x(100)},[t]);let es=async()=>{try{c(!0);let e=(await z.FH.post("/files/.note")).data;if(e){let n=e.map(e=>({name:e.name,cid:e.cid["/"]}));a("notes",n)}}catch(e){console.info(e)}finally{c(!1)}},eo=async()=>{let e=F.trim(),t=I.trim();if(!t)return void H("请输入笔记名称");if(e.includes("/")||t.includes("/"))return void H("不能包含字符 /");let i=e?"".concat(e,"-").concat(t):t;if(null==n?void 0:n.some(e=>e.name===i))return void H("笔记名称已存在");try{var l;q(!0);let e=new FormData,n=new Blob([""],{type:"text/markdown"});e.append("file",n,"index.md"),e.append("path","/.note/".concat(i,"/index.md")),(null==(l=(await z.FH.put("/files.upload",e)).data)?void 0:l.cid)&&(R.notifications.show({color:"green",message:"笔记创建成功"}),D(),await es(),P(""),G(""))}catch(e){R.notifications.show({color:"red",message:e instanceof Error?e.message:"创建失败，请重试"})}finally{q(!1)}},ec=e=>{U(e),J("");let n=e.name.indexOf("-");if(n>0){let t=e.name.slice(0,n),i=e.name.slice(n+1);ee(t),et(i)}else ee(""),et(e.name);W()},ed=e=>{let n=ei(e);window.open(n)},eu=async()=>{if(!Q)return;let e=Y.trim(),t=en.trim();if(!t)return void J("请输入名称");if(e.includes("/")||t.includes("/"))return void J("不能包含字符 /");let i=e?"".concat(e,"-").concat(t):t;if(i===Q.name)return void K();if(null==n?void 0:n.some(e=>e.name===i))return void J("笔记名称已存在");try{Z(!0),await z.FH.put("/files.rename",{oldName:"/.note/".concat(Q.name),newName:"/.note/".concat(i)}),R.notifications.show({color:"green",message:"重命名成功"}),K(),await es()}catch(e){R.notifications.show({color:"red",message:e instanceof Error?e.message:"重命名失败"})}finally{Z(!1)}},eh=async e=>{if(confirm('确定要删除笔记"'.concat(e.name,'"吗？此操作不可撤销。')))try{await z.FH.delete("/files/.note/".concat(e.name)),R.notifications.show({color:"green",message:"删除成功"}),await es()}catch(e){R.notifications.show({color:"red",message:e instanceof Error?e.message:"删除失败"})}},ex=e=>{window.open("/ipfs/".concat(e.cid,"/?filename=").concat(e.name,"&type=note"))},em=()=>{P(""),G(""),H(""),D()},ep=()=>{U(null),ee(""),et(""),J(""),K()};return(0,l.useEffect)(()=>{e&&!n&&es()},[e,n]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(m.Stack,{gap:"md",p:"md",children:[(0,i.jsx)(w.Center,{children:(0,i.jsx)(v.TextInput,{placeholder:"搜索笔记名称",value:t,onChange:e=>a("notesQuery",e.currentTarget.value),size:"md",radius:"md",w:400,styles:{input:{textAlign:"center"}}})}),(0,i.jsxs)(h.Group,{justify:"space-between",align:"center",pos:"relative",children:[(0,i.jsx)(y.LoadingOverlay,{visible:o,overlayProps:{backgroundOpacity:0},loaderProps:{type:"dots"}}),(0,i.jsxs)(k.Badge,{variant:"light",size:"lg",children:[t?"显示 ".concat(er.length," / ").concat(el.length," (总共 ").concat((null==n?void 0:n.length)||0,")"):"显示 ".concat(er.length," / ").concat((null==n?void 0:n.length)||0)," ","","个笔记"]}),(0,i.jsxs)(h.Group,{children:[(0,i.jsx)(C.Tooltip,{label:"刷新",children:(0,i.jsx)(r.ActionIcon,{size:"lg",onClick:es,color:"blue",disabled:!e,children:(0,i.jsx)(B.A,{size:18})})}),(0,i.jsx)(C.Tooltip,{label:"新笔记",children:(0,i.jsx)(r.ActionIcon,{size:"lg",onClick:g,color:"green",disabled:!e,children:(0,i.jsx)(E,{size:18})})})]})]}),t&&0===el.length?(0,i.jsxs)(m.Stack,{align:"center",justify:"center",h:200,children:[(0,i.jsx)(s.Text,{size:"lg",c:"dimmed",children:"未找到笔记"}),(0,i.jsx)(s.Text,{size:"sm",c:"dimmed",children:"尝试用其他关键词搜索"})]}):(0,i.jsxs)(i.Fragment,{children:[(()=>{let e=new Map,n=[];return er.forEach(t=>{let i=t.name.indexOf("-");if(i>0){let n=t.name.slice(0,i),l=e.get(n)||[];l.push(t),e.set(n,l)}else n.push(t)}),(0,i.jsxs)(M.Grid,{gutter:"md",children:[[...e.entries()].map(e=>{let[n,t]=e;return(0,i.jsx)(M.Grid.Col,{span:{base:12,xs:6,sm:4,md:3,lg:3,xl:2},children:(0,i.jsxs)(b.Card,{radius:"md",withBorder:!0,children:[(0,i.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:4,mb:"xs",children:[(0,i.jsx)(s.Text,{fw:700,children:n}),(0,i.jsx)(k.Badge,{variant:"light",children:t.length})]}),(0,i.jsx)(m.Stack,{gap:0,children:t.map(e=>{let t=e.name.slice(n.length+1);return(0,i.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:0,children:[(0,i.jsx)(s.Text,{py:6,className:"mp-hover",flex:1,fw:500,lineClamp:1,component:d(),href:ei(e),children:t||e.name}),(0,i.jsxs)(S.Menu,{shadow:"md",width:120,children:[(0,i.jsx)(S.Menu.Target,{children:(0,i.jsx)(r.ActionIcon,{variant:"subtle",color:"gary",children:(0,i.jsx)(N,{size:14})})}),(0,i.jsxs)(S.Menu.Dropdown,{children:[(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCD6",onClick:()=>ed(e),children:"打开"}),(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCE4",onClick:()=>ex(e),children:"分享"}),(0,i.jsx)(S.Menu.Item,{leftSection:"✏️",onClick:()=>ec(e),children:"重命名"}),(0,i.jsx)(S.Menu.Divider,{}),(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDDD1️",onClick:()=>eh(e),children:"删除"})]})]})]},e.name)})})]})},"group-".concat(n))}),n.map(e=>(0,i.jsx)(M.Grid.Col,{span:{base:12,xs:6,sm:4,md:3,lg:3,xl:2},children:(0,i.jsx)(b.Card,{radius:"md",withBorder:!0,children:(0,i.jsxs)(h.Group,{justify:"space-between",wrap:"nowrap",gap:0,children:[(0,i.jsx)(s.Text,{flex:1,fw:500,lineClamp:1,component:d(),href:ei(e),children:e.name}),(0,i.jsxs)(S.Menu,{shadow:"md",width:120,children:[(0,i.jsx)(S.Menu.Target,{children:(0,i.jsx)(r.ActionIcon,{variant:"subtle",color:"gary",children:(0,i.jsx)(N,{size:14})})}),(0,i.jsxs)(S.Menu.Dropdown,{children:[(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCD6",onClick:()=>ed(e),children:"打开"}),(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCE4",onClick:()=>ex(e),children:"分享"}),(0,i.jsx)(S.Menu.Item,{leftSection:"✏️",onClick:()=>ec(e),children:"重命名"}),(0,i.jsx)(S.Menu.Divider,{}),(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDDD1️",onClick:()=>eh(e),children:"删除"})]})]})]})})},e.name))]})})(),ea&&(0,i.jsx)(w.Center,{children:(0,i.jsxs)(T.Button,{variant:"light",onClick:()=>{x(e=>e+100)},size:"md",children:["继续加载 (",el.length-u," 个剩余)"]})})]})]}),!e&&(0,i.jsx)(w.Center,{children:(0,i.jsx)(T.Button,{variant:"gradient",component:d(),href:"/login",children:"去登录"})}),(0,i.jsx)(A.Modal,{opened:f,onClose:em,title:"创建新笔记",centered:!0,children:(0,i.jsxs)(m.Stack,{gap:"md",children:[(0,i.jsx)(v.TextInput,{label:"分组（可选）",value:F,onChange:e=>{G(e.currentTarget.value),H("")}}),(0,i.jsx)(v.TextInput,{placeholder:"请输入笔记名称",value:I,onChange:e=>{P(e.currentTarget.value),H("")},error:O,autoFocus:!0}),(0,i.jsxs)(h.Group,{justify:"flex-end",children:[(0,i.jsx)(T.Button,{variant:"default",onClick:em,children:"取消"}),(0,i.jsx)(T.Button,{loading:L,onClick:eo,children:"创建"})]})]})}),(0,i.jsx)(A.Modal,{opened:V,onClose:ep,title:"笔记重命名",centered:!0,children:(0,i.jsxs)(m.Stack,{gap:"md",children:[(0,i.jsx)(v.TextInput,{label:"分组（可选）",value:Y,onChange:e=>{ee(e.currentTarget.value),J("")}}),(0,i.jsx)(v.TextInput,{label:"名称",placeholder:"请输入名称",value:en,onChange:e=>{et(e.currentTarget.value),J("")},error:$}),(0,i.jsxs)(h.Group,{justify:"flex-end",children:[(0,i.jsx)(T.Button,{variant:"default",onClick:ep,children:"取消"}),(0,i.jsx)(T.Button,{loading:X,onClick:eu,children:"确认"})]})]})})]})}let V=JSON.parse('["抱定必死的决心","没有调查，就没有发言权","我为人人，人人为我","具体问题，具体分析","不同条件，不同结果","实践是检验真理的唯一标准","从最坏处着眼，往最好处努力","见微知著","读史以明志，鉴往而知来","爱的本质是付出","团结 紧张 严肃 活泼","出发就能到达","没说不行就是可以","真正的勇士敢于直面惨淡的人生和淋漓的鲜血","君子用人如器，各取所长","合抱之木，生于毫末","九层之台，起于累土","千里之行，始于足下","出发就能到达","人生的最高法则是什么：斗争","广厦千间，夜眠仅需六尺","不积跬步，无以至千里也","你若一往无前，自有人紧跟相随","家财万贯，日食不过三餐","碌碌百载，终归仅需寸土","芸芸众生，遍寻不过一人","把事情变简单","凡夫畏果，菩萨畏因","光灿烂时，星已死灭","聪明是一种天赋，而善良是一种选择","你打你的，我打我的","以斗争求和平则和平存，以妥协求和平则和平亡","抓住主要矛盾不放手"]');var W=t(13877),K=t(74264),Q=t(71165),U=t(33380),$=t(61505),J=t(38639);function X(){let[e,n]=(0,l.useState)(""),t=(0,l.useRef)(null),r=(0,l.useRef)(null),a=(0,l.useRef)(null),c=(0,p.k)(e=>e.nodeDark),d=(0,$.B)(),x=async()=>{t.current&&(await d.initViewer(t.current)).setMarkdown("IPFS (InterPlanetary File System) 是一种点对点的分布式文件系统协议。旨在创建一个更开放、更快速、更安全、更持久化的网络，以取代或补充目前主导互联网的 http 协议。\r\n\r\n**核心思想：从“位置寻址”到“内容寻址”**\r\n\r\n- IPFS：你通过一个内容本身的唯一加密哈希值 (称为 CID - Content Identifier) 来访问内容。这个哈希值就像是内容的数字指纹，完全由内容本身计算得来。只要内容不变，哈希值就不变。这称为 “内容寻址” - 你通过内容本身（其指纹）请求内容。\r\n\r\n- [/ipfs/bafkreihp5o7tdipf6ajkgkdxknnffkuxpeecwqydi4q5iqt4gko6r2agk4](/ipfs/bafkreihp5o7tdipf6ajkgkdxknnffkuxpeecwqydi4q5iqt4gko6r2agk4)\r\n"),r.current&&(await d.initViewer(r.current)).setMarkdown(J.A),a.current&&(await d.initViewer(a.current)).setMarkdown("Most.Box 节点是 IPFS 网关的开源封装。部署节点即可运行独立应用，并通过区块链共享信息。随着用户增多，通过内容寻址在 IPFS 网络中查找和分享文件将变得更加高效。\r\n\r\n[Windows 部署教程](/build/?system=windows) | [Linux 部署教程](/build/?system=linux)\r\n\r\n节点实现前后端分离，可以直接切换当前已部署的公开节点：[/dot](/dot)\r\n")};return(0,l.useEffect)(()=>{x();let e=Math.floor(Math.random()*V.length);n(V[e])},[]),(0,i.jsxs)(W.Container,{py:"md",children:[(0,i.jsx)(K.Title,{size:"h3",children:"Most.Box - 如影随形"}),(0,i.jsx)(s.Text,{c:"dimmed",children:"——「轻松简单、开源免费、部署自己的节点」"}),(0,i.jsx)(Q.Divider,{my:"md"}),(0,i.jsxs)(U.Accordion,{my:"md",variant:"separated",defaultValue:"IPFS",children:[(0,i.jsxs)(U.Accordion.Item,{value:"IPFS",children:[(0,i.jsx)(U.Accordion.Control,{icon:"\uD83C\uDF4E",children:"1. IPFS"}),(0,i.jsx)(U.Accordion.Panel,{children:(0,i.jsx)(u.Box,{className:c,ref:t})})]}),(0,i.jsxs)(U.Accordion.Item,{value:"IPv6",children:[(0,i.jsx)(U.Accordion.Control,{icon:"\uD83C\uDF4C",children:"2. 公网 IPV6"}),(0,i.jsx)(U.Accordion.Panel,{children:(0,i.jsx)(u.Box,{className:c,ref:r})})]}),(0,i.jsxs)(U.Accordion.Item,{value:"DOT",children:[(0,i.jsx)(U.Accordion.Control,{icon:"\uD83E\uDD66",children:"3. 运行节点"}),(0,i.jsx)(U.Accordion.Panel,{children:(0,i.jsx)(u.Box,{className:c,ref:a})})]})]}),(0,i.jsx)(K.Title,{size:"h3",children:"使用说明"}),(0,i.jsx)(s.Text,{c:"dimmed",children:"——「回归数据存储本质」"}),(0,i.jsx)(Q.Divider,{my:"md"}),(0,i.jsxs)(U.Accordion,{my:"md",variant:"separated",children:[(0,i.jsxs)(U.Accordion.Item,{value:"DOT",children:[(0,i.jsx)(U.Accordion.Control,{icon:"\uD83E\uDD95",children:"节点切换"}),(0,i.jsxs)(U.Accordion.Panel,{children:["点击左上角 ",(0,i.jsx)(o.I,{name:"Earth",size:24})," 图标选择 IPFS 网关"]})]}),(0,i.jsxs)(U.Accordion.Item,{value:"NOTE",children:[(0,i.jsx)(U.Accordion.Control,{icon:"✏️",children:"笔记"}),(0,i.jsxs)(U.Accordion.Panel,{children:["点击底部 ",(0,i.jsx)(o.I,{name:"Note",size:24})," 图标，创建 Markdown 笔记"]})]}),(0,i.jsxs)(U.Accordion.Item,{value:"IPFS",children:[(0,i.jsx)(U.Accordion.Control,{icon:"\uD83D\uDCC2",children:"文件系统"}),(0,i.jsxs)(U.Accordion.Panel,{children:["点击左下角 ",(0,i.jsx)(o.I,{name:"File",size:24})," 图标，打开 IPFS 星级文件系统"]})]})]}),(0,i.jsx)(Q.Divider,{my:"md"}),(0,i.jsx)(h.Group,{justify:"flex-end",children:(0,i.jsxs)(s.Text,{c:"dimmed",children:["——「",e,"」"]})})]})}t(41487);var Z=t(90101);let Y=e=>{let{homeTab:n}=e,t=(0,p.k)(e=>e.wallet),a=(0,p.k)(e=>e.setItem),s=(0,p.k)(e=>e.filesPath),c=(0,l.useRef)(null),d=async e=>{var n,t;let i=null==(n=e.target.files)?void 0:n[0];if(!i)return;if(!i.name.endsWith(".tar"))return void R.notifications.show({title:"格式错误",message:"只支持 .tar 格式的压缩包",color:"red"});let l=R.notifications.show({title:"导入中",message:"正在解压并导入文件...",color:"blue",autoClose:!1});try{let e=new FormData;e.append("file",i),e.append("path",s);let n=await z.FH.put("/files.import",e),t=n.data.name,r=i.name.replace(/\.tar$/,""),o=s?"".concat(s,"/").concat(t):t,c=s?"".concat(s,"/").concat(r):r;await z.FH.put("/files.rename",{oldName:"/".concat(o),newName:"/".concat(c)}),R.notifications.update({id:l,title:"导入成功",message:n.data.message,color:"green",autoClose:!0});try{let e=await z.FH.post("/files/".concat(s));a("files",e.data)}catch(e){console.error(e)}}catch(n){let e=(null==n||null==(t=n.response)?void 0:t.data)||"导入失败，请重试";R.notifications.update({id:l,title:"导入失败",message:e,color:"red",autoClose:!0})}e.target.value=""};return"file"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(S.Menu,{shadow:"md",children:[(0,i.jsx)(S.Menu.Target,{children:(0,i.jsx)(r.ActionIcon,{variant:"transparent",color:"--text-color",children:(0,i.jsx)(o.I,{name:"More",size:24})})}),(0,i.jsx)(S.Menu.Dropdown,{children:(0,i.jsx)(S.Menu.Item,{leftSection:"\uD83D\uDCC1",onClick:()=>{var e;null==(e=c.current)||e.click()},disabled:!t,children:"导入 tar 压缩包"})})]}),(0,i.jsx)("input",{ref:c,type:"file",accept:".tar",style:{display:"none"},onChange:d})]}):(0,i.jsx)(r.ActionIcon,{variant:"transparent",color:"--text-color",onClick:()=>R.notifications.show({message:"没有更多"}),children:(0,i.jsx)(o.I,{name:"More",size:24})})};function ee(){let[e,n]=(0,l.useState)(null);return(0,l.useEffect)(()=>{n(localStorage.getItem("homeTab")||"explore")},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z.AppHeader,{title:"Most.Box - 如影随形",left:(0,i.jsx)(r.ActionIcon,{variant:"transparent",color:"--text-color",component:d(),href:"/dot",children:(0,i.jsx)(o.I,{name:"Earth",size:24})}),right:(0,i.jsx)(Y,{homeTab:e})}),(0,i.jsxs)(a.Tabs,{id:"page-home",variant:"pills",radius:0,value:e,onChange:e=>{n(e),localStorage.setItem("homeTab",e||"explore")},children:[(0,i.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"file",children:(0,i.jsx)(L,{})}),(0,i.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"note",children:(0,i.jsx)(q,{})}),(0,i.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"explore",children:(0,i.jsx)(X,{})}),(0,i.jsx)(a.Tabs.Panel,{keepMounted:!0,value:"mine",children:(0,i.jsx)(f,{})}),(0,i.jsxs)(a.Tabs.List,{children:[(0,i.jsxs)(a.Tabs.Tab,{value:"file",children:[(0,i.jsx)(o.I,{name:"file"===e?"FileActive":"File"}),(0,i.jsx)(s.Text,{children:"文件"})]}),(0,i.jsxs)(a.Tabs.Tab,{value:"note",children:[(0,i.jsx)(o.I,{name:"note"===e?"NoteActive":"Note"}),(0,i.jsx)(s.Text,{children:"笔记"})]}),(0,i.jsxs)(a.Tabs.Tab,{value:"explore",children:[(0,i.jsx)(o.I,{name:"explore"===e?"ExploreActive":"Explore"}),(0,i.jsx)(s.Text,{children:"探索"})]}),(0,i.jsxs)(a.Tabs.Tab,{value:"mine",children:[(0,i.jsx)(o.I,{name:"mine"===e?"MineActive":"Mine"}),(0,i.jsx)(s.Text,{children:"我的"})]})]})]})]})}},54216:()=>{},65388:(e,n,t)=>{Promise.resolve().then(t.bind(t,43299))},94842:()=>{},97030:()=>{}},e=>{e.O(0,[2859,8198,2545,642,2829,5619,6714,8555,8990,5125,9287,9318,3252,9457,4988,7985,9439,757,101,8289,8441,1255,7358],()=>e(e.s=65388)),_N_E=e.O()}]);