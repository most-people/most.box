version: 2
project_name: dot

# 输出目录（默认 dist）
dist: dist

before:
  hooks:
    - go mod tidy

builds:
  - id: dot
    main: ./cmd/server
    binary: dot
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    ldflags:
      - -s -w
      - -X dotmostbox/internal/update.Version={{ .Version }}
    goos:
      - windows
      - linux
      - darwin
    goarch:
      - amd64
      - arm64

archives:
  - id: binaries
    ids:
      - dot
    formats: ["binary"]
    # 按原有命名习惯输出文件名
    name_template: >-
      {{ .Os }}-{{ .Arch }}-{{ .Binary }}

checksum:
  name_template: "checksums.txt"

changelog:
  use: git
  filters:
    exclude:
      - "^docs:"
      - "^test:"

# 解决重复上传同名资产导致的 422 错误
release:
  replace_existing_artifacts: true

# 使用 UPX 压缩（macOS Ventura 暂不支持，过滤 macOS）
upx:
  - enabled: true
    ids: [dot]
    goos: [linux, windows]
    compress: best
    lzma: true
    brute: false
